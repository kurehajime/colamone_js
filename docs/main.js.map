{"version":3,"sources":["webpack://colamone_js/webpack/bootstrap","webpack://colamone_js/./src/ai.ts","webpack://colamone_js/webpack/runtime/global","webpack://colamone_js/./src/boardgame.js"],"names":["__webpack_require__","Aijs","g","globalThis","this","Function","e","window","copyMap","wkMap","Int8Array","thinkAI","map","turn_player","depth","a","b","evalparam","nearwin","hand","DEFAULT_EVALPARAM","isEndX","deepThinkAllAB","getCanMovePanelX","isDraw","PIECES","NUMBERS","sum1","sum2","isNoneNode","live1","live2","i","num","flag1","flag2","panel_num","hasCanMovePanelX","number","x","y","target_x","target_y","target_number","canMove","idx","push","besthand","best_score","ev","end","cell_p","p","line","evalMap","nodeList","length","nodeMap","getNodeMap","map0","sc","global","BoardGamejs","init","zoom","innerHeight","innerWidth","document","querySelector","classList","remove","add","ctx","getContext","canv_board","createElement","width","CANV_SIZE","height","canv_board2","canv_focus","canv_pieces","canv_shadow","canv_hover_piece","canv_overlay","canv_bk","canv_cover","canv_score","canv_cache","cellSize","demo","canvas","style","RATIO","isTouch","addEventListener","ev_mouseClick","ev_touchMove","ev_mouseMove","ev_radioChange","move_start","move_prev","move_next","move_end","jumpkento","tweetlog","reloadnew","toggle","element","documentElement","bottom","scrollHeight","clientHeight","scroll","shuffleBoard","storage","getItem","setItem","undefined","value","parseInt","ua","d","s","id","js","fjs","paramObj","getParam","startMap","initString","thisMap","arr","split","red_num","blue_num","getMapByParam","log","logArray","logstr","wkInitMap","wklogArray","arrow","logArr","replace","arw","match","from","to","Math","floor","decodeLog","lv","focus","img_bk","onload","img_bk_loaded","flush","onerror","setTimeout","updateMessage","getElementsByTagName","getElementById","async","src","parentNode","insertBefore","navigator","userAgent","toLowerCase","indexOf","intervalID","setInterval","playDemo","autoLog","intervalID_log","playLog","goaled","cache_on","hover_piece","blueScore","redScore","winner","message","thinktime","thisHand","demo_inc","COLOR_LINE","COLOR_PANEL_4","COLOR_SELECT","COLOR_RED","COLOR_BLUE","COLOR_WHITE","devicePixelRatio","map_list","mouse_x","mouse_y","logPointer","logArray2","Image","parent","localStorage","random","ai","calcScore","clearInterval","viewport","screen","setAttribute","test","MSStream","w","w2","abs","orientation","rate","round","getMousePosition","preventDefault","stopPropagation","target","isGoaled","innerHTML","level","endTime","startTime","Date","count","getNodeCount","plus","afterHand","turn","r","tmp","clientX","touches","event","rect","getBoundingClientRect","left","clientY","top","initflg","cache_flg","ctx_hover","clearRect","drawImage","ctx_board","grad","createLinearGradient","addColorStop","strokeStyle","fillStyle","beginPath","fillRect","strokeRect","drawBoard","ctx_board2","globalAlpha","arc","PI","fill","drawBoard2","ctx_shadow","wkColor","px1","py1","px2","py2","px3","py3","px4","py4","x0","y0","x1","y1","h","shadow_start_x","shadow_start_y","shadow_end_x","shadow_end_y","center","moveTo","lineTo","closePath","drawShadow","ctx_pieces","goal","drawPiece","drawPieceAll","ctx_canv","ctx_focus","createRadialGradient","lineWidth","canm","stroke","drawFocus","ctx_score","fontsize","blue","red","textBaseline","textAlign","shadowBlur","shadowColor","font","fillText","drawScore","ctx_overlay","shadowOffsetX","shadowOffsetY","fillRoundRect","drawOverlay","ctx_cover","drawCover","wkCtx","ctx_bk","save","clip","restore","x_dot","y_dot","toFixed","endgame","JSON","stringify","map_json","GoalTop","GoalBottom","obj","location","search","paramstr","substring","entry","key","decodeURIComponent","encodeLog","x_vec","y_vec","url","href","lang","onLine","open","cookieEnabled","hasItem","sKey","RegExp","escape","cookie","unescape","sValue","self"],"mappings":";mBACA,IAAIA,EAAsB,GCEnB,SAASC,KCHhBD,EAAoBE,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,GACd,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,QALjB,GDKxBN,EAAKO,QAiGL,SAAiBC,GACb,OAAO,IAAIC,UAAUD,IAjGzBR,EAAKU,QA2cL,SAAiBC,EAAKC,EAAaC,EAAOC,EAAGC,EAAGC,GAC5C,IAAIC,GAAU,EACVC,EAAO,CAAC,KAAM,MACdV,EAAQ,IAAIC,UAAUE,GAW1B,OAVKK,IACDA,EAAYG,GAEa,IAAzBC,EAAOZ,GAAO,KACdS,GAAU,IAEdC,EAAOG,EAAeb,EAAOI,EAAaC,EAAOC,EAAGC,EAAGE,EAASD,IACvD,GAAKJ,IAAiB,SAC3BM,EAAOG,EAAeb,EAAOI,EAAa,EAAGE,EAAGC,EAAGE,EAASD,IAEzDE,GAxdXlB,EAAKsB,iBAAmBA,EACxBtB,EAAKoB,OAASA,EACdpB,EAAKuB,OAASA,EAQd,IAAIC,EAAS,CACT,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EACH,EAAG,EAAG,EACN,EAAG,EAAG,IAOVC,EAAU,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAC1B,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,IAMpBN,EAAoB,CACpB,GACA,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/B,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,QAgBnC,SAASC,EAAOZ,EAAOS,GACnB,IAAIS,EAAO,EACPC,EAAO,EAsCX,GApCInB,EAAM,GAAK,IACXkB,GAAQlB,EAAM,IAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,MAEF,EAAZA,EAAM,GAAU,IAChBmB,GAAQnB,EAAM,KAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,KAEdkB,GAAQ,EACR,OAAO,EAEN,GAAIC,IAAS,EACd,OAAQ,EAGZ,GAAIC,EAAWpB,GACX,OAAIkB,GAAS,EAAIC,EACN,EAEFD,GAAS,EAAIC,GACV,EAGD,EAIf,IAAgB,IAAZV,IAA+B,IAATS,GAAuB,IAATC,GAAa,CAGjD,IAFA,IAAIE,EAAQ,EACRC,EAAQ,EACHC,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC1B,IAAIC,EAAmB,EAAbP,EAAQM,GACdvB,EAAMwB,GAAO,EACbH,GAASrB,EAAMwB,GAEVxB,EAAMwB,GAAO,IAClBF,GAAStB,EAAMwB,IAGvB,GAAIN,GAAS,GAAKI,EAAQH,GACtB,OAAO,EAEN,IAAK,EAAIA,EAAQE,EAAQH,EAC1B,OAAQ,EAGhB,OAAO,EAOX,SAASH,EAAOf,GACZ,IAAIkB,EAAO,EACPC,EAAO,EAsCX,OApCInB,EAAM,GAAK,IACXkB,GAAQlB,EAAM,IAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,KAEdA,EAAM,IAAM,IACZkB,GAAQlB,EAAM,MAEF,EAAZA,EAAM,GAAU,IAChBmB,GAAQnB,EAAM,KAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,MAED,EAAbA,EAAM,IAAW,IACjBmB,GAAQnB,EAAM,KAEdkB,IAASC,KACJC,EAAWpB,GAYxB,SAASoB,EAAWpB,GAGhB,IAFA,IAAIyB,GAAQ,EACRC,GAAQ,EACHH,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC1B,IAAII,EAAyB,EAAbV,EAAQM,GACxB,GAAyB,IAArBvB,EAAM2B,MAIM,IADFC,EAAiBD,EAAW3B,KAElCA,EAAM2B,GAAa,EACnBF,GAAQ,EAEHzB,EAAM2B,GAAa,IACxBD,GAAQ,IAGZD,GAASC,GACT,OAAO,EAGf,OAAO,EAQX,SAASE,EAAiBD,EAAW3B,GACjC,IAAI6B,EAA4B,EAAnB7B,EAAM2B,GACfG,KAAOH,EAAY,IACnBI,KAAOJ,EAAY,IAEvB,GAAKE,EAAS,GAAW,IAANE,GAAaF,EAAS,GAAW,IAANE,GAAuB,IAAXF,EACtD,OAAO,EAEX,IAAK,IAAIN,EAAI,EAAGA,EAAI,EAAGA,IACnB,GAA8B,IAA1BP,EAAOa,EAAS,GAAGN,GAAvB,CAGA,IAAIS,EAAWF,KAAOP,EAAI,GAAK,EAC3BU,EAAWF,KAAOR,EAAI,GAAK,EAC/B,KAAIU,EAAW,GAAKA,EAAW,GAAKD,EAAW,GAAKA,EAAW,GAA/D,CAGA,IACIE,EAAgBlC,EADC,GAAXgC,EAAgBC,GAG1B,KAAKC,EAAgBL,EAAS,GAAOK,EAAgB,GAAkB,IAAbD,GAAoBC,EAAgB,GAAkB,IAAbD,GAGnG,OAAO,GAEX,OAAO,EAQX,SAASnB,EAAiBa,EAAW3B,GACjC,IAAI6B,EAA4B,EAAnB7B,EAAM2B,GACfG,KAAOH,EAAY,IACnBI,KAAOJ,EAAY,IACnBQ,EAAU,GAEd,GAAKN,EAAS,GAAW,IAANE,GAAaF,EAAS,GAAW,IAANE,GAAuB,IAAXF,EACtD,OAAOM,EAEX,IAAK,IAAIZ,EAAI,EAAGA,EAAI,EAAGA,IACnB,GAA8B,IAA1BP,EAAOa,EAAS,GAAGN,GAAvB,CAGA,IAAIS,EAAWF,KAAOP,EAAI,GAAK,EAC3BU,EAAWF,KAAOR,EAAI,GAAK,EAC/B,KAAIU,EAAW,GAAKA,EAAW,GAAKD,EAAW,GAAKA,EAAW,GAA/D,CAGA,IAAII,EAAiB,GAAXJ,EAAgBC,EACtBC,EAA6B,EAAblC,EAAMoC,GAErBF,EAAgBL,EAAS,GAAOK,EAAgB,GAAkB,IAAbD,GAAoBC,EAAgB,GAAkB,IAAbD,GAGnGE,EAAQE,KAAKD,IAEjB,OAAOD,EAqEX,SAAStB,EAAeV,EAAKC,EAAaC,EAAOC,EAAGC,EAAGE,EAASD,GAC5D,IACI8B,EADAC,EAA2B,QAAdnC,GAAyB,EAE1C,GAAc,IAAVC,EAEA,MAAO,CAACiC,EADRC,EAzCR,SAAiBvC,EAAOS,EAASD,GAC7B,IAAIgC,EAAK,EAET,GAAIzB,EAAOf,GACP,OAAO,EAGX,IAAIyC,EAAM7B,EAAOZ,EAAOS,GACxB,GAAY,IAARgC,EACA,OAAO,QAEN,IAAa,IAATA,EACL,OAAQ,QAGZ,IAAK,IAAIlB,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC1B,IAAII,EAAyB,EAAbV,EAAQM,GACpBmB,EAAS,EACTC,EAAI3C,EAAM2B,GACViB,OAAO,EAEPD,EAAI,GACJC,EAAO,EAAKjB,EAAY,GACxBe,GAAUlC,EAAUmC,GAAGC,IAElBD,EAAI,IACTC,EAAQjB,EAAY,GACpBe,IAAqC,EAA3BlC,GAAW,EAAImC,GAAGC,IAGhCJ,GAAME,EAEV,OAAa,EAALF,EASSK,CAAQ1C,EAAKM,EAASD,SAG7B,IAANF,QAAsB,IAANC,IAChBD,EAAI,QAAUF,GAAe,EAC7BG,EAAI,QAAUH,GAGlB,IADA,IAAI0C,EAxER,SAAoB9C,EAAOI,GAEvB,IADA,IAAI0C,EAAW,GACNvB,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC1B,IAAII,EAAyB,EAAbV,EAAQM,GACxB,KAAIvB,EAAM2B,GAAavB,GAAe,GAA0B,IAArBJ,EAAM2B,IAIjD,IADA,IAAIQ,EAAUrB,EAAiBa,EAAW3B,GACjCwB,EAAM,EAAGA,EAAMW,EAAQY,OAAQvB,IAAO,CAC3C,IAAIwB,EAAU,IAAI/C,UAAUD,GAC5BgD,EAAQb,EAAQX,IAAQwB,EAAQrB,GAChCqB,EAAQrB,GAAa,EACrBmB,EAAST,KAAK,CAAC,CAACV,EAAWQ,EAAQX,IAAOwB,KAGlD,OAAOF,EAyDQG,CAAW9C,EAAKC,GACtBmB,EAAI,EAAGA,EAAIuB,EAASC,OAAQxB,IAAK,CACtC,IAAIb,EAAOoC,EAASvB,GAAG,GACnB2B,EAAOJ,EAASvB,GAAG,GACnB4B,EAAK,EAELV,EAAM7B,EAAOsC,EAAMzC,GACvB,GAAIgC,IAAQrC,EACR,MAAO,CAACM,EAAM,OAASN,GAG3B,GAAIqC,KAAuB,EAAfrC,GA4BZ,GApBI+C,EADA/B,EAAW8B,GACN,EAGArC,EAAeqC,GAAqB,EAAf9C,EAAkBC,EAAQ,EAAGE,EAAGD,EAAGG,EAASD,GAAW,QAEpE,IAAb8B,IACAC,EAAaY,EACbb,EAAW5B,IAEK,IAAhBN,GAAqB+C,EAAKZ,IAIJ,IAAjBnC,GAAsB+C,EAAKZ,KAHhCA,EAAaY,EACbb,EAAW5B,IAMK,IAAhBN,GAAqBE,EAAIiC,IAA+B,IAAjBnC,GAAsBE,EAAIiC,KACjEjC,EAAIiC,GAEY,IAAhBnC,GAAqBG,GAAKgC,IAA+B,IAAjBnC,GAAsBG,GAAKgC,EACnE,gBA5BiB,IAAbD,IACAC,EAAa,OAASnC,GAAe,EACrCkC,EAAW5B,GA6BvB,MAAO,CAAC4B,EAAUC,IEtcpB,SAAWa,GAOXA,EAAOC,YAHP,aAIAD,EAAOC,YAAYC,KAoKnB,WACEC,IACIzD,OAAO0D,YAAc1D,OAAO2D,WAC9BC,SAASC,cAAc,WAAWC,UAAUC,OAAO,QAEnDH,SAASC,cAAc,WAAWC,UAAUE,IAAI,QAElDC,EAAML,SAASC,cAAc,SAASK,WAAW,OAEjDC,EAAaP,SAASQ,cAAc,WACzBC,MAAQC,EACnBH,EAAWI,OAASD,GAGpBE,EAAcZ,SAASQ,cAAc,WACzBC,MAAQC,EACpBE,EAAYD,OAASD,GAErBG,EAAab,SAASQ,cAAc,WACzBC,MAAQC,EACnBG,EAAWF,OAASD,GAEpBI,EAAcd,SAASQ,cAAc,WACzBC,MAAQC,EACpBI,EAAYH,OAASD,GAErBK,EAAcf,SAASQ,cAAc,WACzBC,MAAQC,EACpBK,EAAYJ,OAASD,GAErBM,EAAmBhB,SAASQ,cAAc,WACzBC,MAAQC,EACzBM,EAAiBL,OAASD,GAE1BO,EAAejB,SAASQ,cAAc,WACzBC,MAAQC,EACrBO,EAAaN,OAASD,GAEtBQ,EAAUlB,SAASQ,cAAc,WACzBC,MAAQC,EAChBQ,EAAQP,OAASD,GAEjBS,EAAanB,SAASQ,cAAc,WACzBC,MAAQC,EACnBS,EAAWR,OAASD,GAEpBU,EAAapB,SAASQ,cAAc,WACzBC,MAAQC,EACnBU,EAAWT,OAASD,GAEpBW,EAAarB,SAASQ,cAAc,WACzBC,MAAQC,EACnBW,EAAWV,OAASD,EAEpBY,EAAWZ,EAAY,EACvBhE,EAAc,EACd6E,GAAO,EAGPlB,EAAImB,OAAOC,MAAMhB,MAAQC,EAAUgB,EAAQ,KAC3CrB,EAAImB,OAAOC,MAAMd,OAASD,EAAUgB,EAAQ,KAC5CrB,EAAImB,OAAOf,MAAQC,EACnBL,EAAImB,OAAOb,OAASD,GAGlBiB,EADE,iBAAkBvF,SAOpB4D,SAASC,cAAc,SAAS2B,iBAAiB,aAAcC,IAC/D7B,SAASC,cAAc,SAAS2B,iBAAiB,YAAaE,MAE9D9B,SAASC,cAAc,SAAS2B,iBAAiB,YAAaG,IAC9D/B,SAASC,cAAc,SAAS2B,iBAAiB,UAAWC,KAE9D7B,SAASC,cAAc,UAAU2B,iBAAiB,SAAUI,IAC5DhC,SAASC,cAAc,aAAa2B,iBAAiB,QAASK,IAC9DjC,SAASC,cAAc,SAAS2B,iBAAiB,QAASM,IAC1DlC,SAASC,cAAc,SAAS2B,iBAAiB,QAASO,IAC1DnC,SAASC,cAAc,aAAa2B,iBAAiB,QAASQ,IAC9DpC,SAASC,cAAc,WAAW2B,iBAAiB,QAASS,IAC5DrC,SAASC,cAAc,aAAa2B,iBAAiB,QAASU,IAC9DtC,SAASC,cAAc,YAAY2B,iBAAiB,QAASW,IAC7DvC,SAASC,cAAc,gBAAgB2B,iBAAiB,SAAS,WAE/D,GADA5B,SAASC,cAAc,WAAWC,UAAUsC,OAAO,QAC/CpG,OAAO0D,YAAc1D,OAAO2D,WAAY,CAC1C,IAAI0C,EAAUzC,SAAS0C,gBACnBC,EAASF,EAAQG,aAAeH,EAAQI,aAC5CzG,OAAO0G,OAAO,EAAGH,OAKrBvG,OAAOwF,iBAAiB,oBAAqB/B,GAE7CkD,KAGKC,EAAQC,QAAQ,YACnBD,EAAQE,QAAQ,UAAW,GAExBF,EAAQC,QAAQ,YACnBD,EAAQE,QAAQ,UAAW,GAExBF,EAAQC,QAAQ,YACnBD,EAAQE,QAAQ,UAAW,GAExBF,EAAQC,QAAQ,YACnBD,EAAQE,QAAQ,UAAW,GAExBF,EAAQC,QAAQ,YACnBD,EAAQE,QAAQ,UAAW,QAGSC,IAAlCH,EAAQC,QAAQ,eAAiE,cAAlCD,EAAQC,QAAQ,eAAmE,OAAlCD,EAAQC,QAAQ,cAClHjD,SAASC,cAAc,UAAUmD,MAAMC,SAASL,EAAQC,QAAQ,gBAEhED,EAAQE,QAAQ,aAAc,GAC9BlD,SAASC,cAAc,UAAUmD,MAAM,GAOzC,IAo3CIE,EATOC,EAAGC,EAAGC,EACXC,EAAIC,EA52CNC,EAAWC,KAGXD,EAAShE,MACXkE,EA8pCJ,SAAuBC,GACrB,IAAIzH,EACJ,GAAIyH,EAAY,CAGd,IAAK,IAAIjG,KAFTxB,EAAQR,EAAKO,QAAQ2H,GAGnB1H,EAAMwB,GAAO,EAEf,IAAImG,EAAMF,EAAWG,MAAM,KACvBD,EAAI5E,OAAS,IACf4E,EAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAE9B,IAAIE,EAAU,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IACtCC,EAAW,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,IAE3C,IAAK,IAAItG,KAAOsG,EACd9H,EAAM8H,EAAStG,IAAQuF,SAASY,EAAInG,IAEtC,IAAK,IAAIA,KAAOqG,EACd7H,EAAM6H,EAAQrG,KAAS,EAAIuF,SAASY,EAAInG,IAI5C,OAAOxB,EArrCM+H,CAAcT,EAAShE,MAClCoE,EAAUlI,EAAKO,QAAQyH,IAEvBA,EAAWhI,EAAKO,QAAQ2H,GAGtBJ,EAASU,MACXC,EAmrCJ,SAAmBC,EAAQC,GACzB,IAAIC,EAAa,GACbpI,EAAQR,EAAKO,QAAQoI,GACrBE,EAAQ,CACV,EAAK,EAAG,EAAK,EAAG,EAAK,EACrB,EAAK,EAAG,EAAK,EAAG,EAAK,EACrB,EAAK,EAAG,EAAK,EAAG,EAAK,GAKnBC,GADJJ,GADAA,GADAA,EAASA,EAAOK,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,OACtDA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,OACtDA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,OAClDX,MAAM,KAE1BQ,EAAW/F,KAAKrC,GAChB,IAAK,IAAIuB,EAAI,EAAGA,EAAI+G,EAAOvF,OAAQxB,IACjC,GAAkB,KAAd+G,EAAO/G,GAAX,CACA,IAAIiH,EAAMH,EAAMC,EAAO/G,GAAGkH,MAAM,eAAe,IAC3CC,EAAO3B,SAASuB,EAAO/G,GAAGkH,MAAM,OAAO,IACvCE,EAAyD,IAAnDC,KAAKC,MAAMH,EAAO,IAAME,KAAKC,MAAML,EAAM,GAAK,IACtDI,KAAKC,MAAMH,EAAO,IAAME,KAAKC,MAAML,EAAM,GAAK,IAChDxI,EAAQR,EAAKO,QAAQC,IACf2I,GAAM5B,SAAS/G,EAAM0I,IAC3B1I,EAAM0I,GAAQ,EACdN,EAAW/F,KAAKrC,GAElB,OAAOoI,EA5sCMU,CAAUxB,EAASU,IAAKR,IAGjCF,EAASyB,KACXrF,SAASC,cAAc,UAAUmD,MAAMC,SAASO,EAASyB,KAGnC,IAApBd,EAASlF,QACXW,SAASC,cAAc,QAAQC,UAAUC,OAAO,QAChDH,SAASC,cAAc,aAAaC,UAAUC,OAAO,QACrDH,SAASC,cAAc,SAASC,UAAUC,OAAO,QACjDH,SAASC,cAAc,SAASC,UAAUC,OAAO,QACjDH,SAASC,cAAc,aAAaC,UAAUC,OAAO,QACrDH,SAASC,cAAc,gBAAgBC,UAAUE,IAAI,QACrDJ,SAASC,cAAc,kBAAkBC,UAAUE,IAAI,QACvDJ,SAASC,cAAc,SAASqF,UAEhCtF,SAASC,cAAc,QAAQC,UAAUE,IAAI,QAC7CJ,SAASC,cAAc,aAAaC,UAAUE,IAAI,QAClDJ,SAASC,cAAc,SAASC,UAAUE,IAAI,QAC9CJ,SAASC,cAAc,SAASC,UAAUE,IAAI,QAC9CJ,SAASC,cAAc,aAAaC,UAAUE,IAAI,QAClDJ,SAASC,cAAc,gBAAgBC,UAAUE,IAAI,QACrDJ,SAASC,cAAc,kBAAkBC,UAAUE,IAAI,SAIzDmF,EAAOC,OAAS,WACdC,GAAgB,EAChBC,IAAM,GAAM,IAGdH,EAAOI,QAAU,WACfD,IAAM,GAAM,IAGO,IAAjBH,EAAO9E,QACTgF,GAAgB,EAChBC,IAAM,GAAM,IAGdE,YAAW,WACY,IAAjBL,EAAO9E,QACTgF,GAAgB,GAElBC,IAAM,GAAM,KACX,MACHG,KAizCcrC,EAGD,SAHIC,EAGM,cAFbE,GADCJ,EAGRvD,UAFe8F,qBAAqBtC,GAAG,GACnCD,EAAEwC,eAAetC,MAAOC,EAAKH,EAAE/C,cAAcgD,IAAOC,GAAKA,EAAIC,EAAGsC,OAAQ,EAAMtC,EAAGuC,IAAM,0CAA2CtC,EAAIuC,WAAWC,aAAazC,EAAIC,IAhzCjJ,IAApBY,EAASlF,OACC,KAuzCY,IADtBiE,EAAKlH,OAAOgK,UAAUC,UAAUC,eAC7BC,QAAQ,SACc,GAA7BjD,EAAGiD,QAAQ,gBACgB,GAA3BjD,EAAGiD,QAAQ,cAxzCPnK,OAAOwJ,YAAW,WACP,GAANrE,IACDiF,EAAapK,OAAOqK,YAAYC,EAAU,KAC1CA,OAEF,MAGJnF,GAAO,EACPoF,GAAQ,EACRC,EAAiBxK,OAAOqK,YAAYI,EAAS,MAE/CC,GAAO,EACPpB,IAAM,GAAM,IA3Wd,IAAIrF,EAAM,KACNsB,GAAU,EACVmF,GAAO,EACPvG,EAAa,KACbK,EAAc,KACdC,EAAa,KACbC,EAAc,KACdC,EAAc,KACdC,EAAmB,KACnBC,EAAe,KACfC,EAAU,KACVC,EAAa,KACbC,EAAa,KACbC,EAAa,KACb0F,GAAW,EACXtB,GAAgB,EAChBuB,EAAc,KACd1F,EAAW,KACX5E,EAAc,KACduK,EAAY,EACZC,EAAW,EACXC,EAAS,KACTC,EAAU,GACVC,EAAY,EACZ9F,GAAO,EACPoF,GAAQ,EACRH,EAAa,KACbI,EAAiB,KACjBU,EAAW,GACXC,EAAS,EACPC,EAAa,UAIbC,EAAgB,UAGhBC,EAAe,UAEfC,EAAY,UACZC,EAAa,UAGbC,EAAc,UAChBnG,EAAM,OACoByB,IAA1B/G,OAAO0L,kBAAwD,GAAzB1L,OAAO0L,mBAC/CpG,EAAQtF,OAAO0L,kBAEjB,IAyEIhE,EAzEApD,EAAU,IAAIgB,EAEZpE,EAAS,CACb,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,EAAK,CAAC,EAAG,EAAG,EACV,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,GACR,KAAM,CAAC,EAAG,EAAG,EACX,EAAG,EAAG,EACN,EAAG,EAAG,IAWN0G,EAAS,EACV,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,EACzB,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,EACvB,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EACrB,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,EAAE,EAAE,EAAE,EAAE,EACtB,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,GAGjB+D,EAAW,GAEXC,EAAU,EACVC,EAAU,EAEVC,EAAa,EACb3D,EAAW,GACX4D,EAAY,GACZ5C,EAAS,MACbA,EAAS,IAAI6C,OAAgBnC,IAAM,SACnC,IAAIjD,EAAU,KACd,IACM5G,QAAUiM,QAAW,iBAAkBjM,QAAmC,OAAxBA,OAAOkM,eAC3DtF,EAAUsF,cACFpF,QAAQ,OAAQ,GAE1B,MAAO/G,GACP6G,EAAU,KA2OZ,SAAS0D,IACW,OAAdF,IACEtB,KAAKqD,SAAW,GAClBC,GAAG,GAEHA,GAAG,IAGPjB,IACAkB,KACA/C,IAAM,GAAO,GACE,IAAXyB,IAA4B,IAAZA,GAA4B,IAAXA,IACnCL,GAAO,EACPK,EAAS,KACTzB,IAAM,GAAO,GACb3C,MAECwE,EAAS,IACVnL,OAAOsM,cAAclC,GAOzB,SAASK,IAEe,OAAlBD,GAAiC,GAATD,EAC1BxE,KAEAuG,cAAc9B,GAOlB,SAAS/G,IACP,IAAI8I,EAAW3I,SAASC,cAAc,uBAatC,GAZI2I,OAAOnI,MAAQ,KAAOmI,OAAOjI,OAAS,IACpCiI,OAAOnI,MAAQmI,OAAOjI,OACxBgI,EAASE,aAAa,UAAW,8BAEjCF,EAASE,aAAa,UAAW,+BAE1BD,OAAOnI,MAAQ,IACxBkI,EAASE,aAAa,UAAW,8BACxBD,OAAOjI,OAAS,KACzBgI,EAASE,aAAa,UAAW,+BAG/B,mBAAmBC,KAAK1C,UAAUC,aAAejK,OAAO2M,SAAU,CACpE,IAAIC,EAAIJ,OAAOnI,MACXwI,EAAK,IAC4B,IAAjC/D,KAAKgE,IAAI9M,OAAO+M,eAClBH,EAAIJ,OAAOjI,OACXsI,EAAK,KAEP,IAAIG,EAAOlE,KAAKmE,MAAOL,EAAIC,EAAM,KAAQ,IACrCG,GAAQlE,KAAKmE,MAAMD,KACrBA,GAAQ,MAGVT,EAASE,aACP,UACA,iBAAmBO,EAAO,mBAAqBA,EAAO,mBAAqBA,EAAO,uBAQxF,SAASrH,GAAa5F,GACpBmN,GAAiBnN,GACjBuJ,IAAM,GAAO,GAKf,SAAS5D,GAAa3F,GACpBA,EAAEoN,iBACFpN,EAAEqN,kBAMJ,SAAS3H,GAAc1F,GACrBmN,GAAiBnN,GACjB,IAAIsN,EAA0C,GAAjCvE,KAAKC,MAAM6C,EAAU1G,GAAgB4D,KAAKC,MAAM8C,EAAU3G,GACvE,GAAe,OAAX6F,GAAuC,IAApB5C,EAASlF,OAE9B,OADAkD,MACO,EAET,IAAa,IAAThB,EAWF,OAVAA,GAAO,EACP+F,EAAW,GACXtD,EAAUlI,EAAKO,QAAQyH,GACvBqE,EAAY,GACZzC,IAAM,GAAO,GACbyB,EAAS,KACTL,GAAO,EACPpK,EAAc,EACdN,OAAOsM,cAAclC,GACrBd,IAAM,GAAO,IACN,EAGT,GAAoB,OAAhBsB,EACEhD,EAAQyF,GAAU/M,EAAc,IAClCsK,EAAcyC,OAEX,CACL,GAAIA,GAAUzC,EAGZ,OAFAA,EAAc,UACdtB,IAAM,GAAO,GAGJ5J,EAAKsB,iBAAiB4J,EAAahD,GACrCuC,QAAQkD,IAAW,IAC1B/D,IAAM,GAAO,GACVgE,GAAS1F,EAAQyF,EAAO/M,KACvBoK,GAAO,EACPpB,IAAM,GAAO,GACbE,YAAW,WACTkB,GAAO,EACPpB,IAAM,GAAO,KACb,MAIN1B,EAAQyF,GAAUzF,EAAQgD,GAC1BhD,EAAQgD,GAAe,EACvBtK,IAA6B,EAC7ByL,EAAUxJ,KAAK,CAACqI,EAAayC,IAC7BnC,EAAW,CAACN,EAAayC,GACzBzC,EAAc,KAIdI,EAAU,cACVhL,OAAOwJ,YAAW,WAChBF,IAAM,GAAO,KACZ,IACHG,KACe,OAAXsB,GACF/K,OAAOwJ,YAAW,WAChB4C,GAAGxI,SAASC,cAAc,UAAUmD,OACpCgE,EAAU,GACVvB,KACAH,IAAM,GAAO,KACZ,MAITA,IAAM,GAAO,GAMf,SAAS1D,KACP,IAAIlE,EAAMkC,SAASC,cAAc,UAAUmD,MAC3CJ,EAAQE,QAAQ,aAAcpF,GAC1BkF,EAAQC,QAAQ,SAAWnF,GAAO,EACpCkC,SAASC,cAAc,SAAS0J,UAAY3G,EAAQC,QAAQ,SAAWnF,GAAO,QAE9EkC,SAASC,cAAc,SAAS0J,UAAY,GAE9C3F,EAAUlI,EAAKO,QAAQyH,GACvBwD,EAAW,GACXS,EAAW,GACXI,EAAY,GACZzC,IAAM,GAAO,GAMf,SAAS8C,GAAGoB,GACV,IAAI5M,EAEA6M,EADAC,EAAY,IAAIC,KAGhBC,EAs3BN,SAAsB1N,GACpB,IAAI0N,EAAQ,EACZ,IAAK,IAAI/L,KAAa3B,EACK,IAArBA,EAAM2B,KAIV+L,GADclO,EAAKsB,iBAAiBa,EAAW3B,GAC9B+C,QAEnB,OAAO2K,EA/3BKC,CAAajG,GAAW,EAChCkG,EAAO,EAEX,OADAN,EAAQvG,SAASuG,IAEf,KAAK,EACCI,GAAS,GACXE,IAEF,MACF,KAAK,EACCF,GAAS,GACXE,IAEF,MACF,KAAK,EACCF,GAAS,IACXE,IAEEF,GAAS,GACXE,IAEF,MACF,KAAK,EACCF,GAAS,IACXE,IAEEF,GAAS,GACXE,IAEF,MACF,KAAK,EAWL,KAAK,EACCF,EAAQ,IACVE,IAEEF,GAAS,IACXE,IAEEF,GAAS,GACXE,IAKNlN,EAAOlB,EAAKU,QAAQwH,EAAStH,EAAakN,EAAQM,EAAO,GAAG,GAC5D5C,EAAWtK,EACPA,IACC0M,GAAS1F,EAAQhH,EAAK,GAAGN,KACxBoK,GAAO,EACPpB,IAAM,GAAO,GACbE,YAAW,WACTkB,GAAO,EACPpB,IAAM,GAAO,KACb,MAEN1B,EAAQhH,EAAK,IAAMgH,EAAQhH,EAAK,IAChCgH,EAAQhH,EAAK,IAAM,EACnBmL,EAAUxJ,KAAK,CAAC3B,EAAK,GAAIA,EAAK,MAKhCN,IAA6B,EAC7BmN,EAAU,IAAIE,KACd1C,GAAawC,EAAUC,GAAa,IAKtC,SAASJ,GAASjN,EAAI0N,EAAUC,GAC5B,GAAGA,EAAK,GACN,GAAGD,EAAU,IAAK,EACd,OAAO,OAEP,GAAGC,EAAK,GACTD,EAAU,IAAK,EACd,OAAO,EAIb,OAAO,EAKX,SAASpH,KAEP,IAAK,IAAIjF,KAAOkG,EACdA,EAAQlG,GAAO,EAKjB,IAHA,IAAImG,EAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC5BE,EAAU,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IACtCC,EAAW,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,IAClCvG,EAAIoG,EAAI5E,OAAS,EAAGxB,GAAK,EAAGA,IAAK,CACxC,IAAIwM,EAAInF,KAAKC,MAAMD,KAAKqD,UAAY1K,EAAI,IACpCyM,EAAMrG,EAAIpG,GACdoG,EAAIpG,GAAKoG,EAAIoG,GACbpG,EAAIoG,GAAKC,EAEX,IAAK,IAAIxM,KAAOsG,EACdJ,EAAQI,EAAStG,IAAQmG,EAAInG,GAE/B,IAAK,IAAIA,KAAOqG,EACdH,EAAQG,EAAQrG,KAAS,EAAImG,EAAInG,GAOrC,SAASwL,GAAiBnN,GACxB,GAAM,MAAHA,EAAH,CAGKA,EAAEoO,UAEHpO,EADEA,EAAEqO,SAEKrO,EAAEqO,QADPrO,EAAEqO,QAAQ,GAIVC,MAAMD,QAAQ,IAGtB,IAAIE,EAAOvO,EAAEsN,OAAOkB,wBACpB3C,EAAU7L,EAAEoO,QAAUG,EAAKE,KAC3B3C,EAAU9L,EAAE0O,QAAUH,EAAKI,IAC3B9C,GAAqBtG,EACrBuG,GAAqBvG,GAMvB,SAASgE,GAAMqF,EAASC,GACtB,IAwSIC,EAxSA3O,EAAQ,IAAIC,UAAUyH,GAO1B,GANA3D,EAAI6K,UAAU,EAAG,EAAGxK,EAAWA,IAEb,IAAdsK,IACFjE,GAAW,IAGK,IAAdiE,IAAoC,IAAbjE,EAAoB,CAE7C1G,EAAI8K,UAqOR,SAAmBJ,GACjB,IAAgB,IAAZA,EACF,OAAOxK,EAET,IAAI6K,EAAY7K,EAAWD,WAAW,MACtC8K,EAAUF,UAAU,EAAG,EAAGxK,EAAWA,GAErC,IAAI2K,EAAOD,EAAUE,qBAAqB,EAAG,EAAG5K,EAAWA,GAC3D2K,EAAKE,aAAa,EA54BE,WA64BpBF,EAAKE,aAAa,GA94BE,WA+4BpBF,EAAKE,aAAa,EAAG9D,GAErB,IAAK,IAAIrJ,EAAI,EAAGA,EAAI,EAAGA,IACrB,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAErB+M,EAAUI,YAAchE,EACd,IAANnJ,EACF+M,EAAUK,UA15BI,UA25BA,GAALpN,EACT+M,EAAUK,UA35BI,WA45BJrN,EAAIC,GAAK,GAAM,EACzB+M,EAAUK,UA55BI,WA85BdL,EAAUK,UAAYhE,EACtB2D,EAAUK,UAAYJ,GAExBD,EAAUM,YACVN,EAAUO,SAASvN,EAAIkD,EAAUjD,EAAIiD,EAAUA,EAAUA,GACzD8J,EAAUQ,WAAWxN,EAAIkD,EAAUjD,EAAIiD,EAAUA,EAAUA,GAI/D,OAAOf,EArQSsL,CAAUd,GAAU,EAAG,EAAGrK,EAAWA,GAGnDL,EAAI8K,UAwQR,SAAoBJ,GAClB,IAAgB,IAAZA,EACF,OAAOnK,EAET,IAAIkL,EAAalL,EAAYN,WAAW,MAQxC,OAPAwL,EAAWZ,UAAU,EAAG,EAAGxK,EAAWA,GACtCoL,EAAWC,YAAc,IACzBD,EAAWL,UAAY5D,EACvBiE,EAAWJ,YACXI,EAAWE,IAAe,EAAX1K,GAAe,EAAIA,EAAU,EAAIA,EAAU,EAAa,EAAV4D,KAAK+G,IAAQ,GAC1EH,EAAWI,OAEJtL,EApRSuL,CAAWpB,GAAU,EAAG,EAAGrK,EAAWA,GAGhC,OAAhBsG,IACF1K,EAAM0K,GAAe,GAIvB3G,EAAI8K,UA8ZR,SAAoB7O,EAAOU,GACzB,IAAIoP,EAAarL,EAAYT,WAAW,MACxC8L,EAAWlB,UAAU,EAAG,EAAGxK,EAAWA,GACtC,IAeI2K,EAFAgB,EA8CEC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EA3DrCC,EAAM9P,EAAK,GAAK,GAAK,EACrB+P,EAAK/P,EAAK,GAAK,GACfgQ,EAAMhQ,EAAK,GAAK,GAAK,EACrBiQ,EAAKjQ,EAAK,GAAK,GACfkQ,EAAI5L,EAAW,EAAIA,EAAW,EAC9B0H,EAAI1H,EAAW,EAAIA,EAAW,EAC9BlD,EAAI4O,EAAK1L,EAAWA,EAAW,GAC/BjD,EAAI4O,EAAK3L,EAAWA,EAAW,GAC/B6L,EAAiB/O,EAAI4K,EAAI,EACzBoE,EAAiB/O,EAAI6O,EAAI,EACzBG,EAAeF,EACfG,EAAeF,EACfjP,EAAS7B,EAAMU,EAAK,IAEpBuQ,EAAS,EAEb,GAAmB,GAAfvQ,EAAKqC,OACP,OAAO0B,GAGPsL,EADElO,EAAS,EACDyJ,EAEAD,EAERmF,GAAME,GAAMD,GAAME,IAElBM,GADGT,EAAKC,GAAM,GAAM,GAAY,IAAPA,GAAkB,GAANA,EAC5B,GAEA,GAEPD,EAAKE,IACP5O,EAAIA,EAAI4K,EAAI,GACZqE,GAA8BrE,GAE5B8D,EAAKE,IACP5O,EAAIA,EAAI4K,EAAI,GACZqE,GAA8BrE,GAE5B+D,EAAKE,IACP5O,EAAIA,EAAI6O,EAAI,GACZI,GAA8BJ,GAE5BH,EAAKE,IACP5O,EAAIA,EAAI6O,EAAI,GACZI,GAA8BJ,IAEhC7B,EAAOe,EAAWd,qBAAqB6B,EAAgBC,EAAgBC,EAAcC,IAEhF/B,aAAa,EAAGc,GACrBhB,EAAKE,aAAagC,EAAQlB,GAC1BhB,EAAKE,aAAa,EAAG,0BACrBa,EAAWX,UAAYJ,EACvBe,EAAWT,SAASvN,EAAGC,EAAG6O,EAAGlE,KAG3BuE,GADGT,EAAKC,GAAM,GAAM,GAAY,IAAPA,GAAkB,GAANA,EAC5B,GAEA,GAGPD,EAAKE,GAAMD,EAAKE,IAClBX,EAAMlO,EACNmO,EAAMlO,EAAI6O,EACVV,EAAMpO,EAAI4K,EACVyD,EAAMpO,EACNqO,EAAMtO,EACNuO,EAAMtO,EAAI6O,EACVN,EAAMxO,EAAI4K,EACV6D,EAAMxO,EACNgP,GAA8BrE,EAC9BsE,GAA8BJ,EAC9BC,GAAsC,EAAJnE,EAClCoE,GAAsC,EAAJF,GAEhCJ,EAAKE,GAAMD,EAAKE,IAClBX,EAAMlO,EAAI4K,EACVuD,EAAMlO,EACNmO,EAAMpO,EAAI4K,EAAIA,EACdyD,EAAMpO,EAAI6O,EACVR,EAAMtO,EAAI4K,EACV2D,EAAMtO,EAAI6O,EAAIA,EACdN,EAAMxO,EACNyO,EAAMxO,EAAI6O,EACVG,GAA8BrE,EAC9BsE,GAA8BJ,EAC9BC,GAAsC,EAAJnE,EAClCoE,GAAsC,EAAJF,GAEhCJ,EAAKE,GAAMD,EAAKE,IAClBX,EAAMlO,EACNmO,EAAMlO,EACNmO,EAAMpO,EAAI4K,EACVyD,EAAMpO,EAAI6O,EACVR,EAAMtO,EACNuO,EAAMtO,EAAI6O,EAAIA,EACdN,EAAMxO,EAAI4K,EACV6D,EAAMxO,EAAI6O,EACVG,GAA8BrE,EAC9BsE,GAA8BJ,EAC9BC,GAAsC,EAAJnE,EAClCoE,GAAsC,EAAJF,GAEhCJ,EAAKE,GAAMD,EAAKE,IAClBX,EAAMlO,EAAI4K,EACVuD,EAAMlO,EAAI6O,EACVV,EAAMpO,EAAI4K,EAAIA,EACdyD,EAAMpO,EACNqO,EAAMtO,EAAI4K,EACV2D,EAAMtO,EAAI6O,EACVN,EAAMxO,EACNyO,EAAMxO,EACNgP,GAA8BrE,EAC9BsE,GAA8BJ,EAC9BC,GAAsC,EAAJnE,EAClCoE,GAAsC,EAAJF,GAEpCd,EAAWV,YACXU,EAAWoB,OAAOlB,EAAKC,GACvBH,EAAWqB,OAAOjB,EAAKC,GACvBL,EAAWqB,OAAOf,EAAKC,GACvBP,EAAWqB,OAAOb,EAAKC,GACvBT,EAAWqB,OAAOnB,EAAKC,GACvBH,EAAWsB,aACXrC,EAAOe,EAAWd,qBAAqB6B,EAAgBC,EAAgBC,EAAcC,IAChF/B,aAAa,EAAGc,GACrBhB,EAAKE,aAAagC,EAAQlB,GAC1BhB,EAAKE,aAAa,IAAM,0BACxBa,EAAWX,UAAYJ,EACvBe,EAAWF,QAGb,OAAOnL,EApiBS4M,CAAWrR,EAAOgL,GAAW,EAAG,EAAG5G,EAAWA,GAI5DL,EAAI8K,UAqYR,SAAsB7O,GACpB,IAAIsR,EAAa9M,EAAYR,WAAW,MACxCsN,EAAW1C,UAAU,EAAG,EAAGxK,EAAWA,GACtC,IAAK,IAAItC,EAAI,EAAGA,EAAI,EAAGA,IACrB,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACrB,GAA0B,IAAtB/B,EAAU,GAAJ8B,EAASC,GAAU,CAC3B,IAAIwP,GAAO,GACPvR,EAAU,GAAJ8B,EAASC,GAAK,GAAW,IAANA,GAElB/B,EAAU,GAAJ8B,EAASC,GAAK,GAAU,GAALA,KADlCwP,GAAO,GAITD,EAAaE,GAAUF,EAAYxP,EAAIkD,EAAUjD,EAAIiD,EAAUhF,EAAU,GAAJ8B,EAASC,GAAIwP,GAIxF,OAAO/M,EArZSiN,CAAazR,GAAQ,EAAG,EAAGoE,EAAWA,GAGpD,IAAIsN,EAAW3M,EAAWf,WAAW,MACrC0N,EAAS9C,UAAU,EAAG,EAAGxK,EAAWA,GACpCsN,EAAS7C,UAAU9K,EAAImB,OAAQ,EAAG,EAAGd,EAAWA,GAEhDqG,GAAW,OAGX1G,EAAI8K,UAAU9J,EAAY,EAAG,EAAGX,EAAWA,GAI7CL,EAAI8K,YAkQAF,EAAYjK,EAAiBV,WAAW,OAClC4K,UAAU,EAAG,EAAGxK,EAAWA,GAGjB,OAAhBsG,GACF8G,GAAU7C,EAHJjD,EAAW1G,EAAW,EACtB2G,EAAW3G,EAAW,EAED0C,EAAQgD,IAAc,GAE5ChG,GAzQyB,EAAG,EAAGN,EAAWA,GAEhC,IAAZsH,GAA6B,IAAZC,IAA2B,IAAT1G,GAEtClB,EAAI8K,UA0JR,WAEE,IAAI/M,EAAI4J,EAAWA,EAAU1G,EACzBjD,EAAI4J,EAAWA,EAAU3G,EACzB2M,EAAYpN,EAAWP,WAAW,MAClC+K,EAAO4C,EAAUC,qBAAqB9P,EAAGC,EAAG,EAAGD,EAAEC,EAAGiD,GAWxD,GAVA+J,EAAKE,aAAa,GAAK7D,GACvB2D,EAAKE,aAAa,EA/1BA,WAg2BlB0C,EAAU/C,UAAU,EAAG,EAAGxK,EAAWA,GACrCuN,EAAUlC,YAAc,IACxBkC,EAAUxC,UAAYJ,EACtB4C,EAAUE,UAAY,EACtBF,EAAUvC,YACVuC,EAAUtC,SAASvN,EAAGC,EAAGiD,EAAUA,IAGnB,IAAZK,GAAoC,OAAhBqF,EACtB,OAAOnG,EAIT,IAAI4I,EAAUrL,EAAIkD,EAAY,GAAMjD,EAAIiD,EACxC,GAAI0C,EAAQyF,GAAU/M,EAAc,EAElC,IADA,IAAI0R,EAAOtS,EAAKsB,iBAAiBqM,EAAQzF,GAChCnG,EAAI,EAAGA,GAAKuQ,EAAK/O,OAAS,EAAGxB,IACpCO,EAAI8G,KAAKC,MAAMiJ,EAAKvQ,GAAK,IACzBQ,EAAI6G,KAAKC,MAAMiJ,EAAKvQ,GAAK,IACzBoQ,EAAUlC,YAAc,GACxBkC,EAAUzC,YAAc9D,EACxBuG,EAAUE,UAAY7M,EAAS,GAC/B2M,EAAUvC,YACVuC,EAAUjC,IAAI5N,EAAIkD,EAAYA,EAAW,EAAIjD,EAAIiD,EAAYA,EAAW,EACtEA,EAAW,EAAMA,EAAS,GAAK,EAAa,EAAV4D,KAAK+G,IAAQ,GACjDgC,EAAUI,SAGd,OAAOxN,EA9LSyN,GAAa,EAAG,EAAG5N,EAAWA,IAI3CoG,GAAiB,OAATK,KACC,IAAP5F,GAAuB,GAAToF,GACftG,EAAI8K,UAqFV,WAEE,IAAIoD,EAAYnN,EAAWd,WAAW,MAClC8G,EAAS,GACToH,EAAWtJ,KAAKmE,MAAgB,IAAV/H,GACtBmN,EA1xBc,UA2xBdC,EA5xBa,UA60BjB,OAhDAH,EAAUrD,UAAU,EAAG,EAAGxK,EAAWA,GAErC6N,EAAUxC,YAAc,GACxBwC,EAAUI,aAAe,SACzBJ,EAAUK,UAAY,SACtBL,EAAUM,WAAa,GACvBN,EAAUO,YAAc,qBACxBP,EAAUQ,KAAO,QAAUP,EAAW,qBAGtCD,EAAUxC,YAAc,GACxBwC,EAAUM,WAAa,EACvBN,EAAUO,YAAc,yBACxBP,EAAU9C,UAAYiD,EACtBtH,EAAUF,EACVqH,EAAU7C,YACV6C,EAAUS,SAAS5H,EAAoB,EAAX9F,EAAyB,IAAXA,GAE1C8F,EAAU,IACVmH,EAAU7C,YACV6C,EAAUS,SAAS5H,EAAoB,EAAX9F,EAAyB,IAAXA,GAE1CiN,EAAUJ,UAAmB,GAAT7M,EACpBiN,EAAU/C,YAAckD,EACxBH,EAAU7C,YACV6C,EAAUf,OAAkB,GAAXlM,EAA2B,KAAXA,GACjCiN,EAAUd,OAAkB,IAAXnM,EAA2B,KAAXA,GACjCiN,EAAUb,YACVa,EAAUF,SAIVjH,EAAUH,EACVsH,EAAU9C,UAAYgD,EACtBF,EAAU7C,YACV6C,EAAUS,SAAS5H,EAAoB,EAAX9F,EAAyB,GAAXA,GAE1C8F,EAAU,IACVmH,EAAU7C,YACV6C,EAAUS,SAAS5H,EAAoB,EAAX9F,EAAyB,IAAXA,GAE1CiN,EAAUJ,UAAmB,GAAT7M,EACpBiN,EAAU/C,YAAciD,EACxBF,EAAU7C,YACV6C,EAAUf,OAAkB,IAAXlM,EAA2B,KAAXA,GACjCiN,EAAUd,OAAkB,IAAXnM,EAA2B,IAAXA,GACjCiN,EAAUb,YACVa,EAAUF,SACHjN,EA5IW6N,GAAa,EAAG,EAAGvO,EAAWA,GAIhDL,EAAI8K,UAygBN,WACE,IAAI+D,EAAcjO,EAAaX,WAAW,MACtClC,EAAe,IAAXkD,EACJjD,EAAe,IAAXiD,EAIR,GAFA4N,EAAYhE,UAAU,EAAG,EAAGxK,EAAWA,GAEvB,KAAZ0G,EACF,OAAOnG,EAETiO,EAAYL,WAAa,GACzBK,EAAYJ,YAAc,2BAC1BI,EAAYC,cAAgB,EAC5BD,EAAYE,cAAgB,EAE5BF,EAAYnD,YAAc,GAC1BmD,EAAYzD,UAAY5D,EACxBwH,GAAcH,EAAa9Q,EAAGC,EAAc,IAAXiD,EAA2B,EAAXA,EAAcA,EAAS,IAExE,IAAIkN,EAAWtJ,KAAKmE,MAAiB,IAAX/H,GAa1B,OAZA4N,EAAYL,WAAa,EACzBK,EAAYC,cAAgB,EAC5BD,EAAYE,cAAgB,EAC5BF,EAAYJ,YAAc,mBAC1BI,EAAYH,KAAO,QAAUP,EAAW,qBACxCU,EAAYnD,YAAc,EAC1BmD,EAAYzD,UAAYjE,EACxB0H,EAAYP,aAAe,SAC3BO,EAAYN,UAAY,SACxBM,EAAYxD,YACZwD,EAAYF,SAAS5H,EAAoB,EAAX9F,EAAyB,EAAXA,GAErCL,EAziBOqO,GAAe,EAAG,EAAG5O,EAAWA,IAGjC,IAATa,GACFlB,EAAI8K,UAmBR,WAEE,IAAIoE,EAAYpO,EAAWb,WAAW,MACtCiP,EAAUrE,UAAU,EAAG,EAAGxK,EAAWA,GACrC6O,EAAUxD,YAAc,GACxBwD,EAAU9D,UAAY,UACtB8D,EAAU5D,SAAS,EAAG,EAAGjL,EAAWA,GAGpC,IAAItC,EAAe,EAAXkD,EACJjD,EAAe,IAAXiD,EACRiO,EAAUV,WAAa,GACvBU,EAAUT,YAAc,qBACxBS,EAAUJ,cAAgB,EAC1BI,EAAUH,cAAgB,EAC1BG,EAAUxD,YAAc,GACxBwD,EAAU9D,UAAY5D,EACtB0H,EAAU7D,YACV2D,GAAcE,EAAWnR,EAAGC,EAAc,EAAXiD,EAAyB,EAAXA,EAAcA,EAAS,IACpEiO,EAAUT,YAAc,mBACxBS,EAAUV,WAAa,EACvBU,EAAUJ,cAAgB,EAC1BI,EAAUH,cAAgB,EAM1B,IAAIZ,EAAWtJ,KAAKmE,MAAiB,GAAX/H,GACtB8F,EAAU,OAuBd,OAtBAA,GAAUG,EAAS,IAAI,EAAG,IAAI,GAC9BgI,EAAUV,WAAa,EACvBU,EAAUJ,cAAgB,EAC1BI,EAAUH,cAAgB,EAC1BG,EAAUT,YAAc,mBACxBS,EAAUR,KAAO,QAAUP,EAAW,qBACtCe,EAAUxD,YAAc,EACxBwD,EAAU9D,UAAYjE,EACtB+H,EAAUZ,aAAe,SACzBY,EAAUX,UAAY,SACtBW,EAAU7D,YACV6D,EAAUP,SAAS5H,EAAoB,EAAX9F,EAAyB,EAAXA,GAE1C8F,EAAU,WACVoH,EAAWtJ,KAAKmE,MAAiB,EAAX/H,GACtBiO,EAAUR,KAAO,QAAUP,EAAW,qBACtCe,EAAU9D,UAAY5D,EACtB0H,EAAUV,WAAa,EACvBU,EAAU7D,YACV6D,EAAUP,SAAS5H,EAAoB,EAAX9F,EAAyB,EAAXA,GAGnCH,EAvESqO,GAAa,EAAG,EAAG9O,EAAWA,GA6PhD,SAASoN,GAAU2B,EAAOrR,EAAGC,EAAGF,EAAQ0P,GACtC,IAAIxB,EAGJ,GAAe,IAAXlO,EACF,OAAOsR,EAEPpD,EADSlO,EAAS,EACRyJ,EAEAD,EAGZ,IA/PI+H,EA+PArE,EAAOhL,EAAIiL,qBAAqBlN,EAAGC,EAAGD,EAAIkD,EAAUjD,EAAIiD,GAC5D+J,EAAKE,aAAa,EAAG,sBACrBF,EAAKE,aAAa,GAAKc,GACvBhB,EAAKE,aAAa,EAAGc,GAErBoD,EAAMZ,WAAa,GACnBY,EAAMX,YAAc,mBACpBW,EAAMN,cAAgB,EACtBM,EAAML,cAAgB,EACtBK,EAAMhE,UAAYJ,EAClBoE,EAAM/D,YACN2D,GAAcI,EAAOrR,EAAIkD,EAAW,GAAIjD,EAAIiD,EAAW,GAAIA,EAAW,EAAIA,EAAW,EAAGA,EAAW,EAAIA,EAAW,EAAGA,EAAS,IAE9HmO,EAAMX,YAAc,mBACpBW,EAAMZ,WAAa,EACnBY,EAAMN,cAAgB,EACtBM,EAAML,cAAgB,EAGlB3J,IACFgK,EAAM1D,YAAc,IACpB0D,EAAME,OACNF,EAAMG,OACNH,EAAMtE,WAtRJuE,EAASxO,EAAQZ,WAAW,MAC5BmF,GACFiK,EAAOvE,UAAU5F,EAAQ,EAAG,EAAG7E,EAAUgB,EAAOhB,EAAUgB,EAAO,EAAG,EAAGhB,EAAWA,GAE7EQ,GAkRyB9C,EAAIkD,EAAW,GAAIjD,EAAIiD,EAAW,GAAIA,EAAW,EAAIA,EAAW,EAAGA,EAAW,EAAIA,EAAW,GAC3HmO,EAAMI,UACNJ,EAAM1D,YAAc,GAItB0D,EAAMhE,UAAY5D,EAElB,IAAI2G,EAAWtJ,KAAKmE,MAAiB,IAAX/H,GAC1BmO,EAAMd,aAAe,SACrBc,EAAMb,UAAY,SAClBa,EAAMV,KAAOP,EAAW,kBACxBiB,EAAM/D,YAGN+D,EAAMT,SAAS9J,KAAKgE,IAAI/K,GAASC,EAAKkD,EAAW,EAAIjD,EAAKiD,EAAW,GAGrE,IAAK,IAAIzD,EAAI,EAAGA,GAAKP,EAAOa,GAAQkB,OAAS,EAAGxB,IAC9C,GAA0B,IAAtBP,EAAOa,GAAQN,GAAnB,CAGA,IAAIiS,EAAQ1R,EAAIkD,EAAW,KAAQ4D,KAAKC,MAAM7D,EAAW,EAAIA,EAAW,GAAK,EAAK4D,KAAKC,MAAMtH,EAAI,GAC7FkS,EAAQ1R,EAAIiD,EAAW,KAAQ4D,KAAKC,MAAM7D,EAAW,EAAIA,EAAW,GAAK,EAAK4D,KAAKC,MAAMtH,EAAI,GAEjG4R,EAAMhE,UAAY5D,EAElB4H,EAAM/D,YACN+D,EAAMzD,IAAI8D,EAAOC,EAAkB,IAAXzO,EAAiB,EAAa,EAAV4D,KAAK+G,IAAQ,GACzDwD,EAAMvD,OAmBR,OAhBI2B,IACF4B,EAAMZ,WAAa,GACnBY,EAAMX,YAAc,mBACpBW,EAAM1D,YAAc,EACpB0D,EAAMhE,UAAY5D,EAClB2G,EAAWtJ,KAAKmE,MAAiB,GAAX/H,GACtBmO,EAAMd,aAAe,SACrBc,EAAMb,UAAY,SAClBa,EAAMV,KAAO,UAAYP,EAAW,iBACpCiB,EAAM/D,YACN+D,EAAMT,SAAS9J,KAAKgE,IAAI/K,GAASC,EAAKkD,EAAW,EAAIjD,EAAKiD,EAAW,GACrEmO,EAAM1D,YAAc,EACpB0D,EAAMX,YAAc,mBACpBW,EAAMZ,WAAa,GAGdY,EAGT,SAASJ,GAAchP,EAAKjC,EAAGC,EAAG2K,EAAGkE,EAAG7C,GACtChK,EAAIqL,YACJrL,EAAImN,OAAOpP,EAAIiM,EAAGhM,GAClBgC,EAAIoN,OAAOrP,EAAI4K,EAAIqB,EAAGhM,GACtBgC,EAAI2L,IAAI5N,EAAI4K,EAAIqB,EAAGhM,EAAIgM,EAAGA,EAAa,IAAVnF,KAAK+G,GAAU,GAAG,GAC/C5L,EAAIoN,OAAOrP,EAAI4K,EAAG3K,EAAI6O,EAAI7C,GAC1BhK,EAAI2L,IAAI5N,EAAI4K,EAAIqB,EAAGhM,EAAI6O,EAAI7C,EAAGA,EAAG,EAAa,GAAVnF,KAAK+G,IAAU,GACnD5L,EAAIoN,OAAOrP,EAAIiM,EAAGhM,EAAI6O,GACtB7M,EAAI2L,IAAI5N,EAAIiM,EAAGhM,EAAI6O,EAAI7C,EAAGA,EAAa,GAAVnF,KAAK+G,GAAU/G,KAAK+G,IAAI,GACrD5L,EAAIoN,OAAOrP,EAAGC,EAAIgM,GAClBhK,EAAI2L,IAAI5N,EAAIiM,EAAGhM,EAAIgM,EAAGA,EAAGnF,KAAK+G,GAAc,IAAV/G,KAAK+G,IAAU,GACjD5L,EAAIqN,YACJrN,EAAI6L,OA4MN,SAASrG,KACP4C,KAEAzI,SAASC,cAAc,SAAS0J,UAAY,SAAW1C,EAAY,KACnEjH,SAASC,cAAc,QAAQ0J,UAAY,SAAWzC,EAAW,KACjElH,SAASC,cAAc,SAAS0J,UAAY,IAAOtC,EAAU2I,QAAQ,GAAM,OACnD,IAApBzL,EAASlF,SACG,GAAV8H,GACFC,EAAU,WACVpE,EAAQE,QAAQ,SAAWlD,SAASC,cAAc,UAAUmD,MAC1DC,SAASL,EAAQC,QAAQ,SAAWjD,SAASC,cAAc,UAAUmD,QAAU,GACjF6M,OACoB,GAAX9I,GACTC,EAAU,cACVpE,EAAQE,QAAQ,SAAWlD,SAASC,cAAc,UAAUmD,MAAO,GACnE6M,MACoB,IAAX9I,IAEPC,EADEW,EAASmI,KAAKC,UAAUnM,KAxrCZ,EAyrCJ,mBAEA,aAEZiM,OAIAjN,EAAQC,QAAQ,SAAWjD,SAASC,cAAc,UAAUmD,OAAS,EACvEpD,SAASC,cAAc,SAAS0J,UAAY3G,EAAQC,QAAQ,SAAWjD,SAASC,cAAc,UAAUmD,OAAS,QAEjHpD,SAASC,cAAc,SAAS0J,UAAY,GAOhD,SAASsG,KACiB,IAApB1L,EAASlF,SACXW,SAASC,cAAc,gBAAgBC,UAAUC,OAAO,QACxDH,SAASC,cAAc,kBAAkBC,UAAUC,OAAO,SAM9D,SAASsI,KACP,IAoEiBnM,EACb8T,EArEA5S,EAAO,EACPC,EAAO,EACP4S,EAAU,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAC9BC,EAAa,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAErC,IAAK,IAAIzS,KAAKwS,EACc,EAAtBrM,EAAQqM,EAAQxS,IAAU,IAC5BL,GAAQwG,EAAQqM,EAAQxS,KAG5B,IAAK,IAAIA,KAAKyS,GACkB,EAA1BtM,EAAQsM,EAAWzS,IAAW,IAChCJ,GAAQuG,EAAQsM,EAAWzS,KAG3BL,GAAQ,EACV2J,EAAS,EACA1J,IAAS,IAClB0J,GAAU,GAwBd,SAAoB7K,GAClB,IAAIyB,GAAQ,EACRC,GAAQ,EACZ,IAAK,IAAIC,KAAa3B,EACpB,GAAyB,IAArBA,EAAM2B,KAIa,IADTnC,EAAKsB,iBAAiBa,EAAW3B,GACnC+C,SACN/C,EAAM2B,GAAa,EACrBF,GAAQ,EACCzB,EAAM2B,GAAa,IAC5BD,GAAQ,IAGRD,GAASC,GACX,OAAO,EAGX,OAAO,EAvCHN,CAAWsG,GACTkB,KAAKgE,IAAI1L,GAAQ0H,KAAKgE,IAAIzL,GAC5B0J,EAAS,EACAjC,KAAKgE,IAAI1L,GAAQ0H,KAAKgE,IAAIzL,GACnC0J,GAAU,EACDjC,KAAKgE,IAAI1L,IAAS0H,KAAKgE,IAAIzL,KACpC0J,EAAS,IAGgB,IAqCZ7K,EArCD0H,EAsCZoM,EAAWF,KAAKC,UAAU7T,QACH6G,IAAvB4E,EAASqI,IACXrI,EAASqI,GAAY,GACd,IAEPrI,EAASqI,IAAa,EAEpBrI,EAASqI,IAjyCO,MAqvChBjJ,EAAS,GAGbF,EAAY/B,KAAKgE,IAAI1L,GACrB0J,EAAWhC,KAAKgE,IAAIzL,GAiEtB,SAASoG,KACP,IAAI0M,EAAM,GACV,GAAI,EAAIvQ,SAASwQ,SAASC,OAAOpR,OAE/B,IADA,IAAIqR,EAAW1Q,SAASwQ,SAASC,OAAOE,UAAU,GAAGzM,MAAM,KAClDrG,EAAI,EAAGA,EAAI6S,EAASrR,OAAQxB,IAAK,CACxC,IAAI+S,EAAQF,EAAS7S,GAAGqG,MAAM,KAC1B2M,EAAMC,mBAAmBF,EAAM,IAC/BxN,EAAQ0N,mBAAmBF,EAAM,IACrCL,EAAIM,GAAOC,mBAAmB1N,GAGlC,OAAOmN,EAgET,SAASQ,GAAUrM,GACjB,IAAIF,EAAS,GAIb,IAAK,IAAI3G,KAAK6G,EAAY,CACxB,IAAIM,EAAON,EAAW7G,GAAG,GACrBoH,EAAKP,EAAW7G,GAAG,GACnBmT,EAAU9L,KAAKC,MAAMF,EAAK,IAAOC,KAAKC,MAAMH,EAAO,IACnDiM,EAAU/L,KAAKC,MAAMF,EAAK,IAAOC,KAAKC,MAAMH,EAAO,IACnDF,EAAM,IACK,IAAXkM,IAA2B,IAAXC,IAAgBnM,EAAM,KAC5B,IAAVkM,IAA0B,IAAXC,IAAgBnM,EAAM,KAC3B,IAAVkM,IAA0B,IAAXC,IAAgBnM,EAAM,MAC1B,IAAXkM,GAA0B,IAAVC,IAAenM,EAAM,KAC3B,IAAVkM,GAAyB,IAAVC,IAAenM,EAAM,KAC1B,IAAVkM,GAAyB,IAAVC,IAAenM,EAAM,MACzB,IAAXkM,GAA0B,IAAVC,IAAenM,EAAM,KAC3B,IAAVkM,GAAyB,IAAVC,IAAenM,EAAM,KAC1B,IAAVkM,GAAyB,IAAVC,IAAenM,EAAM,KACxCN,GAAUQ,EAAOF,EAEnB,OAAON,EAMT,SAASvC,KACPiG,EAAa,EACbvB,GAAQ,EACR3C,EAAUlI,EAAKO,QAAQkI,EAAS2D,IAChCf,EAAO,KACPL,GAAO,EACPjB,KACAH,IAAM,GAAO,GAMf,SAASxD,KACHgG,GAAc,IAClBvB,GAAQ,EACRuB,GAAc,EACdlE,EAAUlI,EAAKO,QAAQkI,EAAS2D,IAChCf,EAAO,KACPL,GAAO,EACPjB,KACAH,IAAM,GAAO,IAMf,SAASvD,KACH+F,EAAa,EAAI3D,EAASlF,OAAS,IACvC6I,GAAc,EACdlE,EAAUlI,EAAKO,QAAQkI,EAAS2D,IAChCrC,KACAH,IAAM,GAAO,IAMf,SAAStD,KACP8F,EAAa3D,EAASlF,OAAS,EAC/BsH,GAAQ,EACR3C,EAAUlI,EAAKO,QAAQkI,EAAS2D,IAChCrC,KACAH,IAAM,GAAO,GAMf,SAASnD,KACP,IAAI2O,EAAMlR,SAASwQ,SAASW,KAAKjN,MAAM,KAAK,GAG5C,IAAU,IAAP3C,EAAH,CAMA,IAAIqC,EAAWC,KACXD,EAASwN,OACXF,GAAO,SAAWtN,EAASwN,MAEzBhL,UAAUiL,OACZb,SAASW,KAAOD,GAEhBlN,EAAUlI,EAAKO,QAAQyH,GACvBf,KACAoF,EAAY,GACZf,EAAU,GACVD,EAAS,KACTzK,EAAc,EACdgJ,IAAM,GAAO,SAlBb7D,GAAc,MAyBlB,SAASQ,KACP,IAAI6O,EAAMlR,SAASwQ,SAASW,KAAKjN,MAAM,KAAK,GACxCtE,EAAO,SAAWkE,EAAS,IAAM,IACpCA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,GAAK,IACdA,EAAS,IAAM,IACfA,EAAS,IACNQ,EAAM,QAAUyM,GAAU5I,GAC9B7D,GAAO,OAAStE,SAASC,cAAc,UAAUmD,MACjDoN,SAASW,KAAOD,EAAMtR,EAAO0E,EAK/B,SAAShC,KACP,IAAI4O,EAAMlR,SAASwQ,SAASW,KAAKjN,MAAM,KAAK,GACxCtE,EAAO,SAAWkE,EAAS,IAAM,IACpCA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,IAAM,IACfA,EAAS,GAAK,IACdA,EAAS,IAAM,IACfA,EAAS,IACNQ,EAAM,UAAYyM,GAAU5I,GAChC7D,GAAO,SAAWtE,SAASC,cAAc,UAAUmD,MACnDhH,OAAOkV,KAAK,yCAA2CJ,EAAMtR,EAAO0E,EAAM,kBA3/C5D,OAAZtB,KAEFA,EAAU,IACFC,QAAU,aAClBD,EAAQE,QAAU,aAEdkD,UAAUmL,gBACZvO,EAAQwO,QAAU,SAAUC,GAC1B,OAAQ,IAAIC,OAAO,cAAgBC,OAAOF,GAAM5M,QAAQ,cAAe,QAAU,WAAYiE,KAAK9I,SAAS4R,SAE7G5O,EAAQC,QAAU,SAAUwO,GAC1B,OAAKA,GAAU,IAAIC,OAAO,cAAgBC,OAAOF,GAAM5M,QAAQ,cAAe,QAAU,WAAYiE,KAAK9I,SAAS4R,QAC3GC,SAAS7R,SAAS4R,OAAO/M,QAAQ,IAAI6M,OAAO,gBAAkBC,OAAOF,GAAM5M,QAAQ,cAAe,QAAU,sCAAuC,OADtB,MAGtI7B,EAAQE,QAAU,SAAUuO,EAAMK,GAC3BL,IAAQ,6CAA6C3I,KAAK2I,KAC/DzR,SAAS4R,OAASD,OAAOF,GAAQ,IAAME,OAAOG,OApKpD,EAwqDU,GAAGC,MAAQrS,KAKvBM,SAAS4B,iBAAiB,oBAAoB,WAC5CjC,YAAYC,W","file":"main.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","/* @license Copyright (c) @kurehajime / source code: https://github.com/kurehajime/colamone_js */\r\n'use strict';\r\n// Class ------------------------------------------------\r\nexport function Aijs() { }\r\n// Header -----------------------------------------------\r\nAijs.copyMap = copyMap;\r\nAijs.thinkAI = thinkAI;\r\nAijs.getCanMovePanelX = getCanMovePanelX;\r\nAijs.isEndX = isEndX;\r\nAijs.isDraw = isDraw;\r\n// Body ---------------------------------------\r\n/**\r\n * 駒の進める方向\r\n * @const\r\n * @type {Array.<Array.<number>>}\r\n * index+8:コマの数字\r\n */\r\nvar PIECES = [\r\n    [0, 0, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 0, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [0, 0, 0,\r\n        0, 0, 0,\r\n        0, 0, 0],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 0, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 0, 0]\r\n];\r\n/**\r\n * 盤の番号\r\n * @const\r\n * @type {Array.<number>}\r\n */\r\nvar NUMBERS = [0, 1, 2, 3, 4, 5,\r\n    10, 11, 12, 13, 14, 15,\r\n    20, 21, 22, 23, 24, 25,\r\n    30, 31, 32, 33, 34, 35,\r\n    40, 41, 42, 43, 44, 45,\r\n    50, 51, 52, 53, 54, 55];\r\n/**\r\n * 初期評価関数\r\n * @const\r\n * @type {Object.<number, Array.<number>>}\r\n */\r\nvar DEFAULT_EVALPARAM = [\r\n    [],\r\n    [1800, 1850, 1900, 1950, 2100, 2800],\r\n    [1800, 1860, 1920, 2100, 2400, 3800],\r\n    [1450, 1520, 1590, 1900, 2350, 4450],\r\n    [1450, 1530, 1610, 2050, 2650, 5450],\r\n    [1350, 1440, 1530, 2100, 2850, 6350],\r\n    [1350, 1450, 1550, 2250, 3150, 7350],\r\n    [1250, 1360, 1470, 2300, 3350, 8250],\r\n    [1250, 1370, 1490, 2450, 4350, 11250] //8\r\n];\r\n/**\r\n * Mapをコピーして返す。\r\n * @param  {Object.<number, number>}  wkMap\r\n * @return {Object.<number, number>}\r\n */\r\nfunction copyMap(wkMap) {\r\n    return new Int8Array(wkMap);\r\n}\r\n/**\r\n * 終了判定(実質的勝利含む)\r\n * @param  {Object.<number, number>}  wkMap\r\n * @param  {boolean}  nearwin\r\n * @return {number} 0:引き分け,1:先手勝利,-1:後手勝利\r\n */\r\nfunction isEndX(wkMap, nearwin) {\r\n    var sum1 = 0;\r\n    var sum2 = 0;\r\n    // ループだと遅いので展開\r\n    if (wkMap[0] > 0) {\r\n        sum1 += wkMap[0];\r\n    }\r\n    if (wkMap[10] > 0) {\r\n        sum1 += wkMap[10];\r\n    }\r\n    if (wkMap[20] > 0) {\r\n        sum1 += wkMap[20];\r\n    }\r\n    if (wkMap[30] > 0) {\r\n        sum1 += wkMap[30];\r\n    }\r\n    if (wkMap[40] > 0) {\r\n        sum1 += wkMap[40];\r\n    }\r\n    if (wkMap[50] > 0) {\r\n        sum1 += wkMap[50];\r\n    }\r\n    if (wkMap[5] * -1 > 0) {\r\n        sum2 += wkMap[5];\r\n    }\r\n    if (wkMap[15] * -1 > 0) {\r\n        sum2 += wkMap[15];\r\n    }\r\n    if (wkMap[25] * -1 > 0) {\r\n        sum2 += wkMap[25];\r\n    }\r\n    if (wkMap[35] * -1 > 0) {\r\n        sum2 += wkMap[35];\r\n    }\r\n    if (wkMap[45] * -1 > 0) {\r\n        sum2 += wkMap[45];\r\n    }\r\n    if (wkMap[55] * -1 > 0) {\r\n        sum2 += wkMap[55];\r\n    }\r\n    if (sum1 >= 8) {\r\n        return 1;\r\n    }\r\n    else if (sum2 <= -8) {\r\n        return -1;\r\n    }\r\n    // 手詰まりは判定\r\n    if (isNoneNode(wkMap)) {\r\n        if (sum1 > (-1 * sum2)) {\r\n            return 1;\r\n        }\r\n        else if (sum1 < (-1 * sum2)) {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    }\r\n    // 実質的判定勝利\r\n    if (nearwin === false && (sum1 !== 0 || sum2 !== 0)) {\r\n        var live1 = 0;\r\n        var live2 = 0;\r\n        for (var i = 0; i <= 35; i++) {\r\n            var num = NUMBERS[i] | 0;\r\n            if (wkMap[num] > 0) {\r\n                live1 += wkMap[num];\r\n            }\r\n            else if (wkMap[num] < 0) {\r\n                live2 += wkMap[num];\r\n            }\r\n        }\r\n        if (sum1 > (-1 * (live2 + sum2))) {\r\n            return 1;\r\n        }\r\n        else if (-1 * sum2 > (live1 + sum1)) {\r\n            return -1;\r\n        }\r\n    }\r\n    return 0;\r\n}\r\n/**\r\n * 引き分け判定。最後の一個を取るかどうかの判断\r\n * @param  {Object.<number, number>}  wkMap\r\n * @return {boolean}\r\n */\r\nfunction isDraw(wkMap) {\r\n    var sum1 = 0;\r\n    var sum2 = 0;\r\n    // ループだと遅いので展開\r\n    if (wkMap[0] > 0) {\r\n        sum1 += wkMap[0];\r\n    }\r\n    if (wkMap[10] > 0) {\r\n        sum1 += wkMap[10];\r\n    }\r\n    if (wkMap[20] > 0) {\r\n        sum1 += wkMap[20];\r\n    }\r\n    if (wkMap[30] > 0) {\r\n        sum1 += wkMap[30];\r\n    }\r\n    if (wkMap[40] > 0) {\r\n        sum1 += wkMap[40];\r\n    }\r\n    if (wkMap[50] > 0) {\r\n        sum1 += wkMap[50];\r\n    }\r\n    if (wkMap[5] * -1 > 0) {\r\n        sum2 -= wkMap[5];\r\n    }\r\n    if (wkMap[15] * -1 > 0) {\r\n        sum2 -= wkMap[15];\r\n    }\r\n    if (wkMap[25] * -1 > 0) {\r\n        sum2 -= wkMap[25];\r\n    }\r\n    if (wkMap[35] * -1 > 0) {\r\n        sum2 -= wkMap[35];\r\n    }\r\n    if (wkMap[45] * -1 > 0) {\r\n        sum2 -= wkMap[45];\r\n    }\r\n    if (wkMap[55] * -1 > 0) {\r\n        sum2 -= wkMap[55];\r\n    }\r\n    if (sum1 === sum2) {\r\n        if (!isNoneNode(wkMap)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * 手詰まり判定\r\n * @param  {Object.<number, number>}  wkMap\r\n * @return {boolean}\r\n */\r\nfunction isNoneNode(wkMap) {\r\n    var flag1 = false;\r\n    var flag2 = false;\r\n    for (var i = 0; i <= 35; i++) {\r\n        var panel_num = NUMBERS[i] | 0;\r\n        if (wkMap[panel_num] === 0) {\r\n            continue;\r\n        }\r\n        var canMove = hasCanMovePanelX(panel_num, wkMap);\r\n        if (canMove === true) {\r\n            if (wkMap[panel_num] > 0) {\r\n                flag1 = true;\r\n            }\r\n            else if (wkMap[panel_num] < 0) {\r\n                flag2 = true;\r\n            }\r\n        }\r\n        if (flag1 && flag2) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * 動かせるマスを返す。Return:[NN,NN,NN...]\r\n * @param  {number}  panel_num\r\n * @param  {Object.<number, number>}  wkMap\r\n * @return {boolean}\r\n */\r\nfunction hasCanMovePanelX(panel_num, wkMap) {\r\n    var number = wkMap[panel_num] | 0;\r\n    var x = ~~(panel_num / 10); // [~~]=Math.floor \r\n    var y = ~~(panel_num % 10);\r\n    // アガリのコマは動かしたらダメ。何も無いマスも動かしようがない。\r\n    if ((number > 0 && y === 0) || (number < 0 && y === 5) || number === 0) {\r\n        return false;\r\n    }\r\n    for (var i = 0; i < 9; i++) {\r\n        if (PIECES[number + 8][i] === 0) {\r\n            continue;\r\n        }\r\n        var target_x = x + ~~(i % 3) - 1;\r\n        var target_y = y + ~~(i / 3) - 1;\r\n        if (target_y < 0 || target_y > 5 || target_x > 5 || target_x < 0) {\r\n            continue;\r\n        }\r\n        var idx = target_x * 10 + target_y;\r\n        var target_number = wkMap[idx];\r\n        // 自コマとアガリのコマはとったらダメ。\r\n        if ((target_number * number > 0) || (target_number > 0 && target_y === 0) || (target_number < 0 && target_y === 5)) {\r\n            continue;\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * 動かせるマスを返す。Return:[NN,NN,NN...]\r\n * @param  {number}  panel_num\r\n * @param  {Object.<number, number>}  wkMap\r\n * @return {Array.<number, number>}\r\n */\r\nfunction getCanMovePanelX(panel_num, wkMap) {\r\n    var number = wkMap[panel_num] | 0;\r\n    var x = ~~(panel_num / 10); // [~~]=Math.floor \r\n    var y = ~~(panel_num % 10);\r\n    var canMove = [];\r\n    // アガリのコマは動かしたらダメ。何も無いマスも動かしようがない。\r\n    if ((number > 0 && y === 0) || (number < 0 && y === 5) || number === 0) {\r\n        return canMove;\r\n    }\r\n    for (var i = 0; i < 9; i++) {\r\n        if (PIECES[number + 8][i] === 0) {\r\n            continue;\r\n        }\r\n        var target_x = x + ~~(i % 3) - 1;\r\n        var target_y = y + ~~(i / 3) - 1;\r\n        if (target_y < 0 || target_y > 5 || target_x > 5 || target_x < 0) {\r\n            continue;\r\n        }\r\n        var idx = target_x * 10 + target_y;\r\n        var target_number = wkMap[idx] | 0;\r\n        // 自コマとアガリのコマはとったらダメ。\r\n        if ((target_number * number > 0) || (target_number > 0 && target_y === 0) || (target_number < 0 && target_y === 5)) {\r\n            continue;\r\n        }\r\n        canMove.push(idx);\r\n    }\r\n    return canMove;\r\n}\r\n/**\r\n * 起こりうる次の一手を返す。Return:[[q,map0],[qmap1],[q,map2]...] //q=[prev,next]\r\n * @param  {Object.<number, number>}  wkMap\r\n * @param  {number}  turn_player\r\n * @return {Array.<number,Array.<Array.<number, number>, Object.<number, number>>>}\r\n */\r\nfunction getNodeMap(wkMap, turn_player) {\r\n    var nodeList = [];\r\n    for (var i = 0; i <= 35; i++) {\r\n        var panel_num = NUMBERS[i] | 0;\r\n        if (wkMap[panel_num] * turn_player <= 0 || wkMap[panel_num] === 0) {\r\n            continue;\r\n        }\r\n        var canMove = getCanMovePanelX(panel_num, wkMap);\r\n        for (var num = 0; num < canMove.length; num++) {\r\n            var nodeMap = new Int8Array(wkMap);\r\n            nodeMap[canMove[num]] = nodeMap[panel_num];\r\n            nodeMap[panel_num] = 0;\r\n            nodeList.push([[panel_num, canMove[num]], nodeMap]);\r\n        }\r\n    }\r\n    return nodeList;\r\n}\r\n/**\r\n * 盤面を評価して-10000〜+10000で採点数する。\r\n * @param  {Object.<number, number>}  wkMap\r\n * @param  {boolean}  nearwin\r\n * @param  {Object.<number, Array.<number>>}  evalparam\r\n * @return {number}\r\n */\r\nfunction evalMap(wkMap, nearwin, evalparam) {\r\n    var ev = 0;\r\n    // 引き分け判定\r\n    if (isDraw(wkMap)) {\r\n        return 0;\r\n    }\r\n    // 終局判定\r\n    var end = isEndX(wkMap, nearwin);\r\n    if (end === 1) {\r\n        return +9999999;\r\n    }\r\n    else if (end === -1) {\r\n        return -9999999;\r\n    }\r\n    // 評価\r\n    for (var i = 0; i <= 35; i++) {\r\n        var panel_num = NUMBERS[i] | 0;\r\n        var cell_p = 0;\r\n        var p = wkMap[panel_num];\r\n        var line = void 0;\r\n        // コマの評価値を加算\r\n        if (p > 0) {\r\n            line = 5 - (panel_num % 10);\r\n            cell_p += evalparam[p][line]; // ポジションボーナス\r\n        }\r\n        else if (p < 0) {\r\n            line = (panel_num % 10);\r\n            cell_p += evalparam[-1 * p][line] * -1;\r\n        }\r\n        // 評価値に加算。\r\n        ev += cell_p;\r\n    }\r\n    return (ev | 0);\r\n}\r\n/**\r\n * よく考える\r\n */\r\nfunction deepThinkAllAB(map, turn_player, depth, a, b, nearwin, evalparam) {\r\n    var best_score = turn_player * 9999999 * -1;\r\n    var besthand;\r\n    if (depth === 0) {\r\n        best_score = evalMap(map, nearwin, evalparam);\r\n        return [besthand, best_score];\r\n    }\r\n    if (a === void 0 || b === void 0) {\r\n        a = 9999999 * turn_player * -1;\r\n        b = 9999999 * turn_player;\r\n    }\r\n    var nodeList = getNodeMap(map, turn_player);\r\n    for (var i = 0; i < nodeList.length; i++) {\r\n        var hand = nodeList[i][0];\r\n        var map0 = nodeList[i][1];\r\n        var sc = 0;\r\n        // 必勝            \r\n        var end = isEndX(map0, nearwin);\r\n        if (end === turn_player) {\r\n            return [hand, 999999 * turn_player];\r\n        }\r\n        // 必敗\r\n        if (end === turn_player * -1) {\r\n            if (besthand === void 0) {\r\n                best_score = 999999 * turn_player * -1;\r\n                besthand = hand;\r\n            }\r\n            continue;\r\n        }\r\n        if (isNoneNode(map0)) {\r\n            sc = 0;\r\n        }\r\n        else {\r\n            sc = deepThinkAllAB(map0, turn_player * -1, depth - 1, b, a, nearwin, evalparam)[1];\r\n        }\r\n        if (besthand === void 0) {\r\n            best_score = sc;\r\n            besthand = hand;\r\n        }\r\n        if (turn_player === 1 && sc > best_score) {\r\n            best_score = sc;\r\n            besthand = hand;\r\n        }\r\n        else if (turn_player === -1 && sc < best_score) {\r\n            best_score = sc;\r\n            besthand = hand;\r\n        }\r\n        if (turn_player === 1 && a < best_score || turn_player === -1 && a > best_score) {\r\n            a = best_score;\r\n        }\r\n        if (turn_player === 1 && b <= best_score || turn_player === -1 && b >= best_score) {\r\n            break;\r\n        }\r\n    }\r\n    return [besthand, best_score];\r\n}\r\n/**\r\n * 考える\r\n */\r\nfunction thinkAI(map, turn_player, depth, a, b, evalparam) {\r\n    var nearwin = false;\r\n    var hand = [null, null];\r\n    var wkMap = new Int8Array(map);\r\n    if (!evalparam) {\r\n        evalparam = DEFAULT_EVALPARAM;\r\n    }\r\n    if (isEndX(wkMap, false) !== 0) {\r\n        nearwin = true;\r\n    }\r\n    hand = deepThinkAllAB(wkMap, turn_player, depth, a, b, nearwin, evalparam);\r\n    if (hand[1] * turn_player === -999999) {\r\n        hand = deepThinkAllAB(wkMap, turn_player, 1, a, b, nearwin, evalparam);\r\n    }\r\n    return hand;\r\n}\r\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","/* @license Copyright (c) @kurehajime / source code: https://github.com/kurehajime/colamone_js */\r\nimport { Aijs } from \"./ai\";\r\n\r\n/** \r\n * BoardGamejs名前空間 \r\n */\r\n; (function (global) {\r\n  'use strict';\r\n\r\n  // Class ------------------------------------------------\r\n  function BoardGamejs() { }\r\n\r\n  // Header -----------------------------------------------\r\n  global.BoardGamejs = BoardGamejs;\r\n  global.BoardGamejs.init = init;\r\n\r\n\r\n  // Body ---------------------------------------\r\n  let ctx = null;\r\n  let isTouch = true;\r\n  let goaled=false;\r\n  let canv_board = null;\r\n  let canv_board2 = null;\r\n  let canv_focus = null;\r\n  let canv_pieces = null;\r\n  let canv_shadow = null;\r\n  let canv_hover_piece = null;\r\n  let canv_overlay = null;\r\n  let canv_bk = null;\r\n  let canv_cover = null;\r\n  let canv_score = null;\r\n  let canv_cache = null;\r\n  let cache_on = false;\r\n  let img_bk_loaded = false;\r\n  let hover_piece = null;\r\n  let cellSize = null;\r\n  let turn_player = null;\r\n  let blueScore = 0;\r\n  let redScore = 0;\r\n  let winner = null;\r\n  let message = '';\r\n  let thinktime = 0.0;\r\n  let demo = true;\r\n  let autoLog=false;\r\n  let intervalID = null;\r\n  let intervalID_log = null;  \r\n  let thisHand = [];\r\n  let demo_inc=0;\r\n  const COLOR_LINE = '#333333';\r\n  const COLOR_PANEL_1 = '#660033';\r\n  const COLOR_PANEL_2 = '#004466';\r\n  const COLOR_PANEL_3 = '#FFFFFF';\r\n  const COLOR_PANEL_4 = '#111111';\r\n  const COLOR_PANEL_5 = '#444444';\r\n  const COLOR_PANEL_6 = '#888888';\r\n  const COLOR_SELECT = '#7fed7f';\r\n  const COLOR_SELECT2='#148d14';\r\n  const COLOR_RED = '#E60073';\r\n  const COLOR_BLUE = '#0099E6';\r\n  const COLOR_RED2 = '#E60073';\r\n  const COLOR_BLUE2 = '#0099E6';\r\n  const COLOR_WHITE = '#FFFFFF';\r\n  let RATIO=1;\r\n  if( window.devicePixelRatio!==undefined&& window.devicePixelRatio!=1){\r\n    RATIO = window.devicePixelRatio;\r\n  }\r\n  let CANV_SIZE=500*RATIO;\r\n\r\n  const PIECES = {\r\n    '1': [1, 1, 1,\r\n      1, 0, 1,\r\n      1, 1, 1],\r\n    '2': [1, 1, 1,\r\n      1, 0, 1,\r\n      1, 0, 1],\r\n    '3': [1, 1, 1,\r\n      0, 0, 0,\r\n      1, 1, 1],\r\n    '4': [1, 1, 1,\r\n      0, 0, 0,\r\n      1, 0, 1],\r\n    '5': [1, 0, 1,\r\n      0, 0, 0,\r\n      1, 0, 1],\r\n    '6': [1, 0, 1,\r\n      0, 0, 0,\r\n      0, 1, 0],\r\n    '7': [0, 1, 0,\r\n      0, 0, 0,\r\n      0, 1, 0],\r\n    '8': [0, 1, 0,\r\n      0, 0, 0,\r\n      0, 0, 0],\r\n    '-1': [1, 1, 1,\r\n      1, 0, 1,\r\n      1, 1, 1],\r\n    '-2': [1, 0, 1,\r\n      1, 0, 1,\r\n      1, 1, 1],\r\n    '-3': [1, 1, 1,\r\n      0, 0, 0,\r\n      1, 1, 1],\r\n    '-4': [1, 0, 1,\r\n      0, 0, 0,\r\n      1, 1, 1],\r\n    '-5': [1, 0, 1,\r\n      0, 0, 0,\r\n      1, 0, 1],\r\n    '-6': [0, 1, 0,\r\n      0, 0, 0,\r\n      1, 0, 1],\r\n    '-7': [0, 1, 0,\r\n      0, 0, 0,\r\n      0, 1, 0],\r\n    '-8': [0, 0, 0,\r\n      0, 0, 0,\r\n      0, 1, 0]\r\n  };\r\n\r\n/*  let thisMap = {\r\n    0: -1, 10: -2, 20: -3, 30: -4, 40: -5, 50: -6,\r\n    1: 0, 11: -8, 21: 0, 31: 0, 41: -7, 51: 0,\r\n    2: 0, 12: 0, 22: 0, 32: 0, 42: 0, 52: 0,\r\n    3: 0, 13: 0, 23: 0, 33: 0, 43: 0, 53: 0,\r\n    4: 0, 14: 7, 24: 0, 34: 0, 44: 8, 54: 0,\r\n    5: 6, 15: 5, 25: 4, 35: 3, 45: 2, 55: 1\r\n  };*/\r\n  let thisMap =[\r\n    -1,0,0,0,0,6,0,0,0,0,-2,-8,\r\n    0,0,7,5,0,0,0,0,-3,0,0,0,\r\n    0,4,0,0,0,0,-4,0,0,0,0,\r\n    3,0,0,0,0,-5,-7,0,0,8,2,\r\n    0,0,0,0,-6,0,0,0,0,1\r\n  ]\r\n\r\n  let map_list = {};\r\n  const LIMIT_1000DAY = 3;\r\n  let mouse_x = 0;\r\n  let mouse_y = 0;\r\n  let startMap;\r\n  let logPointer = 0;\r\n  let logArray = [];\r\n  let logArray2 = [];\r\n  let img_bk = null;\r\n  img_bk = new Image(); img_bk.src = 'bk.gif';\r\n  let storage = null;\r\n  try {\r\n    if (window == parent && ('localStorage' in window) && window.localStorage !== null) {\r\n      storage = localStorage;\r\n      storage.setItem('test', 0); // Safariのプライベートモードは、できないのにできるって言うからかまをかけてみる。\r\n    }\r\n  } catch (e) {\r\n    storage = null;\r\n  }\r\n  if (storage === null) {\r\n    // localStorageが使えない場合\r\n    storage = {}; // ダミー\r\n    storage.getItem = function () { return undefined; };\r\n    storage.setItem = function () { return undefined; };\r\n\r\n    if (navigator.cookieEnabled) {\r\n      storage.hasItem = function (sKey) {\r\n        return (new RegExp('(?:^|;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=')).test(document.cookie);\r\n      };\r\n      storage.getItem = function (sKey) {\r\n        if (!sKey || !(new RegExp('(?:^|;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=')).test(document.cookie)) { return null; }\r\n        return unescape(document.cookie.replace(new RegExp('(?:^|.*;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*'), '$1'));\r\n      };\r\n      storage.setItem = function (sKey, sValue) {\r\n        if (!sKey || /^(?:expires|max\\-age|path|domain|secure)$/i.test(sKey)) { return; }\r\n        document.cookie = escape(sKey) + '=' + escape(sValue);\r\n      };\r\n    }\r\n  }\r\n\r\n  /** \r\n   * 初期化\r\n   */\r\n  function init() {\r\n    zoom(); // 小さい端末でズーム\r\n    if (window.innerHeight < window.innerWidth) {\r\n      document.querySelector('.manual').classList.remove(\"hide\");\r\n    } else {\r\n      document.querySelector('.manual').classList.add(\"hide\");\r\n    }\r\n    ctx = document.querySelector('#canv').getContext('2d');\r\n\r\n    canv_board = document.createElement('canvas');\r\n    canv_board.width = CANV_SIZE;\r\n    canv_board.height = CANV_SIZE;\r\n\r\n\r\n    canv_board2 = document.createElement('canvas');\r\n    canv_board2.width = CANV_SIZE;\r\n    canv_board2.height = CANV_SIZE;\r\n\r\n    canv_focus = document.createElement('canvas');\r\n    canv_focus.width = CANV_SIZE;\r\n    canv_focus.height = CANV_SIZE;\r\n\r\n    canv_pieces = document.createElement('canvas');\r\n    canv_pieces.width = CANV_SIZE;\r\n    canv_pieces.height = CANV_SIZE;\r\n\r\n    canv_shadow = document.createElement('canvas');\r\n    canv_shadow.width = CANV_SIZE;\r\n    canv_shadow.height = CANV_SIZE;\r\n\r\n    canv_hover_piece = document.createElement('canvas');\r\n    canv_hover_piece.width = CANV_SIZE;\r\n    canv_hover_piece.height = CANV_SIZE;\r\n\r\n    canv_overlay = document.createElement('canvas');\r\n    canv_overlay.width = CANV_SIZE;\r\n    canv_overlay.height = CANV_SIZE;\r\n\r\n    canv_bk = document.createElement('canvas');\r\n    canv_bk.width = CANV_SIZE;\r\n    canv_bk.height = CANV_SIZE;\r\n\r\n    canv_cover = document.createElement('canvas');\r\n    canv_cover.width = CANV_SIZE;\r\n    canv_cover.height = CANV_SIZE;\r\n\r\n    canv_score = document.createElement('canvas');\r\n    canv_score.width = CANV_SIZE;\r\n    canv_score.height = CANV_SIZE;\r\n\r\n    canv_cache = document.createElement('canvas');\r\n    canv_cache.width = CANV_SIZE;\r\n    canv_cache.height = CANV_SIZE;\r\n\r\n    cellSize = CANV_SIZE / 6;\r\n    turn_player = 1;\r\n    demo = true;\r\n\r\n    //retina対応\r\n    ctx.canvas.style.width = CANV_SIZE/RATIO + \"px\";\r\n    ctx.canvas.style.height = CANV_SIZE/RATIO + \"px\";\r\n    ctx.canvas.width = CANV_SIZE ;\r\n    ctx.canvas.height = CANV_SIZE ;\r\n\r\n    if ('ontouchstart' in window) {\r\n      isTouch = true;\r\n    } else {\r\n      isTouch = false;\r\n    }\r\n    // イベントを設定\r\n    if (isTouch) {\r\n      document.querySelector('#canv').addEventListener('touchstart', ev_mouseClick);\r\n      document.querySelector('#canv').addEventListener('touchmove', ev_touchMove);\r\n    } else {\r\n      document.querySelector('#canv').addEventListener('mousemove', ev_mouseMove);\r\n      document.querySelector('#canv').addEventListener('mouseup', ev_mouseClick);\r\n    }\r\n    document.querySelector('#level').addEventListener('change', ev_radioChange);\r\n    document.querySelector('#prevprev').addEventListener('click', move_start);\r\n    document.querySelector('#prev').addEventListener('click', move_prev);\r\n    document.querySelector('#next').addEventListener('click', move_next);\r\n    document.querySelector('#nextnext').addEventListener('click', move_end);\r\n    document.querySelector('#replay').addEventListener('click', jumpkento);\r\n    document.querySelector('#tweetlog').addEventListener('click', tweetlog);\r\n    document.querySelector('#newgame').addEventListener('click', reloadnew);\r\n    document.querySelector('#collapsible').addEventListener('click', function () {\r\n      document.querySelector('.manual').classList.toggle(\"hide\");\r\n      if (window.innerHeight > window.innerWidth) {\r\n        var element = document.documentElement;\r\n        var bottom = element.scrollHeight - element.clientHeight;\r\n        window.scroll(0, bottom);\r\n      }\r\n    });\r\n\r\n\r\n    window.addEventListener('orientationchange', zoom);\r\n\r\n    shuffleBoard();\r\n\r\n    // 連勝記録初期化\r\n    if (!storage.getItem('level_1')) {\r\n      storage.setItem('level_1', 0);\r\n    }\r\n    if (!storage.getItem('level_2')) {\r\n      storage.setItem('level_2', 0);\r\n    }\r\n    if (!storage.getItem('level_3')) {\r\n      storage.setItem('level_3', 0);\r\n    }\r\n    if (!storage.getItem('level_4')) {\r\n      storage.setItem('level_4', 0);\r\n    }\r\n    if (!storage.getItem('level_5')) {\r\n      storage.setItem('level_5', 0);\r\n    }\r\n    // レベル記憶\r\n    if (storage.getItem('level_save') !== undefined && storage.getItem('level_save') !== 'undefined' && storage.getItem('level_save') !== null) {\r\n      document.querySelector('#level').value=parseInt(storage.getItem('level_save'));\r\n    } else {\r\n      storage.setItem('level_save', 1);\r\n      document.querySelector('#level').value=1;\r\n    }\r\n\r\n    //document.querySelector('#canv').classList.add(\"hue-rotate1\");\r\n\r\n\r\n    // パラメータを取得\r\n    let paramObj = getParam();\r\n\r\n    // 盤面を初期化\r\n    if (paramObj.init) {\r\n      startMap = getMapByParam(paramObj.init);\r\n      thisMap = Aijs.copyMap(startMap);\r\n    } else {\r\n      startMap = Aijs.copyMap(thisMap);\r\n    }\r\n    // ログをデコード\r\n    if (paramObj.log) {\r\n      logArray = decodeLog(paramObj.log, startMap);\r\n    }\r\n    // レベル取得\r\n    if (paramObj.lv) {\r\n      document.querySelector('#level').value=parseInt(paramObj.lv);\r\n    }\r\n\r\n    if (logArray.length !== 0) {\r\n      document.querySelector('#log').classList.remove(\"hide\");\r\n      document.querySelector('#prevprev').classList.remove(\"hide\");\r\n      document.querySelector('#prev').classList.remove(\"hide\");\r\n      document.querySelector('#next').classList.remove(\"hide\");\r\n      document.querySelector('#nextnext').classList.remove(\"hide\");\r\n      document.querySelector('#span_replay').classList.add(\"hide\");\r\n      document.querySelector('#span_tweetlog').classList.add(\"hide\");\r\n      document.querySelector('#next').focus();\r\n    } else {\r\n      document.querySelector('#log').classList.add(\"hide\");\r\n      document.querySelector('#prevprev').classList.add(\"hide\");\r\n      document.querySelector('#prev').classList.add(\"hide\");\r\n      document.querySelector('#next').classList.add(\"hide\");\r\n      document.querySelector('#nextnext').classList.add(\"hide\");\r\n      document.querySelector('#span_replay').classList.add(\"hide\");\r\n      document.querySelector('#span_tweetlog').classList.add(\"hide\");\r\n    }\r\n\r\n    // 画像読み込み成功時\r\n    img_bk.onload = function () {\r\n      img_bk_loaded = true;\r\n      flush(true, false);\r\n    };\r\n    // 画像読み込み失敗時\r\n    img_bk.onerror = function () {\r\n      flush(true, false);\r\n    };\r\n    // もう既に読み込み終わってた時\r\n    if (img_bk.width !== 0) {\r\n      img_bk_loaded = true;\r\n      flush(true, false);\r\n    }\r\n    // 2.5秒後に強制描画※Googleの検索結果から飛ぶとなぜか描画が走らない事があるので。\r\n    setTimeout(function () {\r\n      if (img_bk.width !== 0) {\r\n        img_bk_loaded = true;\r\n      }\r\n      flush(true, false);\r\n    }, 2500);\r\n    updateMessage();\r\n    setTweet(); // ツイートボタンを生成\r\n\r\n    if (logArray.length === 0) {\r\n      if(isBot()==false){\r\n        window.setTimeout(function(){\r\n          if(demo==true){\r\n            intervalID = window.setInterval(playDemo, 400);\r\n            playDemo();\r\n          }\r\n        },500);\r\n      }\r\n    } else {\r\n      demo = false;\r\n      autoLog=true;\r\n      intervalID_log = window.setInterval(playLog, 1000);      \r\n    }\r\n    goaled=false;\r\n    flush(true, false);\r\n  }\r\n\r\n  /** \r\n   * Demoを再生\r\n   */\r\n  function playDemo() {\r\n    if (intervalID !==null) {\r\n      if (Math.random() > 0.3) {\r\n        ai(2);\r\n      } else {\r\n        ai(1);\r\n      }\r\n    }\r\n    demo_inc++;\r\n    calcScore();\r\n    flush(false, false);\r\n    if (winner === 1 || winner === -1 || winner === 0) {\r\n      goaled=true;\r\n      winner = null;\r\n      flush(false, false);\r\n      shuffleBoard();\r\n    }\r\n    if(demo_inc>42){\r\n      window.clearInterval(intervalID);\r\n    }\r\n  }\r\n\r\n  /** \r\n   * Logを再生\r\n   */\r\n  function playLog() {\r\n\r\n    if (intervalID_log !==null&&autoLog==true) {\r\n      move_next();\r\n    }else{\r\n      clearInterval(intervalID_log);\r\n    }\r\n  }\r\n\r\n  /** \r\n   * 小さい画面ではViewportを固定化\r\n   */\r\n  function zoom() {\r\n    let viewport = document.querySelector('meta[name=viewport]');\r\n    if (screen.width < 500 && screen.height < 500) {\r\n      if (screen.width < screen.height) {\r\n        viewport.setAttribute('content', 'width=500,user-scalable=no');\r\n      } else {\r\n        viewport.setAttribute('content', 'height=500,user-scalable=no');\r\n      }\r\n    } else if (screen.width < 500) {\r\n      viewport.setAttribute('content', 'width=500,user-scalable=no');\r\n    } else if (screen.height < 500) {\r\n      viewport.setAttribute('content', 'height=500,user-scalable=no');\r\n    }\r\n    // iOS9のViewportはなぜか機能してくれない。\r\n    if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {\r\n      let w = screen.width;\r\n      let w2 = 520;\r\n      if (Math.abs(window.orientation) !== 0) {\r\n        w = screen.height;\r\n        w2 = 900;\r\n      }\r\n      let rate = Math.round((w / w2) * 1000) / 1000.0;\r\n      if (rate == Math.round(rate)) { // iOS 9のViewportは整数指定すると機能しない\r\n        rate += 0.0001;\r\n      }\r\n\r\n      viewport.setAttribute(\r\n        'content',\r\n        'initial-scale=' + rate + ', minimum-scale=' + rate + ', maximum-scale=' + rate + ', user-scalable=no'\r\n      );\r\n    }\r\n  }\r\n\r\n  /** \r\n   * マウス移動時処理\r\n   */\r\n  function ev_mouseMove(e) {\r\n    getMousePosition(e);\r\n    flush(false, true);\r\n  }\r\n  /** \r\n   * タッチ移動時処理\r\n   */\r\n  function ev_touchMove(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /** \r\n   * マウスクリック時処理\r\n   */\r\n  function ev_mouseClick(e) {\r\n    getMousePosition(e);\r\n    let target = Math.floor(mouse_x / cellSize) * 10+ Math.floor(mouse_y / cellSize);\r\n    if (winner !== null || logArray.length !== 0) {\r\n      reloadnew();\r\n      return true;\r\n    }\r\n    if (demo === true) {\r\n      demo = false;\r\n      thisHand = [];\r\n      thisMap = Aijs.copyMap(startMap);\r\n      logArray2 = [];\r\n      flush(false, false);\r\n      winner = null;\r\n      goaled=false;\r\n      turn_player = 1;\r\n      window.clearInterval(intervalID);\r\n      flush(false, false);\r\n      return true;\r\n    }\r\n\r\n    if (hover_piece === null) {\r\n      if (thisMap[target] * turn_player > 0) {\r\n        hover_piece = target;\r\n      }\r\n    } else {\r\n      if (target == hover_piece) {\r\n        hover_piece = null;\r\n        flush(false, false);\r\n        return;\r\n      }\r\n      let canm = Aijs.getCanMovePanelX(hover_piece, thisMap);\r\n      if (canm.indexOf(target) >= 0) {\r\n        flush(false, true);\r\n        if(isGoaled(thisMap,target,turn_player)){\r\n            goaled=true;\r\n            flush(false, true);\r\n            setTimeout(function(){\r\n              goaled=false;\r\n              flush(false, false);\r\n            },2000);\r\n        }\r\n\r\n\r\n        thisMap[target] = thisMap[hover_piece];\r\n        thisMap[hover_piece] = 0;\r\n        turn_player = turn_player * -1;\r\n        logArray2.push([hover_piece, target]);\r\n        thisHand = [hover_piece, target];\r\n        hover_piece = null;\r\n\r\n\r\n        // AIが考える。\r\n        message = 'thinking...';\r\n        window.setTimeout(function () {\r\n          flush(false, false);\r\n        }, 50);\r\n        updateMessage();\r\n        if (winner === null) {\r\n          window.setTimeout(function () {\r\n            ai(document.querySelector('#level').value);\r\n            message = '';\r\n            updateMessage();\r\n            flush(false, false);\r\n          }, 250);\r\n        }\r\n      }\r\n    }\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * ラジオボタン変更時処理\r\n   */\r\n  function ev_radioChange() {\r\n    let num = document.querySelector('#level').value;\r\n    storage.setItem('level_save', num);\r\n    if (storage.getItem('level_' + num) > 0) {\r\n      document.querySelector('#wins').innerHTML = storage.getItem('level_' + num) + ' win!';\r\n    } else {\r\n      document.querySelector('#wins').innerHTML = '';\r\n    }\r\n    thisMap = Aijs.copyMap(startMap);\r\n    thisHand = [];\r\n    map_list = {};\r\n    logArray2 = [];\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * AIに考えてもらう。\r\n   */\r\n  function ai(level) {\r\n    let hand;\r\n    let startTime = new Date();\r\n    let endTime;\r\n    // 終盤になったら長考してみる。\r\n    let count = getNodeCount(thisMap) / 2;\r\n    let plus = 0;\r\n    level = parseInt(level);\r\n    switch (level) {\r\n      case 1:\r\n        if (count <= 7) {\r\n          plus++;\r\n        }\r\n        break;\r\n      case 2:\r\n        if (count <= 8) {\r\n          plus++;\r\n        }\r\n        break;\r\n      case 3:\r\n        if (count <= 10) {\r\n          plus++;\r\n        }\r\n        if (count <= 6) {\r\n          plus++;\r\n        }\r\n        break;\r\n      case 4:\r\n        if (count <= 11) {\r\n          plus++;\r\n        }\r\n        if (count <= 7) {\r\n          plus++;\r\n        }\r\n        break;\r\n      case 5:\r\n        if (count > 16) {\r\n          plus--;\r\n        }\r\n        if (count <= 12) {\r\n          plus++;\r\n        }\r\n        if (count <= 8) {\r\n          plus++;\r\n        }\r\n        break;\r\n      case 6:\r\n        if (count > 16) {\r\n          plus--;\r\n        }\r\n        if (count <= 12) {\r\n          plus++;\r\n        }\r\n        if (count <= 8) {\r\n          plus++;\r\n        }\r\n        break;\r\n    }\r\n\r\n    hand = Aijs.thinkAI(thisMap, turn_player, level + plus + 1)[0];\r\n    thisHand = hand;\r\n    if (hand) {\r\n      if(isGoaled(thisMap,hand[1],turn_player)){\r\n          goaled=true;\r\n          flush(false, true);\r\n          setTimeout(function(){\r\n            goaled=false;\r\n            flush(false, false);\r\n          },2000);\r\n      }\r\n      thisMap[hand[1]] = thisMap[hand[0]];\r\n      thisMap[hand[0]] = 0;\r\n      logArray2.push([hand[0], hand[1]]);\r\n      // //フォーカス座標を移す。\r\n      // mouse_x = Math.floor(hand[1] / 10)*cellSize+1\r\n      // mouse_y = Math.floor(hand[1] % 10)*cellSize+1\r\n    }\r\n    turn_player = turn_player * -1;\r\n    endTime = new Date();\r\n    thinktime = (endTime - startTime) / 1000;\r\n  }\r\n  /** \r\n   * ゴールしたか\r\n   */\r\n  function isGoaled(map,afterHand,turn){\r\n      if(turn>0){\r\n        if(afterHand%10===0){\r\n            return true;\r\n        }\r\n      }else if(turn<0){\r\n        if(afterHand%10===5){\r\n            return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n  }\r\n  /** \r\n   * 盤面をシャッフル。\r\n   */\r\n  function shuffleBoard() {\r\n    // クリア\r\n    for (let num in thisMap) {\r\n      thisMap[num] = 0;\r\n    }\r\n    let arr = [1, 2, 3, 4, 5, 6, 7, 8];\r\n    let red_num = [0, 10, 20, 30, 40, 50, 11, 41];\r\n    let blue_num = [55, 45, 35, 25, 15, 5, 44, 14];\r\n    for (let i = arr.length - 1; i >= 0; i--) {\r\n      let r = Math.floor(Math.random() * (i + 1));\r\n      let tmp = arr[i];\r\n      arr[i] = arr[r];\r\n      arr[r] = tmp;\r\n    }\r\n    for (let num in blue_num) {\r\n      thisMap[blue_num[num]] = arr[num];\r\n    }\r\n    for (let num in red_num) {\r\n      thisMap[red_num[num]] = -1 * arr[num];\r\n    }\r\n  }\r\n\r\n  /** \r\n   * マウス位置取得\r\n   */\r\n  function getMousePosition(e) {\r\n    if(e==null){\r\n      return;\r\n    }\r\n    if (!e.clientX) { // SmartPhone\r\n      if (e.touches) {\r\n        e = e.touches[0];\r\n      } else if (e.touches) {\r\n        e = e.touches[0];\r\n      } else {\r\n        e = event.touches[0];\r\n      }\r\n    }\r\n    let rect = e.target.getBoundingClientRect();\r\n    mouse_x = e.clientX - rect.left;\r\n    mouse_y = e.clientY - rect.top;\r\n    mouse_x = mouse_x *  RATIO;\r\n    mouse_y = mouse_y *  RATIO;\r\n  }\r\n\r\n  /** \r\n   * 画面描画。\r\n   */\r\n  function flush(initflg, cache_flg) {\r\n    let wkMap = new Int8Array(thisMap);\r\n    ctx.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    if (cache_flg === false) {\r\n      cache_on = false;\r\n    }\r\n    // キャッシュに保存\r\n    if (cache_flg === false || cache_on === false) {\r\n      // 盤面を描画\r\n      ctx.drawImage(drawBoard(initflg), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n      // テカリを描画\r\n      ctx.drawImage(drawBoard2(initflg), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n      // 選択したコマを除外\r\n      if (hover_piece !== null) {\r\n        wkMap[hover_piece] = 0;\r\n      }\r\n\r\n      // 残像を表示\r\n      ctx.drawImage(drawShadow(wkMap, thisHand), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n\r\n      // コマを表示\r\n      ctx.drawImage(drawPieceAll(wkMap), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n      // キャッシュに保存\r\n      let ctx_canv = canv_cache.getContext('2d');\r\n      ctx_canv.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n      ctx_canv.drawImage(ctx.canvas, 0, 0, CANV_SIZE, CANV_SIZE);\r\n      // キャッシュ有効化\r\n      cache_on = true;\r\n    } else {\r\n      // キャッシュから描画\r\n      ctx.drawImage(canv_cache, 0, 0, CANV_SIZE, CANV_SIZE);\r\n    }\r\n\r\n    // 選択したコマを表示\r\n    ctx.drawImage(drawHoverPiece(), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    if ((mouse_x !== 0 || mouse_y !== 0) && demo === false) {\r\n      // フォーカスを描画\r\n      ctx.drawImage(drawFocus(), 0, 0, CANV_SIZE, CANV_SIZE);\r\n    }\r\n\r\n    //スコアを表示\r\n    if(goaled||winner!==null){\r\n      if(demo===false&&autoLog==false){\r\n        ctx.drawImage(drawScore(), 0, 0, CANV_SIZE, CANV_SIZE);\r\n      }\r\n    }\r\n    // メッセージを描画\r\n    ctx.drawImage(drawOverlay(), 0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    // カバーを描画\r\n    if (demo === true) {\r\n      ctx.drawImage(drawCover(), 0, 0, CANV_SIZE, CANV_SIZE);\r\n    }\r\n\r\n\r\n  }\r\n\r\n  /** \r\n   * 背景描画\r\n   */\r\n  function drawBk() {\r\n    let ctx_bk = canv_bk.getContext('2d');\r\n    if (img_bk_loaded) {\r\n      ctx_bk.drawImage(img_bk, 0, 0, CANV_SIZE/RATIO, CANV_SIZE/RATIO, 0, 0, CANV_SIZE, CANV_SIZE);\r\n    }\r\n    return canv_bk;\r\n  }\r\n  /** \r\n   * カバー描画\r\n   */\r\n  function drawCover() {\r\n    // 背景\r\n    let ctx_cover = canv_cover.getContext('2d');\r\n    ctx_cover.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    ctx_cover.globalAlpha = 0.50;\r\n    ctx_cover.fillStyle = '#000000';\r\n    ctx_cover.fillRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    // 枠\r\n    let x = cellSize * 2;\r\n    let y = cellSize * 3.5;\r\n    ctx_cover.shadowBlur = 20;\r\n    ctx_cover.shadowColor = 'rgba(0, 0, 0, 0.3)';\r\n    ctx_cover.shadowOffsetX = 5;\r\n    ctx_cover.shadowOffsetY = 5;\r\n    ctx_cover.globalAlpha = 0.8;\r\n    ctx_cover.fillStyle = COLOR_WHITE;\r\n    ctx_cover.beginPath();\r\n    fillRoundRect(ctx_cover, x, y, cellSize * 2, cellSize * 1, cellSize/20);\r\n    ctx_cover.shadowColor = 'rgba(0, 0, 0, 0)';\r\n    ctx_cover.shadowBlur = 0;\r\n    ctx_cover.shadowOffsetX = 0;\r\n    ctx_cover.shadowOffsetY = 0;\r\n\r\n\r\n\r\n\r\n    // 文字\r\n    let fontsize = Math.round(cellSize * 0.5);\r\n    let message = 'Play';\r\n    message+=(demo_inc%10==0)?\" \":\"\";\r\n    ctx_cover.shadowBlur = 0;\r\n    ctx_cover.shadowOffsetX = 0;\r\n    ctx_cover.shadowOffsetY = 0;\r\n    ctx_cover.shadowColor = 'rgba(0, 0, 0, 0)';\r\n    ctx_cover.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n    ctx_cover.globalAlpha = 1;\r\n    ctx_cover.fillStyle = COLOR_LINE;\r\n    ctx_cover.textBaseline = 'middle';\r\n    ctx_cover.textAlign = 'center';\r\n    ctx_cover.beginPath();\r\n    ctx_cover.fillText(message, cellSize * 3, cellSize * 4);\r\n    // 文字２\r\n    message = 'colamone';\r\n    fontsize = Math.round(cellSize * 1);\r\n    ctx_cover.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n    ctx_cover.fillStyle = COLOR_WHITE;\r\n    ctx_cover.shadowBlur = 0;\r\n    ctx_cover.beginPath();\r\n    ctx_cover.fillText(message, cellSize * 3, cellSize * 2);\r\n\r\n\r\n    return canv_cover;\r\n  }\r\n\r\n  /** \r\n   * スコア描画\r\n   */\r\n  function drawScore() {\r\n    // 背景\r\n    let ctx_score = canv_score.getContext('2d');\r\n    let message =\"\";\r\n    let fontsize = Math.round(cellSize *1.5);\r\n    let blue=COLOR_BLUE2;\r\n    let red=COLOR_RED2;\r\n    ctx_score.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    ctx_score.globalAlpha = 0.4;\r\n    ctx_score.textBaseline = 'middle';\r\n    ctx_score.textAlign = 'center';\r\n    ctx_score.shadowBlur = 10;\r\n    ctx_score.shadowColor = 'rgba(0, 0, 0, 0.5)';\r\n    ctx_score.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n\r\n    // 文字\r\n    ctx_score.globalAlpha = 0.3;\r\n    ctx_score.shadowBlur = 2;\r\n    ctx_score.shadowColor = 'rgba(255, 255, 255, 1)';\r\n    ctx_score.fillStyle = red;\r\n    message = redScore;\r\n    ctx_score.beginPath();\r\n    ctx_score.fillText(message, cellSize * 1, cellSize * 3.8);\r\n    // 文字\r\n    message = \"8\";\r\n    ctx_score.beginPath();\r\n    ctx_score.fillText(message, cellSize * 2, cellSize * 5.3);\r\n    //線\r\n    ctx_score.lineWidth=cellSize*0.2;\r\n    ctx_score.strokeStyle = red;\r\n    ctx_score.beginPath();\r\n    ctx_score.moveTo(cellSize * 0.4, cellSize * 5.55);\r\n    ctx_score.lineTo(cellSize * 2.6, cellSize * 3.55);\r\n    ctx_score.closePath();\r\n    ctx_score.stroke();\r\n\r\n\r\n    // 文字\r\n    message = blueScore;\r\n    ctx_score.fillStyle = blue;\r\n    ctx_score.beginPath();\r\n    ctx_score.fillText(message, cellSize * 4, cellSize * 0.7);\r\n    // 文字\r\n    message = \"8\";\r\n    ctx_score.beginPath();\r\n    ctx_score.fillText(message, cellSize * 5, cellSize * 2.3);\r\n    // 文字\r\n    ctx_score.lineWidth=cellSize*0.2;\r\n    ctx_score.strokeStyle = blue;\r\n    ctx_score.beginPath();\r\n    ctx_score.moveTo(cellSize * 3.4, cellSize * 2.55);\r\n    ctx_score.lineTo(cellSize * 5.6, cellSize * 0.55);\r\n    ctx_score.closePath();\r\n    ctx_score.stroke();\r\n    return canv_score;\r\n  }\r\n\r\n\r\n\r\n  /** \r\n   * フォーカスを描画\r\n   */\r\n  function drawFocus() {\r\n    // 選択マスを強調\r\n    let x = mouse_x - (mouse_x % cellSize);\r\n    let y = mouse_y - (mouse_y % cellSize);\r\n    let ctx_focus = canv_focus.getContext('2d');\r\n    let grad = ctx_focus.createRadialGradient(x, y, 0, x,y, cellSize);\r\n    grad.addColorStop(0.3, COLOR_SELECT);\r\n    grad.addColorStop(1, COLOR_SELECT2);\r\n    ctx_focus.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    ctx_focus.globalAlpha = 0.35;\r\n    ctx_focus.fillStyle = grad;\r\n    ctx_focus.lineWidth = 1;\r\n    ctx_focus.beginPath();\r\n    ctx_focus.fillRect(x, y, cellSize, cellSize);\r\n\r\n\r\n    if (isTouch === true && hover_piece === null) {\r\n      return canv_focus;\r\n    }\r\n\r\n    // 移動可能マスを強調\r\n    let target = (x / cellSize) * 10 + (y / cellSize);\r\n    if (thisMap[target] * turn_player > 0) {\r\n      let canm = Aijs.getCanMovePanelX(target, thisMap);\r\n      for (let i = 0; i <= canm.length - 1; i++) {\r\n        x = Math.floor(canm[i] / 10);\r\n        y = Math.floor(canm[i] % 10);\r\n        ctx_focus.globalAlpha = 0.6;\r\n        ctx_focus.strokeStyle = COLOR_SELECT;\r\n        ctx_focus.lineWidth = cellSize/20;\r\n        ctx_focus.beginPath();\r\n        ctx_focus.arc(x * cellSize + (cellSize / 2), y * cellSize + (cellSize / 2),\r\n         (cellSize / 2) - (cellSize/10), 0, Math.PI * 2, false);\r\n        ctx_focus.stroke();\r\n      }\r\n    }\r\n    return canv_focus;\r\n  }\r\n\r\n  /** \r\n   * 盤面を描画してCANVASを返す。\r\n   */\r\n  function drawBoard(initflg) {\r\n    if (initflg === false) {\r\n      return canv_board;\r\n    }\r\n    let ctx_board = canv_board.getContext('2d');\r\n    ctx_board.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    let grad = ctx_board.createLinearGradient(0, 0, CANV_SIZE, CANV_SIZE);\r\n    grad.addColorStop(0, COLOR_PANEL_6);\r\n    grad.addColorStop(0.3, COLOR_PANEL_5);\r\n    grad.addColorStop(1, COLOR_PANEL_4);\r\n\r\n    for (let x = 0; x < 6; x++) {\r\n      for (let y = 0; y < 6; y++) {\r\n        // パネル描画\r\n        ctx_board.strokeStyle = COLOR_LINE;\r\n        if (y === 0) {\r\n          ctx_board.fillStyle = COLOR_PANEL_1;\r\n        } else if (y == 5) {\r\n          ctx_board.fillStyle = COLOR_PANEL_2;\r\n        } else if ((x + y) % 2 === 0) {\r\n          ctx_board.fillStyle = COLOR_PANEL_3;\r\n        } else {\r\n          ctx_board.fillStyle = COLOR_PANEL_4;\r\n          ctx_board.fillStyle = grad;\r\n        }\r\n        ctx_board.beginPath();\r\n        ctx_board.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);\r\n        ctx_board.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);\r\n      }\r\n    }\r\n\r\n    return canv_board;\r\n  }\r\n\r\n  /** \r\n   * 盤面をテカテカにする。\r\n   */\r\n  function drawBoard2(initflg) {\r\n    if (initflg === false) {\r\n      return canv_board2;\r\n    }\r\n    let ctx_board2 = canv_board2.getContext('2d');\r\n    ctx_board2.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    ctx_board2.globalAlpha = 0.07;\r\n    ctx_board2.fillStyle = COLOR_WHITE;\r\n    ctx_board2.beginPath();\r\n    ctx_board2.arc(cellSize * 1, -3 * cellSize, 7 * cellSize, 0, Math.PI * 2, false);\r\n    ctx_board2.fill();\r\n\r\n    return canv_board2;\r\n  }\r\n\r\n\r\n  /** \r\n   * 浮遊しているコマを描画する。\r\n   */\r\n  function drawHoverPiece() {\r\n    let ctx_hover = canv_hover_piece.getContext('2d');\r\n    ctx_hover.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    let x = mouse_x - (cellSize / 2);\r\n    let y = mouse_y - (cellSize / 2);\r\n    if (hover_piece !== null) {\r\n      drawPiece(ctx_hover, x, y, thisMap[hover_piece], false);\r\n    }\r\n    return canv_hover_piece;\r\n  }\r\n\r\n  /** \r\n   * コマを描画する。\r\n   */\r\n  function drawPiece(wkCtx, x, y, number, goal) {\r\n    let wkColor;\r\n\r\n    // 外枠を描画\r\n    if (number === 0) {\r\n      return wkCtx;\r\n    } else if (number > 0) {\r\n      wkColor = COLOR_BLUE;\r\n    } else {\r\n      wkColor = COLOR_RED;\r\n    }\r\n\r\n    let grad = ctx.createLinearGradient(x, y, x + cellSize, y + cellSize);\r\n    grad.addColorStop(0, 'rgb(255, 255, 255)');\r\n    grad.addColorStop(0.4, wkColor);\r\n    grad.addColorStop(1, wkColor);\r\n\r\n    wkCtx.shadowBlur = 10;\r\n    wkCtx.shadowColor = 'rgba(0, 0, 0, 1)';\r\n    wkCtx.shadowOffsetX = 2;\r\n    wkCtx.shadowOffsetY = 2;\r\n    wkCtx.fillStyle = grad;\r\n    wkCtx.beginPath();\r\n    fillRoundRect(wkCtx, x + cellSize / 10, y + cellSize / 10, cellSize - 1 * cellSize / 5, cellSize - 1 * cellSize / 5, cellSize/20);\r\n\r\n    wkCtx.shadowColor = 'rgba(0, 0, 0, 0)';\r\n    wkCtx.shadowBlur = 0;\r\n    wkCtx.shadowOffsetX = 0;\r\n    wkCtx.shadowOffsetY = 0;\r\n\r\n    // 曇りエフェクト\r\n    if (img_bk_loaded) {\r\n      wkCtx.globalAlpha = 0.35;\r\n      wkCtx.save();\r\n      wkCtx.clip();\r\n      wkCtx.drawImage(drawBk(true), x + cellSize / 10, y + cellSize / 10, cellSize - 1 * cellSize / 5, cellSize - 1 * cellSize / 5);\r\n      wkCtx.restore();\r\n      wkCtx.globalAlpha = 1;\r\n    }\r\n\r\n    // 文字を描画。\r\n    wkCtx.fillStyle = COLOR_WHITE;\r\n    \r\n    let fontsize = Math.round(cellSize * 0.18);\r\n    wkCtx.textBaseline = 'middle';\r\n    wkCtx.textAlign = 'center';\r\n    wkCtx.font = fontsize + \"pt 'Play',Arial\";\r\n    wkCtx.beginPath();\r\n\r\n    // 数字を印字\r\n    wkCtx.fillText(Math.abs(number), x + (cellSize / 2), y + (cellSize / 2));\r\n\r\n    // 点を描画\r\n    for (let i = 0; i <= PIECES[number].length - 1; i++) {\r\n      if (PIECES[number][i] === 0) {\r\n        continue;\r\n      }\r\n      let x_dot = x + cellSize / 4.16 + (Math.floor(cellSize - 1 * cellSize / 5) / 3) * Math.floor(i % 3.0);\r\n      let y_dot = y + cellSize / 4.16 + (Math.floor(cellSize - 1 * cellSize / 5) / 3) * Math.floor(i / 3.0);\r\n\r\n      wkCtx.fillStyle = COLOR_WHITE;\r\n\r\n      wkCtx.beginPath();\r\n      wkCtx.arc(x_dot, y_dot, cellSize * 0.06, 0, Math.PI * 2, false);\r\n      wkCtx.fill();\r\n    }\r\n\r\n    if (goal) { // 得点を印字\r\n      wkCtx.shadowBlur = 10;\r\n      wkCtx.shadowColor = 'rgba(0, 0, 0, 1)';\r\n      wkCtx.globalAlpha = 1;\r\n      wkCtx.fillStyle = COLOR_WHITE;\r\n      fontsize = Math.round(cellSize * 0.5);\r\n      wkCtx.textBaseline = 'middle';\r\n      wkCtx.textAlign = 'center';\r\n      wkCtx.font = 'bolder ' + fontsize + 'pt Play,Arial ';\r\n      wkCtx.beginPath();\r\n      wkCtx.fillText(Math.abs(number), x + (cellSize / 2), y + (cellSize / 2));\r\n      wkCtx.globalAlpha = 1;\r\n      wkCtx.shadowColor = 'rgba(0, 0, 0, 0)';\r\n      wkCtx.shadowBlur = 0;\r\n    }\r\n\r\n    return wkCtx;\r\n  }\r\n  // 角丸\r\n  function fillRoundRect(ctx, x, y, w, h, r) {\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + r, y);\r\n    ctx.lineTo(x + w - r, y);\r\n    ctx.arc(x + w - r, y + r, r, Math.PI * 1.5, 0, false);\r\n    ctx.lineTo(x + w, y + h - r);\r\n    ctx.arc(x + w - r, y + h - r, r, 0, Math.PI * 0.5, false);\r\n    ctx.lineTo(x + r, y + h);\r\n    ctx.arc(x + r, y + h - r, r, Math.PI * 0.5, Math.PI, false);\r\n    ctx.lineTo(x, y + r);\r\n    ctx.arc(x + r, y + r, r, Math.PI, Math.PI * 1.5, false);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n\r\n  /** \r\n   * コマをすべて描画\r\n   */\r\n  function drawPieceAll(wkMap) {\r\n    let ctx_pieces = canv_pieces.getContext('2d');\r\n    ctx_pieces.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    for (let x = 0; x < 6; x++) {\r\n      for (let y = 0; y < 6; y++) {\r\n        if (wkMap[x * 10 + y] !== 0) {\r\n          let goal = false;\r\n          if (wkMap[x * 10 + y] > 0 && y === 0) {\r\n            goal = true;\r\n          } else if (wkMap[x * 10 + y] < 0 && y == 5) {\r\n            goal = true;\r\n          }\r\n          ctx_pieces = drawPiece(ctx_pieces, x * cellSize, y * cellSize, wkMap[x * 10 + y], goal);\r\n        }\r\n      }\r\n    }\r\n    return canv_pieces;\r\n  }\r\n  /** \r\n   * 残像を描画する。\r\n   */\r\n  function drawShadow(wkMap, hand) {\r\n    let ctx_shadow = canv_shadow.getContext('2d');\r\n    ctx_shadow.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n    let x0 = (hand[0] / 10 | 0);\r\n    let y0 = hand[0] % 10;\r\n    let x1 = (hand[1] / 10 | 0);\r\n    let y1 = hand[1] % 10;\r\n    let h = cellSize - 1 * cellSize / 5;\r\n    let w = cellSize - 1 * cellSize / 5;\r\n    let x = x1 * cellSize + cellSize / 10;\r\n    let y = y1 * cellSize + cellSize / 10;\r\n    let shadow_start_x = x + w / 2;\r\n    let shadow_start_y = y + h / 2;\r\n    let shadow_end_x = shadow_start_x;\r\n    let shadow_end_y = shadow_start_y;\r\n    let number = wkMap[hand[1]];\r\n    let wkColor = '';\r\n    let center = 0;\r\n    let grad;\r\n    if (hand.length != 2) {\r\n      return canv_shadow;\r\n    }\r\n    if (number > 0) {\r\n      wkColor = COLOR_BLUE; // \"#EAEFFD\";   \r\n    } else {\r\n      wkColor = COLOR_RED; // \"#FDEAFA\";           \r\n    }\r\n    if (x0 == x1 || y0 == y1) { // 直角移動\r\n      if ((x0 + y0) % 2 === 0 && y0 !== 0 && y0 != 5) {\r\n        center = 0.5;\r\n      } else {\r\n        center = 0.3;\r\n      }\r\n      if (x0 < x1) {\r\n        x = x - w + 10;\r\n        shadow_end_x = shadow_end_x - w;\r\n      }\r\n      if (x0 > x1) {\r\n        x = x + w - 10;\r\n        shadow_end_x = shadow_end_x + w;\r\n      }\r\n      if (y0 < y1) {\r\n        y = y - h + 10;\r\n        shadow_end_y = shadow_end_y - h;\r\n      }\r\n      if (y0 > y1) {\r\n        y = y + h - 10;\r\n        shadow_end_y = shadow_end_y + h;\r\n      }\r\n      grad = ctx_shadow.createLinearGradient(shadow_start_x, shadow_start_y, shadow_end_x, shadow_end_y);\r\n\r\n      grad.addColorStop(0, wkColor);\r\n      grad.addColorStop(center, wkColor);\r\n      grad.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n      ctx_shadow.fillStyle = grad;\r\n      ctx_shadow.fillRect(x, y, h, w);\r\n    } else { // 斜め移動\r\n      if ((x0 + y0) % 2 === 0 && y0 !== 0 && y0 != 5) {\r\n        center = 0.3;\r\n      } else {\r\n        center = 0.5;\r\n      }\r\n      let px1, py1, px2, py2, px3, py3, px4, py4;\r\n      if (x0 < x1 && y0 < y1) {\r\n        px1 = x;\r\n        py1 = y - h;\r\n        px2 = x + w;\r\n        py2 = y;\r\n        px3 = x;\r\n        py3 = y + h;\r\n        px4 = x - w;\r\n        py4 = y;\r\n        shadow_end_x = shadow_end_x - w;\r\n        shadow_end_y = shadow_end_y - h;\r\n        shadow_start_x = shadow_start_x + w * 2;\r\n        shadow_start_y = shadow_start_y + h * 2;\r\n      }\r\n      if (x0 > x1 && y0 > y1) {\r\n        px1 = x + w;\r\n        py1 = y;\r\n        px2 = x + w + w;\r\n        py2 = y + h;\r\n        px3 = x + w;\r\n        py3 = y + h + h;\r\n        px4 = x;\r\n        py4 = y + h;\r\n        shadow_end_x = shadow_end_x + w;\r\n        shadow_end_y = shadow_end_y + h;\r\n        shadow_start_x = shadow_start_x - w * 2;\r\n        shadow_start_y = shadow_start_y - h * 2;\r\n      }\r\n      if (x0 < x1 && y0 > y1) {\r\n        px1 = x;\r\n        py1 = y;\r\n        px2 = x + w;\r\n        py2 = y + h;\r\n        px3 = x;\r\n        py3 = y + h + h;\r\n        px4 = x - w;\r\n        py4 = y + h;\r\n        shadow_end_x = shadow_end_x - w;\r\n        shadow_end_y = shadow_end_y + h;\r\n        shadow_start_x = shadow_start_x + w * 2;\r\n        shadow_start_y = shadow_start_y - h * 2;\r\n      }\r\n      if (x0 > x1 && y0 < y1) {\r\n        px1 = x + w;\r\n        py1 = y - h;\r\n        px2 = x + w + w;\r\n        py2 = y;\r\n        px3 = x + w;\r\n        py3 = y + h;\r\n        px4 = x;\r\n        py4 = y;\r\n        shadow_end_x = shadow_end_x + w;\r\n        shadow_end_y = shadow_end_y - h;\r\n        shadow_start_x = shadow_start_x - w * 2;\r\n        shadow_start_y = shadow_start_y + h * 2;\r\n      }\r\n      ctx_shadow.beginPath();\r\n      ctx_shadow.moveTo(px1, py1);\r\n      ctx_shadow.lineTo(px2, py2);\r\n      ctx_shadow.lineTo(px3, py3);\r\n      ctx_shadow.lineTo(px4, py4);\r\n      ctx_shadow.lineTo(px1, py1);\r\n      ctx_shadow.closePath();\r\n      grad = ctx_shadow.createLinearGradient(shadow_start_x, shadow_start_y, shadow_end_x, shadow_end_y);\r\n      grad.addColorStop(0, wkColor);\r\n      grad.addColorStop(center, wkColor);\r\n      grad.addColorStop(0.97, 'rgba(255, 255, 255, 0)');\r\n      ctx_shadow.fillStyle = grad;\r\n      ctx_shadow.fill();\r\n    }\r\n\r\n    return canv_shadow;\r\n  }\r\n  /** \r\n   * メッセージを描画\r\n   */\r\n  function drawOverlay() {\r\n    let ctx_overlay = canv_overlay.getContext('2d');\r\n    let x = cellSize * 1.3;\r\n    let y = cellSize * 2.5;\r\n\r\n    ctx_overlay.clearRect(0, 0, CANV_SIZE, CANV_SIZE);\r\n\r\n    if (message === '') {\r\n      return canv_overlay;\r\n    }\r\n    ctx_overlay.shadowBlur = 10;\r\n    ctx_overlay.shadowColor = 'rgba(100, 100, 100, 0.5)';\r\n    ctx_overlay.shadowOffsetX = 5;\r\n    ctx_overlay.shadowOffsetY = 5;\r\n\r\n    ctx_overlay.globalAlpha = 0.9;\r\n    ctx_overlay.fillStyle = COLOR_WHITE;\r\n    fillRoundRect(ctx_overlay, x, y, cellSize * 3.4, cellSize * 1, cellSize/20);\r\n\r\n    let fontsize = Math.round(cellSize * 0.36);\r\n    ctx_overlay.shadowBlur = 0;\r\n    ctx_overlay.shadowOffsetX = 0;\r\n    ctx_overlay.shadowOffsetY = 0;\r\n    ctx_overlay.shadowColor = 'rgba(0, 0, 0, 0)';\r\n    ctx_overlay.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n    ctx_overlay.globalAlpha = 1;\r\n    ctx_overlay.fillStyle = COLOR_LINE;\r\n    ctx_overlay.textBaseline = 'middle';\r\n    ctx_overlay.textAlign = 'center';\r\n    ctx_overlay.beginPath();\r\n    ctx_overlay.fillText(message, cellSize * 3, cellSize * 3);\r\n\r\n    return canv_overlay;\r\n  }\r\n\r\n  /** \r\n   * メッセージを更新\r\n   */\r\n  function updateMessage() {\r\n    calcScore();\r\n    let Block = '';\r\n    document.querySelector('#blue').innerHTML = 'Blue: ' + blueScore + '/8';\r\n    document.querySelector('#red').innerHTML = ' Red: ' + redScore + '/8';\r\n    document.querySelector('#time').innerHTML = '(' + (thinktime.toFixed(3)) + 'sec)';\r\n    if (logArray.length === 0) {\r\n      if (winner == 1) {\r\n        message = 'You win!';\r\n        storage.setItem('level_' + document.querySelector('#level').value,\r\n          parseInt(storage.getItem('level_' + document.querySelector('#level').value)) + 1);\r\n        endgame();\r\n      } else if (winner == -1) {\r\n        message = 'You lose...';\r\n        storage.setItem('level_' + document.querySelector('#level').value, 0);\r\n        endgame();\r\n      } else if (winner === 0) {\r\n        if (map_list[JSON.stringify(thisMap)] >= LIMIT_1000DAY) {\r\n          message = '3fold repetition';\r\n        } else {\r\n          message = '-- Draw --';\r\n        }\r\n        endgame();\r\n      }\r\n    }\r\n\r\n    if (storage.getItem('level_' + document.querySelector('#level').value) > 0) {\r\n      document.querySelector('#wins').innerHTML = storage.getItem('level_' + document.querySelector('#level').value) + ' win!';\r\n    } else {\r\n      document.querySelector('#wins').innerHTML = '';\r\n    }\r\n  }\r\n\r\n  /** \r\n   * ゲーム終了\r\n   */\r\n  function endgame() {\r\n    if (logArray.length === 0) {\r\n      document.querySelector('#span_replay').classList.remove(\"hide\");\r\n      document.querySelector('#span_tweetlog').classList.remove(\"hide\");\r\n    }\r\n  }\r\n  /** \r\n   * 得点計算。\r\n   */\r\n  function calcScore() {\r\n    let sum1 = 0;\r\n    let sum2 = 0;\r\n    let GoalTop = [0, 10, 20, 30, 40, 50];\r\n    let GoalBottom = [5, 15, 25, 35, 45, 55];\r\n    // 点数勝利        \r\n    for (let i in GoalTop) {\r\n      if (thisMap[GoalTop[i]] * 1 > 0) {\r\n        sum1 += thisMap[GoalTop[i]];\r\n      }\r\n    }\r\n    for (let i in GoalBottom) {\r\n      if (thisMap[GoalBottom[i]] * -1 > 0) {\r\n        sum2 += thisMap[GoalBottom[i]];\r\n      }\r\n    }\r\n    if (sum1 >= 8) {\r\n      winner = 1;\r\n    } else if (sum2 <= -8) {\r\n      winner = -1;\r\n    }\r\n\r\n    // 手詰まりは判定\r\n    if (isNoneNode(thisMap)) {\r\n      if (Math.abs(sum1) > Math.abs(sum2)) {\r\n        winner = 1;\r\n      } else if (Math.abs(sum1) < Math.abs(sum2)) { // 引き分けは後攻勝利\r\n        winner = -1;\r\n      } else if (Math.abs(sum1) == Math.abs(sum2)) {\r\n        winner = 0;\r\n      }\r\n    } else {\r\n      if (is1000day(thisMap) === true) {\r\n        winner = 0;\r\n      }\r\n    }\r\n    blueScore = Math.abs(sum1);\r\n    redScore = Math.abs(sum2);\r\n  }\r\n\r\n  /** \r\n   * 手詰まり判定。\r\n   */\r\n  function isNoneNode(wkMap) {\r\n    let flag1 = false;\r\n    let flag2 = false;\r\n    for (let panel_num in wkMap) {\r\n      if (wkMap[panel_num] === 0) {\r\n        continue;\r\n      }\r\n      let canMove = Aijs.getCanMovePanelX(panel_num, wkMap);\r\n      if (canMove.length !== 0) {\r\n        if (wkMap[panel_num] > 0) {\r\n          flag1 = true;\r\n        } else if (wkMap[panel_num] < 0) {\r\n          flag2 = true;\r\n        }\r\n      }\r\n      if (flag1 && flag2) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n\r\n  /** \r\n   * 千日手\r\n   */\r\n  function is1000day(wkMap) {\r\n    let map_json = JSON.stringify(wkMap);\r\n    if (map_list[map_json] === undefined) {\r\n      map_list[map_json] = 1;\r\n      return false;\r\n    } else {\r\n      map_list[map_json] += 1;\r\n    }\r\n    if (map_list[map_json] >= LIMIT_1000DAY) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /** \r\n   * 手の数を取得\r\n   */\r\n  function getNodeCount(wkMap) {\r\n    let count = 0;\r\n    for (let panel_num in wkMap) {\r\n      if (wkMap[panel_num] === 0) {\r\n        continue;\r\n      }\r\n      let canMove = Aijs.getCanMovePanelX(panel_num, wkMap);\r\n      count += canMove.length;\r\n    }\r\n    return count;\r\n  }\r\n\r\n\r\n  /** \r\n   * パラメータ取得\r\n   */\r\n  function getParam() {\r\n    let obj = {};\r\n    if (1 < document.location.search.length) {\r\n      let paramstr = document.location.search.substring(1).split('&');\r\n      for (let i = 0; i < paramstr.length; i++) {\r\n        let entry = paramstr[i].split('=');\r\n        let key = decodeURIComponent(entry[0]);\r\n        let value = decodeURIComponent(entry[1]);\r\n        obj[key] = decodeURIComponent(value);\r\n      }\r\n    }\r\n    return obj;\r\n  }\r\n\r\n  /** \r\n   * パタメータから初期配置を取得\r\n   */\r\n  function getMapByParam(initString) {\r\n    let wkMap;\r\n    if (initString) {\r\n      wkMap = Aijs.copyMap(thisMap);\r\n      // クリア\r\n      for (let num in wkMap) {\r\n        wkMap[num] = 0;\r\n      }\r\n      let arr = initString.split(',');\r\n      if (arr.length < 8) {\r\n        arr = [1, 2, 3, 4, 5, 6, 7, 8];\r\n      }\r\n      let red_num = [0, 10, 20, 30, 40, 50, 11, 41];\r\n      let blue_num = [55, 45, 35, 25, 15, 5, 44, 14];\r\n\r\n      for (let num in blue_num) {\r\n        wkMap[blue_num[num]] = parseInt(arr[num]);\r\n      }\r\n      for (let num in red_num) {\r\n        wkMap[red_num[num]] = -1 * parseInt(arr[num]);\r\n      }\r\n    }\r\n\r\n    return wkMap;\r\n  }\r\n  /** \r\n   * ログをデコード。\r\n   */\r\n  function decodeLog(logstr, wkInitMap) {\r\n    let wklogArray = [];\r\n    let wkMap = Aijs.copyMap(wkInitMap);\r\n    let arrow = {\r\n      'q': 0, 'w': 1, 'e': 2,\r\n      'a': 3, 's': 4, 'd': 5,\r\n      'z': 6, 'x': 7, 'c': 8\r\n    };\r\n    logstr = logstr.replace(/q/g, 'q,').replace(/w/g, 'w,').replace(/e/g, 'e,');\r\n    logstr = logstr.replace(/a/g, 'a,').replace(/s/g, 's,').replace(/d/g, 'd,');\r\n    logstr = logstr.replace(/z/g, 'z,').replace(/x/g, 'x,').replace(/c/g, 'c,');\r\n    let logArr = logstr.split(',');\r\n\r\n    wklogArray.push(wkMap);\r\n    for (let i = 0; i < logArr.length; i++) {\r\n      if (logArr[i] === '') { continue; }\r\n      let arw = arrow[logArr[i].match(/[qweasdzxc]/)[0]];\r\n      let from = parseInt(logArr[i].match(/\\d*/)[0]);\r\n      let to = (Math.floor(from / 10) + Math.floor(arw % 3) - 1) * 10 +\r\n       (Math.floor(from % 10) + Math.floor(arw / 3) - 1);\r\n      wkMap = Aijs.copyMap(wkMap);\r\n      wkMap[to] = parseInt(wkMap[from]);\r\n      wkMap[from] = 0;\r\n      wklogArray.push(wkMap);\r\n    }\r\n    return wklogArray;\r\n  }\r\n  /** \r\n   * ログをエンコード\r\n   */\r\n  function encodeLog(wklogArray) {\r\n    let logstr = '';\r\n    let arrow = ['q', 'w', 'e',\r\n      'a', 's', 'd',\r\n      'z', 'x', 'c'];\r\n    for (let i in wklogArray) {\r\n      let from = wklogArray[i][0];\r\n      let to = wklogArray[i][1];\r\n      let x_vec = ((Math.floor(to / 10)) - Math.floor(from / 10));\r\n      let y_vec = ((Math.floor(to % 10)) - Math.floor(from % 10));\r\n      let arw = '';\r\n      if (x_vec === -1 && y_vec === -1) { arw = 'q'; }\r\n      if (x_vec === 0 && y_vec === -1) { arw = 'w' ;}\r\n      if (x_vec === 1 && y_vec === -1) { arw = 'e' ;}\r\n      if (x_vec === -1 && y_vec === 0) { arw = 'a'; }\r\n      if (x_vec === 0 && y_vec === 0) { arw = 's' ;}\r\n      if (x_vec === 1 && y_vec === 0) { arw = 'd' ;}\r\n      if (x_vec === -1 && y_vec === 1) { arw = 'z'; }\r\n      if (x_vec === 0 && y_vec === 1) { arw = 'x' ;}\r\n      if (x_vec === 1 && y_vec === 1) { arw = 'c'; }\r\n      logstr += from + arw;\r\n    }\r\n    return logstr;\r\n  }\r\n\r\n  /** \r\n   * ログを全部巻き戻す\r\n   */\r\n  function move_start() {\r\n    logPointer = 0;\r\n    autoLog=false;    \r\n    thisMap = Aijs.copyMap(logArray[logPointer]);\r\n    winner=null;\r\n    goaled=false;\r\n    updateMessage();\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * ログを戻す\r\n   */\r\n  function move_prev() {\r\n    if (logPointer <= 0) { return; }\r\n    autoLog=false;    \r\n    logPointer -= 1;\r\n    thisMap = Aijs.copyMap(logArray[logPointer]);\r\n    winner=null;\r\n    goaled=false;\r\n    updateMessage();\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * ログを進める\r\n   */\r\n  function move_next() {\r\n    if (logPointer + 1 > logArray.length - 1) { return; }\r\n    logPointer += 1;\r\n    thisMap = Aijs.copyMap(logArray[logPointer]);\r\n    updateMessage();\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * ログを最後まで進める。\r\n   */\r\n  function move_end() {\r\n    logPointer = logArray.length - 1;\r\n    autoLog=false;    \r\n    thisMap = Aijs.copyMap(logArray[logPointer]);\r\n    updateMessage();\r\n    flush(false, false);\r\n  }\r\n\r\n  /** \r\n   * リセット\r\n   */\r\n  function reloadnew() {\r\n    let url = document.location.href.split('?')[0];\r\n\r\n    //demo中ならdemoを終了\r\n    if(demo===true){\r\n      ev_mouseClick(null);\r\n      return;\r\n    }\r\n\r\n    // パラメータを取得\r\n    let paramObj = getParam();\r\n    if (paramObj.lang) {\r\n      url += '?lang=' + paramObj.lang;\r\n    }\r\n    if (navigator.onLine) {\r\n      location.href = url;\r\n    } else {\r\n      thisMap = Aijs.copyMap(startMap);\r\n      shuffleBoard();\r\n      logArray2 = [];\r\n      message = '';\r\n      winner = null;\r\n      turn_player = 1;\r\n      flush(false, false);\r\n    }\r\n  }\r\n\r\n  /** \r\n   * 検討画面に飛ぶ\r\n   */\r\n  function jumpkento() {\r\n    let url = document.location.href.split('?')[0];\r\n    let init = '?init=' + startMap[55] + ','+\r\n     startMap[45] + ','+\r\n     startMap[35] + ','+\r\n     startMap[25] + ','+\r\n     startMap[15] + ','+\r\n     startMap[5] + ','+\r\n     startMap[44] + ','+\r\n     startMap[14];\r\n    let log = '&log=' + encodeLog(logArray2);\r\n    log += '&lv=' + document.querySelector('#level').value;\r\n    location.href = url + init + log;\r\n  }\r\n  /** \r\n   * ログをツイートする。\r\n   */\r\n  function tweetlog() {\r\n    let url = document.location.href.split('?')[0];\r\n    let init = '?init=' + startMap[55] + ','+\r\n     startMap[45] + ','+\r\n     startMap[35] + ','+\r\n     startMap[25] + ','+\r\n     startMap[15] + ','+\r\n     startMap[5] + ','+\r\n     startMap[44] + ','+\r\n     startMap[14];\r\n    let log = '%26log=' + encodeLog(logArray2);\r\n    log += '%26lv=' + document.querySelector('#level').value;\r\n    window.open('https://twitter.com/intent/tweet?text=' + url + init + log + '%20%23colamone');\r\n  }\r\n  /** \r\n   * ツイートボタンを読み込む。\r\n   */\r\n  function setTweet() {\r\n    /*jshint -W030 */\r\n    !function (d, s, id) {\r\n      let js, fjs = d.getElementsByTagName(s)[0];\r\n      if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.async = true; js.src = 'https://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); }\r\n    } (document, 'script', 'twitter-wjs');\r\n  }\r\n  /** \r\n   * botかどうか判定\r\n   */\r\n  function isBot(){\r\n    let ua = window.navigator.userAgent.toLowerCase();\r\n    if (ua.indexOf('bot') != -1 ||\r\n    ua.indexOf('lighthouse') != -1||\r\n    ua.indexOf('headless') != -1) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n})((this || 0).self || global);\r\n\r\n/** \r\n * init \r\n */\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  BoardGamejs.init();\r\n});\r\n"],"sourceRoot":""}