{"version":3,"sources":["webpack://colamone_js/./src/ai.ts","webpack://colamone_js/./src/gamestate.ts","webpack://colamone_js/./src/view.ts","webpack://colamone_js/./src/boardgame.ts"],"names":["Aijs","wkMap","Int8Array","nearwin","sum1","sum2","isNoneNode","live1","live2","i","num","NUMBERS","flag1","flag2","panel_num","hasCanMovePanelX","number","x","y","PIECES","target_x","target_y","target_number","canMove","idx","push","turn_player","nodeList","getCanMovePanelX","length","nodeMap","evalparam","ev","isDraw","end","isEndX","line","cell_p","p","map","depth","a","b","besthand","best_score","evalMap","getNodeMap","hand","map0","sc","deepThinkAllAB","undefined","DEFAULT_EVALPARAM","GameState","this","goaled","blueScore","redScore","winner","message","demo","thisHand","thisMap","mouse_x","mouse_y","hover_piece","demo_inc","autoLog","isTouch","View","CellSize","Ratio","Img_bk_loaded","Img_bk","ctx","canv_board","canv_board2","canv_focus","canv_pieces","canv_shadow","canv_hover_piece","canv_overlay","canv_bk","canv_cover","canv_score","canv_cache","cache_on","COLOR_LINE","COLOR_PANEL_1","COLOR_PANEL_2","COLOR_PANEL_3","COLOR_PANEL_4","COLOR_PANEL_5","COLOR_PANEL_6","COLOR_SELECT","COLOR_SELECT2","COLOR_RED","COLOR_BLUE","COLOR_RED2","COLOR_BLUE2","COLOR_WHITE","CANV_SIZE","window","devicePixelRatio","Image","src","_a","document","querySelector","getContext","createElement","width","height","canvas","style","gameState","initflg","cache_flg","clearRect","drawImage","drawBoard","drawBoard2","drawShadow","drawPieceAll","ctx_canv","drawHoverPiece","drawFocus","drawScore","drawOverlay","drawCover","ctx_bk","ctx_cover","globalAlpha","fillStyle","fillRect","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","beginPath","fillRoundRect","fontsize","Math","round","font","textBaseline","textAlign","fillText","ctx_score","blue","red","String","lineWidth","strokeStyle","moveTo","lineTo","closePath","stroke","ctx_focus","grad","createRadialGradient","addColorStop","target","canm","floor","arc","PI","ctx_board","createLinearGradient","strokeRect","ctx_board2","fill","ctx_hover","drawPiece","wkCtx","goal","wkColor","save","clip","drawBk","restore","abs","x_dot","y_dot","w","h","r","ctx_pieces","ctx_shadow","x0","y0","x1","y1","shadow_start_x","shadow_start_y","shadow_end_x","shadow_end_y","center","px1","py1","px2","py2","px3","py3","px4","py4","ctx_overlay","bg","view","thinktime","intervalID","intervalID_log","map_list","LIMIT_1000DAY","startMap","logPointer","logArray","logArray2","storage","ev_mouseMove","e","getMousePosition","flush","ev_touchMove","preventDefault","stopPropagation","ev_mouseClick","_b","_c","_d","_e","_f","reloadnew","copyMap","clearInterval","indexOf","isGoaled","setTimeout","updateMessage","ai","parseInt","value","ev_radioChange","setItem","getItem","innerHTML","parent","localStorage","navigator","cookieEnabled","hasItem","sKey","RegExp","escape","replace","test","cookie","unescape","sValue","zoom","innerHeight","innerWidth","classList","remove","add","init","addEventListener","passive","move_start","move_prev","move_next","move_end","jumpkento","tweetlog","toggle","element","documentElement","bottom","scrollHeight","clientHeight","scroll","shuffleBoard","paramObj","getParam","getMapByParam","log","decodeLog","lv","focus","onload","onerror","setTweet","isBot","setInterval","playDemo","playLog","random","calcScore","viewport","screen","setAttribute","userAgent","MSStream","w2","orientation","rate","level","endTime","startTime","Date","count","getNodeCount","plus","thinkAI","getTime","afterHand","turn","arr","red_num","blue_num","tmp","clientX","touches","event","rect","getBoundingClientRect","left","clientY","top","toFixed","endgame","JSON","stringify","GoalTop","GoalBottom","is1000day","map_json","obj","location","search","paramstr","substring","split","entry","key","decodeURIComponent","initString","logstr","wkInitMap","wklogArray","arrow","logArr","arw","match","from","to","x_vec","y_vec","url","href","lang","onLine","encodeLog","open","d","s","id","js","fjs","getElementsByTagName","getElementById","async","parentNode","insertBefore","ua","toLowerCase","Run"],"mappings":"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","file":"main.js","sourcesContent":["/* @license Copyright (c) @kurehajime / source code: https://github.com/kurehajime/colamone_js */\r\n'use strict';\r\nexport class Aijs {\r\n    /**\r\n     * Mapをコピーして返す。\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @return {Object.<number, number>}\r\n     */\r\n    static copyMap(wkMap) {\r\n        return new Int8Array(wkMap);\r\n    }\r\n    /**\r\n     * 終了判定(実質的勝利含む)\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @param  {boolean}  nearwin\r\n     * @return {number} 0:引き分け,1:先手勝利,-1:後手勝利\r\n     */\r\n    static isEndX(wkMap, nearwin) {\r\n        let sum1 = 0;\r\n        let sum2 = 0;\r\n        // ループだと遅いので展開\r\n        if (wkMap[0] > 0) {\r\n            sum1 += wkMap[0];\r\n        }\r\n        if (wkMap[10] > 0) {\r\n            sum1 += wkMap[10];\r\n        }\r\n        if (wkMap[20] > 0) {\r\n            sum1 += wkMap[20];\r\n        }\r\n        if (wkMap[30] > 0) {\r\n            sum1 += wkMap[30];\r\n        }\r\n        if (wkMap[40] > 0) {\r\n            sum1 += wkMap[40];\r\n        }\r\n        if (wkMap[50] > 0) {\r\n            sum1 += wkMap[50];\r\n        }\r\n        if (wkMap[5] * -1 > 0) {\r\n            sum2 += wkMap[5];\r\n        }\r\n        if (wkMap[15] * -1 > 0) {\r\n            sum2 += wkMap[15];\r\n        }\r\n        if (wkMap[25] * -1 > 0) {\r\n            sum2 += wkMap[25];\r\n        }\r\n        if (wkMap[35] * -1 > 0) {\r\n            sum2 += wkMap[35];\r\n        }\r\n        if (wkMap[45] * -1 > 0) {\r\n            sum2 += wkMap[45];\r\n        }\r\n        if (wkMap[55] * -1 > 0) {\r\n            sum2 += wkMap[55];\r\n        }\r\n        if (sum1 >= 8) {\r\n            return 1;\r\n        }\r\n        else if (sum2 <= -8) {\r\n            return -1;\r\n        }\r\n        // 手詰まりは判定\r\n        if (Aijs.isNoneNode(wkMap)) {\r\n            if (sum1 > (-1 * sum2)) {\r\n                return 1;\r\n            }\r\n            else if (sum1 < (-1 * sum2)) {\r\n                return -1;\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        }\r\n        // 実質的判定勝利\r\n        if (nearwin === false && (sum1 !== 0 || sum2 !== 0)) {\r\n            let live1 = 0;\r\n            let live2 = 0;\r\n            for (let i = 0; i <= 35; i++) {\r\n                let num = Aijs.NUMBERS[i] | 0;\r\n                if (wkMap[num] > 0) {\r\n                    live1 += wkMap[num];\r\n                }\r\n                else if (wkMap[num] < 0) {\r\n                    live2 += wkMap[num];\r\n                }\r\n            }\r\n            if (sum1 > (-1 * (live2 + sum2))) {\r\n                return 1;\r\n            }\r\n            else if (-1 * sum2 > (live1 + sum1)) {\r\n                return -1;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n    /**\r\n     * 引き分け判定。最後の一個を取るかどうかの判断\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @return {boolean}\r\n     */\r\n    static isDraw(wkMap) {\r\n        let sum1 = 0;\r\n        let sum2 = 0;\r\n        // ループだと遅いので展開\r\n        if (wkMap[0] > 0) {\r\n            sum1 += wkMap[0];\r\n        }\r\n        if (wkMap[10] > 0) {\r\n            sum1 += wkMap[10];\r\n        }\r\n        if (wkMap[20] > 0) {\r\n            sum1 += wkMap[20];\r\n        }\r\n        if (wkMap[30] > 0) {\r\n            sum1 += wkMap[30];\r\n        }\r\n        if (wkMap[40] > 0) {\r\n            sum1 += wkMap[40];\r\n        }\r\n        if (wkMap[50] > 0) {\r\n            sum1 += wkMap[50];\r\n        }\r\n        if (wkMap[5] * -1 > 0) {\r\n            sum2 -= wkMap[5];\r\n        }\r\n        if (wkMap[15] * -1 > 0) {\r\n            sum2 -= wkMap[15];\r\n        }\r\n        if (wkMap[25] * -1 > 0) {\r\n            sum2 -= wkMap[25];\r\n        }\r\n        if (wkMap[35] * -1 > 0) {\r\n            sum2 -= wkMap[35];\r\n        }\r\n        if (wkMap[45] * -1 > 0) {\r\n            sum2 -= wkMap[45];\r\n        }\r\n        if (wkMap[55] * -1 > 0) {\r\n            sum2 -= wkMap[55];\r\n        }\r\n        if (sum1 === sum2) {\r\n            if (!Aijs.isNoneNode(wkMap)) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * 手詰まり判定\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @return {boolean}\r\n     */\r\n    static isNoneNode(wkMap) {\r\n        let flag1 = false;\r\n        let flag2 = false;\r\n        for (let i = 0; i <= 35; i++) {\r\n            let panel_num = Aijs.NUMBERS[i] | 0;\r\n            if (wkMap[panel_num] === 0) {\r\n                continue;\r\n            }\r\n            let canMove = Aijs.hasCanMovePanelX(panel_num, wkMap);\r\n            if (canMove === true) {\r\n                if (wkMap[panel_num] > 0) {\r\n                    flag1 = true;\r\n                }\r\n                else if (wkMap[panel_num] < 0) {\r\n                    flag2 = true;\r\n                }\r\n            }\r\n            if (flag1 && flag2) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    /**\r\n     * 動かせるマスを返す。Return:[NN,NN,NN...]\r\n     * @param  {number}  panel_num\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @return {boolean}\r\n     */\r\n    static hasCanMovePanelX(panel_num, wkMap) {\r\n        let number = wkMap[panel_num] | 0;\r\n        let x = ~~(panel_num / 10); // [~~]=Math.floor \r\n        let y = ~~(panel_num % 10);\r\n        // アガリのコマは動かしたらダメ。何も無いマスも動かしようがない。\r\n        if ((number > 0 && y === 0) || (number < 0 && y === 5) || number === 0) {\r\n            return false;\r\n        }\r\n        for (let i = 0; i < 9; i++) {\r\n            if (Aijs.PIECES[number + 8][i] === 0) {\r\n                continue;\r\n            }\r\n            let target_x = x + ~~(i % 3) - 1;\r\n            let target_y = y + ~~(i / 3) - 1;\r\n            if (target_y < 0 || target_y > 5 || target_x > 5 || target_x < 0) {\r\n                continue;\r\n            }\r\n            let idx = target_x * 10 + target_y;\r\n            let target_number = wkMap[idx];\r\n            // 自コマとアガリのコマはとったらダメ。\r\n            if ((target_number * number > 0) || (target_number > 0 && target_y === 0) || (target_number < 0 && target_y === 5)) {\r\n                continue;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * 動かせるマスを返す。Return:[NN,NN,NN...]\r\n     * @param  {number}  panel_num\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @return {Array.<number, number>}\r\n     */\r\n    static getCanMovePanelX(panel_num, wkMap) {\r\n        let number = wkMap[panel_num] | 0;\r\n        let x = ~~(panel_num / 10); // [~~]=Math.floor \r\n        let y = ~~(panel_num % 10);\r\n        let canMove = [];\r\n        // アガリのコマは動かしたらダメ。何も無いマスも動かしようがない。\r\n        if ((number > 0 && y === 0) || (number < 0 && y === 5) || number === 0) {\r\n            return canMove;\r\n        }\r\n        for (let i = 0; i < 9; i++) {\r\n            if (Aijs.PIECES[number + 8][i] === 0) {\r\n                continue;\r\n            }\r\n            let target_x = x + ~~(i % 3) - 1;\r\n            let target_y = y + ~~(i / 3) - 1;\r\n            if (target_y < 0 || target_y > 5 || target_x > 5 || target_x < 0) {\r\n                continue;\r\n            }\r\n            let idx = target_x * 10 + target_y;\r\n            let target_number = wkMap[idx] | 0;\r\n            // 自コマとアガリのコマはとったらダメ。\r\n            if ((target_number * number > 0) || (target_number > 0 && target_y === 0) || (target_number < 0 && target_y === 5)) {\r\n                continue;\r\n            }\r\n            canMove.push(idx);\r\n        }\r\n        return canMove;\r\n    }\r\n    /**\r\n     * 起こりうる次の一手を返す。Return:[[q,map0],[qmap1],[q,map2]...] //q=[prev,next]\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @param  {number}  turn_player\r\n     * @return {Array.<number,Array.<Array.<number, number>, Object.<number, number>>>}\r\n     */\r\n    static getNodeMap(wkMap, turn_player) {\r\n        let nodeList = [];\r\n        for (let i = 0; i <= 35; i++) {\r\n            let panel_num = Aijs.NUMBERS[i] | 0;\r\n            if (wkMap[panel_num] * turn_player <= 0 || wkMap[panel_num] === 0) {\r\n                continue;\r\n            }\r\n            let canMove = Aijs.getCanMovePanelX(panel_num, wkMap);\r\n            for (let num = 0; num < canMove.length; num++) {\r\n                let nodeMap = new Int8Array(wkMap);\r\n                nodeMap[canMove[num]] = nodeMap[panel_num];\r\n                nodeMap[panel_num] = 0;\r\n                nodeList.push([[panel_num, canMove[num]], nodeMap]);\r\n            }\r\n        }\r\n        return nodeList;\r\n    }\r\n    /**\r\n     * 盤面を評価して-10000〜+10000で採点数する。\r\n     * @param  {Object.<number, number>}  wkMap\r\n     * @param  {boolean}  nearwin\r\n     * @param  {Object.<number, Array.<number>>}  evalparam\r\n     * @return {number}\r\n     */\r\n    static evalMap(wkMap, nearwin, evalparam) {\r\n        let ev = 0;\r\n        // 引き分け判定\r\n        if (Aijs.isDraw(wkMap)) {\r\n            return 0;\r\n        }\r\n        // 終局判定\r\n        let end = Aijs.isEndX(wkMap, nearwin);\r\n        if (end === 1) {\r\n            return +9999999;\r\n        }\r\n        else if (end === -1) {\r\n            return -9999999;\r\n        }\r\n        // 評価\r\n        for (let i = 0; i <= 35; i++) {\r\n            let panel_num = Aijs.NUMBERS[i] | 0;\r\n            let cell_p = 0;\r\n            let p = wkMap[panel_num];\r\n            let line;\r\n            // コマの評価値を加算\r\n            if (p > 0) {\r\n                line = 5 - (panel_num % 10);\r\n                cell_p += evalparam[p][line]; // ポジションボーナス\r\n            }\r\n            else if (p < 0) {\r\n                line = (panel_num % 10);\r\n                cell_p += evalparam[-1 * p][line] * -1;\r\n            }\r\n            // 評価値に加算。\r\n            ev += cell_p;\r\n        }\r\n        return (ev | 0);\r\n    }\r\n    /**\r\n     * よく考える\r\n     */\r\n    static deepThinkAllAB(map, turn_player, depth, a, b, nearwin, evalparam) {\r\n        let best_score = turn_player * 9999999 * -1;\r\n        let besthand;\r\n        if (depth === 0) {\r\n            best_score = Aijs.evalMap(map, nearwin, evalparam);\r\n            return [besthand, best_score];\r\n        }\r\n        if (a === void 0 || b === void 0) {\r\n            a = 9999999 * turn_player * -1;\r\n            b = 9999999 * turn_player;\r\n        }\r\n        let nodeList = Aijs.getNodeMap(map, turn_player);\r\n        for (let i = 0; i < nodeList.length; i++) {\r\n            let hand = nodeList[i][0];\r\n            let map0 = nodeList[i][1];\r\n            let sc = 0;\r\n            // 必勝            \r\n            let end = Aijs.isEndX(map0, nearwin);\r\n            if (end === turn_player) {\r\n                return [hand, 999999 * turn_player];\r\n            }\r\n            // 必敗\r\n            if (end === turn_player * -1) {\r\n                if (besthand === void 0) {\r\n                    best_score = 999999 * turn_player * -1;\r\n                    besthand = hand;\r\n                }\r\n                continue;\r\n            }\r\n            if (Aijs.isNoneNode(map0)) {\r\n                sc = 0;\r\n            }\r\n            else {\r\n                sc = Aijs.deepThinkAllAB(map0, turn_player * -1, depth - 1, b, a, nearwin, evalparam)[1];\r\n            }\r\n            if (besthand === void 0) {\r\n                best_score = sc;\r\n                besthand = hand;\r\n            }\r\n            if (turn_player === 1 && sc > best_score) {\r\n                best_score = sc;\r\n                besthand = hand;\r\n            }\r\n            else if (turn_player === -1 && sc < best_score) {\r\n                best_score = sc;\r\n                besthand = hand;\r\n            }\r\n            if (turn_player === 1 && a < best_score || turn_player === -1 && a > best_score) {\r\n                a = best_score;\r\n            }\r\n            if (turn_player === 1 && b <= best_score || turn_player === -1 && b >= best_score) {\r\n                break;\r\n            }\r\n        }\r\n        return [besthand, best_score];\r\n    }\r\n    /**\r\n     * 考える\r\n     */\r\n    static thinkAI(map, turn_player, depth, a, b, evalparam) {\r\n        let nearwin = false;\r\n        let hand = [undefined, 0];\r\n        let wkMap = new Int8Array(map);\r\n        if (!evalparam) {\r\n            evalparam = Aijs.DEFAULT_EVALPARAM;\r\n        }\r\n        if (Aijs.isEndX(wkMap, false) !== 0) {\r\n            nearwin = true;\r\n        }\r\n        hand = Aijs.deepThinkAllAB(wkMap, turn_player, depth, a, b, nearwin, evalparam);\r\n        if (hand[1] * turn_player === -999999) {\r\n            hand = Aijs.deepThinkAllAB(wkMap, turn_player, 1, a, b, nearwin, evalparam);\r\n        }\r\n        return hand;\r\n    }\r\n}\r\n/**\r\n * 駒の進める方向\r\n * @const\r\n * @type {Array.<Array.<number>>}\r\n * index+8:コマの数字\r\n */\r\nAijs.PIECES = [\r\n    [0, 0, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 0, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [0, 0, 0,\r\n        0, 0, 0,\r\n        0, 0, 0],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        1, 0, 1,\r\n        1, 0, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 1, 1],\r\n    [1, 1, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        1, 0, 1],\r\n    [1, 0, 1,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 1, 0],\r\n    [0, 1, 0,\r\n        0, 0, 0,\r\n        0, 0, 0]\r\n];\r\n/**\r\n * 盤の番号\r\n * @const\r\n * @type {Array.<number>}\r\n */\r\nAijs.NUMBERS = [0, 1, 2, 3, 4, 5,\r\n    10, 11, 12, 13, 14, 15,\r\n    20, 21, 22, 23, 24, 25,\r\n    30, 31, 32, 33, 34, 35,\r\n    40, 41, 42, 43, 44, 45,\r\n    50, 51, 52, 53, 54, 55];\r\n/**\r\n * 初期評価関数\r\n * @const\r\n * @type {Object.<number, Array.<number>>}\r\n */\r\nAijs.DEFAULT_EVALPARAM = [\r\n    [],\r\n    [1800, 1850, 1900, 1950, 2100, 2800],\r\n    [1800, 1860, 1920, 2100, 2400, 3800],\r\n    [1450, 1520, 1590, 1900, 2350, 4450],\r\n    [1450, 1530, 1610, 2050, 2650, 5450],\r\n    [1350, 1440, 1530, 2100, 2850, 6350],\r\n    [1350, 1450, 1550, 2250, 3150, 7350],\r\n    [1250, 1360, 1470, 2300, 3350, 8250],\r\n    [1250, 1370, 1490, 2450, 4350, 11250] //8\r\n];\r\n","export class GameState {\r\n    constructor() {\r\n        this.goaled = false;\r\n        this.turn_player = 0;\r\n        this.blueScore = 0;\r\n        this.redScore = 0;\r\n        this.winner = null;\r\n        this.message = '';\r\n        this.demo = true;\r\n        this.thisHand = undefined;\r\n        /*  let thisMap = {\r\n            0: -1, 10: -2, 20: -3, 30: -4, 40: -5, 50: -6,\r\n            1: 0, 11: -8, 21: 0, 31: 0, 41: -7, 51: 0,\r\n            2: 0, 12: 0, 22: 0, 32: 0, 42: 0, 52: 0,\r\n            3: 0, 13: 0, 23: 0, 33: 0, 43: 0, 53: 0,\r\n            4: 0, 14: 7, 24: 0, 34: 0, 44: 8, 54: 0,\r\n            5: 6, 15: 5, 25: 4, 35: 3, 45: 2, 55: 1\r\n          };*/\r\n        this.thisMap = new Int8Array([\r\n            -1, 0, 0, 0, 0, 6, 0, 0, 0, 0, -2, -8,\r\n            0, 0, 7, 5, 0, 0, 0, 0, -3, 0, 0, 0,\r\n            0, 4, 0, 0, 0, 0, -4, 0, 0, 0, 0,\r\n            3, 0, 0, 0, 0, -5, -7, 0, 0, 8, 2,\r\n            0, 0, 0, 0, -6, 0, 0, 0, 0, 1\r\n        ]);\r\n        this.mouse_x = 0;\r\n        this.mouse_y = 0;\r\n        this.hover_piece = null;\r\n        this.demo_inc = 0;\r\n        this.autoLog = false;\r\n        this.isTouch = true;\r\n    }\r\n}\r\n","import { Aijs } from \"./ai\";\r\nexport class View {\r\n    constructor() {\r\n        this.CellSize = 0;\r\n        this.Ratio = 1;\r\n        this.Img_bk_loaded = false;\r\n        this.Img_bk = null;\r\n        this.ctx = null;\r\n        this.canv_board = null;\r\n        this.canv_board2 = null;\r\n        this.canv_focus = null;\r\n        this.canv_pieces = null;\r\n        this.canv_shadow = null;\r\n        this.canv_hover_piece = null;\r\n        this.canv_overlay = null;\r\n        this.canv_bk = null;\r\n        this.canv_cover = null;\r\n        this.canv_score = null;\r\n        this.canv_cache = null;\r\n        this.cache_on = false;\r\n        this.COLOR_LINE = '#333333';\r\n        this.COLOR_PANEL_1 = '#660033';\r\n        this.COLOR_PANEL_2 = '#004466';\r\n        this.COLOR_PANEL_3 = '#FFFFFF';\r\n        this.COLOR_PANEL_4 = '#111111';\r\n        this.COLOR_PANEL_5 = '#444444';\r\n        this.COLOR_PANEL_6 = '#888888';\r\n        this.COLOR_SELECT = '#7fed7f';\r\n        this.COLOR_SELECT2 = '#148d14';\r\n        this.COLOR_RED = '#E60073';\r\n        this.COLOR_BLUE = '#0099E6';\r\n        this.COLOR_RED2 = '#E60073';\r\n        this.COLOR_BLUE2 = '#0099E6';\r\n        this.COLOR_WHITE = '#FFFFFF';\r\n        this.CANV_SIZE = 0;\r\n        this.PIECES = {\r\n            '1': [1, 1, 1,\r\n                1, 0, 1,\r\n                1, 1, 1],\r\n            '2': [1, 1, 1,\r\n                1, 0, 1,\r\n                1, 0, 1],\r\n            '3': [1, 1, 1,\r\n                0, 0, 0,\r\n                1, 1, 1],\r\n            '4': [1, 1, 1,\r\n                0, 0, 0,\r\n                1, 0, 1],\r\n            '5': [1, 0, 1,\r\n                0, 0, 0,\r\n                1, 0, 1],\r\n            '6': [1, 0, 1,\r\n                0, 0, 0,\r\n                0, 1, 0],\r\n            '7': [0, 1, 0,\r\n                0, 0, 0,\r\n                0, 1, 0],\r\n            '8': [0, 1, 0,\r\n                0, 0, 0,\r\n                0, 0, 0],\r\n            '-1': [1, 1, 1,\r\n                1, 0, 1,\r\n                1, 1, 1],\r\n            '-2': [1, 0, 1,\r\n                1, 0, 1,\r\n                1, 1, 1],\r\n            '-3': [1, 1, 1,\r\n                0, 0, 0,\r\n                1, 1, 1],\r\n            '-4': [1, 0, 1,\r\n                0, 0, 0,\r\n                1, 1, 1],\r\n            '-5': [1, 0, 1,\r\n                0, 0, 0,\r\n                1, 0, 1],\r\n            '-6': [0, 1, 0,\r\n                0, 0, 0,\r\n                1, 0, 1],\r\n            '-7': [0, 1, 0,\r\n                0, 0, 0,\r\n                0, 1, 0],\r\n            '-8': [0, 0, 0,\r\n                0, 0, 0,\r\n                0, 1, 0]\r\n        };\r\n        if (window.devicePixelRatio !== undefined && window.devicePixelRatio != 1) {\r\n            this.Ratio = window.devicePixelRatio;\r\n        }\r\n        this.CANV_SIZE = 500 * this.Ratio;\r\n        this.Img_bk = new Image();\r\n        this.Img_bk.src = 'bk.gif';\r\n    }\r\n    init() {\r\n        var _a;\r\n        this.ctx = (_a = document.querySelector('#canv')) === null || _a === void 0 ? void 0 : _a.getContext('2d');\r\n        this.canv_board = document.createElement('canvas');\r\n        this.canv_board.width = this.CANV_SIZE;\r\n        this.canv_board.height = this.CANV_SIZE;\r\n        this.canv_board2 = document.createElement('canvas');\r\n        this.canv_board2.width = this.CANV_SIZE;\r\n        this.canv_board2.height = this.CANV_SIZE;\r\n        this.canv_focus = document.createElement('canvas');\r\n        this.canv_focus.width = this.CANV_SIZE;\r\n        this.canv_focus.height = this.CANV_SIZE;\r\n        this.canv_pieces = document.createElement('canvas');\r\n        this.canv_pieces.width = this.CANV_SIZE;\r\n        this.canv_pieces.height = this.CANV_SIZE;\r\n        this.canv_shadow = document.createElement('canvas');\r\n        this.canv_shadow.width = this.CANV_SIZE;\r\n        this.canv_shadow.height = this.CANV_SIZE;\r\n        this.canv_hover_piece = document.createElement('canvas');\r\n        this.canv_hover_piece.width = this.CANV_SIZE;\r\n        this.canv_hover_piece.height = this.CANV_SIZE;\r\n        this.canv_overlay = document.createElement('canvas');\r\n        this.canv_overlay.width = this.CANV_SIZE;\r\n        this.canv_overlay.height = this.CANV_SIZE;\r\n        this.canv_bk = document.createElement('canvas');\r\n        this.canv_bk.width = this.CANV_SIZE;\r\n        this.canv_bk.height = this.CANV_SIZE;\r\n        this.canv_cover = document.createElement('canvas');\r\n        this.canv_cover.width = this.CANV_SIZE;\r\n        this.canv_cover.height = this.CANV_SIZE;\r\n        this.canv_score = document.createElement('canvas');\r\n        this.canv_score.width = this.CANV_SIZE;\r\n        this.canv_score.height = this.CANV_SIZE;\r\n        this.canv_cache = document.createElement('canvas');\r\n        this.canv_cache.width = this.CANV_SIZE;\r\n        this.canv_cache.height = this.CANV_SIZE;\r\n        this.CellSize = this.CANV_SIZE / 6;\r\n        //retina対応\r\n        this.ctx.canvas.style.width = this.CANV_SIZE / this.Ratio + \"px\";\r\n        this.ctx.canvas.style.height = this.CANV_SIZE / this.Ratio + \"px\";\r\n        this.ctx.canvas.width = this.CANV_SIZE;\r\n        this.ctx.canvas.height = this.CANV_SIZE;\r\n    }\r\n    /**\r\n     * 画面描画。\r\n     */\r\n    flush(gameState, initflg, cache_flg) {\r\n        let wkMap = new Int8Array(gameState.thisMap);\r\n        this.ctx.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        if (cache_flg === false) {\r\n            this.cache_on = false;\r\n        }\r\n        // キャッシュに保存\r\n        if (cache_flg === false || this.cache_on === false) {\r\n            // 盤面を描画\r\n            this.ctx.drawImage(this.drawBoard(initflg), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            // テカリを描画\r\n            this.ctx.drawImage(this.drawBoard2(initflg), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            // 選択したコマを除外\r\n            if (gameState.hover_piece !== null) {\r\n                wkMap[gameState.hover_piece] = 0;\r\n            }\r\n            // 残像を表示\r\n            this.ctx.drawImage(this.drawShadow(wkMap, gameState.thisHand), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            // コマを表示\r\n            this.ctx.drawImage(this.drawPieceAll(wkMap), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            // キャッシュに保存\r\n            let ctx_canv = this.canv_cache.getContext('2d');\r\n            ctx_canv.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            ctx_canv.drawImage(this.ctx.canvas, 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            // キャッシュ有効化\r\n            this.cache_on = true;\r\n        }\r\n        else {\r\n            // キャッシュから描画\r\n            this.ctx.drawImage(this.canv_cache, 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        }\r\n        // 選択したコマを表示\r\n        this.ctx.drawImage(this.drawHoverPiece(gameState), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        if ((gameState.mouse_x !== 0 || gameState.mouse_y !== 0) && gameState.demo === false) {\r\n            // フォーカスを描画\r\n            this.ctx.drawImage(this.drawFocus(gameState), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        }\r\n        //スコアを表示\r\n        if (gameState.goaled || gameState.winner !== null) {\r\n            if (gameState.demo === false && gameState.autoLog == false) {\r\n                this.ctx.drawImage(this.drawScore(gameState), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n            }\r\n        }\r\n        // メッセージを描画\r\n        this.ctx.drawImage(this.drawOverlay(gameState), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        // カバーを描画\r\n        if (gameState.demo === true) {\r\n            this.ctx.drawImage(this.drawCover(gameState), 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        }\r\n    }\r\n    /**\r\n     * 背景描画\r\n     */\r\n    drawBk() {\r\n        let ctx_bk = this.canv_bk.getContext('2d');\r\n        if (this.Img_bk_loaded) {\r\n            ctx_bk.drawImage(this.Img_bk, 0, 0, this.CANV_SIZE / this.Ratio, this.CANV_SIZE / this.Ratio, 0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        }\r\n        return this.canv_bk;\r\n    }\r\n    /**\r\n     * カバー描画\r\n     */\r\n    drawCover(gameState) {\r\n        // 背景\r\n        let ctx_cover = this.canv_cover.getContext('2d');\r\n        ctx_cover.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        ctx_cover.globalAlpha = 0.50;\r\n        ctx_cover.fillStyle = '#000000';\r\n        ctx_cover.fillRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        // 枠\r\n        let x = this.CellSize * 2;\r\n        let y = this.CellSize * 3.5;\r\n        ctx_cover.shadowBlur = 20;\r\n        ctx_cover.shadowColor = 'rgba(0, 0, 0, 0.3)';\r\n        ctx_cover.shadowOffsetX = 5;\r\n        ctx_cover.shadowOffsetY = 5;\r\n        ctx_cover.globalAlpha = 0.8;\r\n        ctx_cover.fillStyle = this.COLOR_WHITE;\r\n        ctx_cover.beginPath();\r\n        this.fillRoundRect(ctx_cover, x, y, this.CellSize * 2, this.CellSize * 1, this.CellSize / 20);\r\n        ctx_cover.shadowColor = 'rgba(0, 0, 0, 0)';\r\n        ctx_cover.shadowBlur = 0;\r\n        ctx_cover.shadowOffsetX = 0;\r\n        ctx_cover.shadowOffsetY = 0;\r\n        // 文字\r\n        let fontsize = Math.round(this.CellSize * 0.5);\r\n        let message = 'Play';\r\n        message += (gameState.demo_inc % 10 == 0) ? \" \" : \"\";\r\n        ctx_cover.shadowBlur = 0;\r\n        ctx_cover.shadowOffsetX = 0;\r\n        ctx_cover.shadowOffsetY = 0;\r\n        ctx_cover.shadowColor = 'rgba(0, 0, 0, 0)';\r\n        ctx_cover.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n        ctx_cover.globalAlpha = 1;\r\n        ctx_cover.fillStyle = this.COLOR_LINE;\r\n        ctx_cover.textBaseline = 'middle';\r\n        ctx_cover.textAlign = 'center';\r\n        ctx_cover.beginPath();\r\n        ctx_cover.fillText(message, this.CellSize * 3, this.CellSize * 4);\r\n        // 文字２\r\n        message = 'colamone';\r\n        fontsize = Math.round(this.CellSize * 1);\r\n        ctx_cover.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n        ctx_cover.fillStyle = this.COLOR_WHITE;\r\n        ctx_cover.shadowBlur = 0;\r\n        ctx_cover.beginPath();\r\n        ctx_cover.fillText(message, this.CellSize * 3, this.CellSize * 2);\r\n        return this.canv_cover;\r\n    }\r\n    /**\r\n     * スコア描画\r\n     */\r\n    drawScore(gameState) {\r\n        // 背景\r\n        let ctx_score = this.canv_score.getContext('2d');\r\n        let message = \"\";\r\n        let fontsize = Math.round(this.CellSize * 1.5);\r\n        let blue = this.COLOR_BLUE2;\r\n        let red = this.COLOR_RED2;\r\n        ctx_score.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        ctx_score.globalAlpha = 0.4;\r\n        ctx_score.textBaseline = 'middle';\r\n        ctx_score.textAlign = 'center';\r\n        ctx_score.shadowBlur = 10;\r\n        ctx_score.shadowColor = 'rgba(0, 0, 0, 0.5)';\r\n        ctx_score.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n        // 文字\r\n        ctx_score.globalAlpha = 0.3;\r\n        ctx_score.shadowBlur = 2;\r\n        ctx_score.shadowColor = 'rgba(255, 255, 255, 1)';\r\n        ctx_score.fillStyle = red;\r\n        message = String(gameState.redScore);\r\n        ctx_score.beginPath();\r\n        ctx_score.fillText(message, this.CellSize * 1, this.CellSize * 3.8);\r\n        // 文字\r\n        message = \"8\";\r\n        ctx_score.beginPath();\r\n        ctx_score.fillText(message, this.CellSize * 2, this.CellSize * 5.3);\r\n        //線\r\n        ctx_score.lineWidth = this.CellSize * 0.2;\r\n        ctx_score.strokeStyle = red;\r\n        ctx_score.beginPath();\r\n        ctx_score.moveTo(this.CellSize * 0.4, this.CellSize * 5.55);\r\n        ctx_score.lineTo(this.CellSize * 2.6, this.CellSize * 3.55);\r\n        ctx_score.closePath();\r\n        ctx_score.stroke();\r\n        // 文字\r\n        message = String(gameState.blueScore);\r\n        ctx_score.fillStyle = blue;\r\n        ctx_score.beginPath();\r\n        ctx_score.fillText(message, this.CellSize * 4, this.CellSize * 0.7);\r\n        // 文字\r\n        message = \"8\";\r\n        ctx_score.beginPath();\r\n        ctx_score.fillText(message, this.CellSize * 5, this.CellSize * 2.3);\r\n        // 文字\r\n        ctx_score.lineWidth = this.CellSize * 0.2;\r\n        ctx_score.strokeStyle = blue;\r\n        ctx_score.beginPath();\r\n        ctx_score.moveTo(this.CellSize * 3.4, this.CellSize * 2.55);\r\n        ctx_score.lineTo(this.CellSize * 5.6, this.CellSize * 0.55);\r\n        ctx_score.closePath();\r\n        ctx_score.stroke();\r\n        return this.canv_score;\r\n    }\r\n    /**\r\n     * フォーカスを描画\r\n     */\r\n    drawFocus(gameState) {\r\n        // 選択マスを強調\r\n        let x = gameState.mouse_x - (gameState.mouse_x % this.CellSize);\r\n        let y = gameState.mouse_y - (gameState.mouse_y % this.CellSize);\r\n        let ctx_focus = this.canv_focus.getContext('2d');\r\n        let grad = ctx_focus.createRadialGradient(x, y, 0, x, y, this.CellSize);\r\n        grad.addColorStop(0.3, this.COLOR_SELECT);\r\n        grad.addColorStop(1, this.COLOR_SELECT2);\r\n        ctx_focus.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        ctx_focus.globalAlpha = 0.35;\r\n        ctx_focus.fillStyle = grad;\r\n        ctx_focus.lineWidth = 1;\r\n        ctx_focus.beginPath();\r\n        ctx_focus.fillRect(x, y, this.CellSize, this.CellSize);\r\n        if (gameState.isTouch === true && gameState.hover_piece === null) {\r\n            return this.canv_focus;\r\n        }\r\n        // 移動可能マスを強調\r\n        let target = (x / this.CellSize) * 10 + (y / this.CellSize);\r\n        if (gameState.thisMap[target] * gameState.turn_player > 0) {\r\n            let canm = Aijs.getCanMovePanelX(target, gameState.thisMap);\r\n            for (let i = 0; i <= canm.length - 1; i++) {\r\n                x = Math.floor(canm[i] / 10);\r\n                y = Math.floor(canm[i] % 10);\r\n                ctx_focus.globalAlpha = 0.6;\r\n                ctx_focus.strokeStyle = this.COLOR_SELECT;\r\n                ctx_focus.lineWidth = this.CellSize / 20;\r\n                ctx_focus.beginPath();\r\n                ctx_focus.arc(x * this.CellSize + (this.CellSize / 2), y * this.CellSize + (this.CellSize / 2), (this.CellSize / 2) - (this.CellSize / 10), 0, Math.PI * 2, false);\r\n                ctx_focus.stroke();\r\n            }\r\n        }\r\n        return this.canv_focus;\r\n    }\r\n    /**\r\n     * 盤面を描画してCANVASを返す。\r\n     */\r\n    drawBoard(initflg) {\r\n        if (initflg === false) {\r\n            return this.canv_board;\r\n        }\r\n        let ctx_board = this.canv_board.getContext('2d');\r\n        ctx_board.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        let grad = ctx_board.createLinearGradient(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        grad.addColorStop(0, this.COLOR_PANEL_6);\r\n        grad.addColorStop(0.3, this.COLOR_PANEL_5);\r\n        grad.addColorStop(1, this.COLOR_PANEL_4);\r\n        for (let x = 0; x < 6; x++) {\r\n            for (let y = 0; y < 6; y++) {\r\n                // パネル描画\r\n                ctx_board.strokeStyle = this.COLOR_LINE;\r\n                if (y === 0) {\r\n                    ctx_board.fillStyle = this.COLOR_PANEL_1;\r\n                }\r\n                else if (y == 5) {\r\n                    ctx_board.fillStyle = this.COLOR_PANEL_2;\r\n                }\r\n                else if ((x + y) % 2 === 0) {\r\n                    ctx_board.fillStyle = this.COLOR_PANEL_3;\r\n                }\r\n                else {\r\n                    ctx_board.fillStyle = this.COLOR_PANEL_4;\r\n                    ctx_board.fillStyle = grad;\r\n                }\r\n                ctx_board.beginPath();\r\n                ctx_board.fillRect(x * this.CellSize, y * this.CellSize, this.CellSize, this.CellSize);\r\n                ctx_board.strokeRect(x * this.CellSize, y * this.CellSize, this.CellSize, this.CellSize);\r\n            }\r\n        }\r\n        return this.canv_board;\r\n    }\r\n    /**\r\n     * 盤面をテカテカにする。\r\n     */\r\n    drawBoard2(initflg) {\r\n        if (initflg === false) {\r\n            return this.canv_board2;\r\n        }\r\n        let ctx_board2 = this.canv_board2.getContext('2d');\r\n        ctx_board2.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        ctx_board2.globalAlpha = 0.07;\r\n        ctx_board2.fillStyle = this.COLOR_WHITE;\r\n        ctx_board2.beginPath();\r\n        ctx_board2.arc(this.CellSize * 1, -3 * this.CellSize, 7 * this.CellSize, 0, Math.PI * 2, false);\r\n        ctx_board2.fill();\r\n        return this.canv_board2;\r\n    }\r\n    /**\r\n     * 浮遊しているコマを描画する。\r\n     */\r\n    drawHoverPiece(gameState) {\r\n        let ctx_hover = this.canv_hover_piece.getContext('2d');\r\n        ctx_hover.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        let x = gameState.mouse_x - (this.CellSize / 2);\r\n        let y = gameState.mouse_y - (this.CellSize / 2);\r\n        if (gameState.hover_piece !== null) {\r\n            this.drawPiece(ctx_hover, x, y, gameState.thisMap[gameState.hover_piece], false);\r\n        }\r\n        return this.canv_hover_piece;\r\n    }\r\n    /**\r\n     * コマを描画する。\r\n     */\r\n    drawPiece(wkCtx, x, y, number, goal) {\r\n        let wkColor;\r\n        // 外枠を描画\r\n        if (number === 0) {\r\n            return wkCtx;\r\n        }\r\n        else if (number > 0) {\r\n            wkColor = this.COLOR_BLUE;\r\n        }\r\n        else {\r\n            wkColor = this.COLOR_RED;\r\n        }\r\n        let grad = this.ctx.createLinearGradient(x, y, x + this.CellSize, y + this.CellSize);\r\n        grad.addColorStop(0, 'rgb(255, 255, 255)');\r\n        grad.addColorStop(0.4, wkColor);\r\n        grad.addColorStop(1, wkColor);\r\n        wkCtx.shadowBlur = 10;\r\n        wkCtx.shadowColor = 'rgba(0, 0, 0, 1)';\r\n        wkCtx.shadowOffsetX = 2;\r\n        wkCtx.shadowOffsetY = 2;\r\n        wkCtx.fillStyle = grad;\r\n        wkCtx.beginPath();\r\n        this.fillRoundRect(wkCtx, x + this.CellSize / 10, y + this.CellSize / 10, this.CellSize - 1 * this.CellSize / 5, this.CellSize - 1 * this.CellSize / 5, this.CellSize / 20);\r\n        wkCtx.shadowColor = 'rgba(0, 0, 0, 0)';\r\n        wkCtx.shadowBlur = 0;\r\n        wkCtx.shadowOffsetX = 0;\r\n        wkCtx.shadowOffsetY = 0;\r\n        // 曇りエフェクト\r\n        if (this.Img_bk_loaded) {\r\n            wkCtx.globalAlpha = 0.35;\r\n            wkCtx.save();\r\n            wkCtx.clip();\r\n            wkCtx.drawImage(this.drawBk(), x + this.CellSize / 10, y + this.CellSize / 10, this.CellSize - 1 * this.CellSize / 5, this.CellSize - 1 * this.CellSize / 5);\r\n            wkCtx.restore();\r\n            wkCtx.globalAlpha = 1;\r\n        }\r\n        // 文字を描画。\r\n        wkCtx.fillStyle = this.COLOR_WHITE;\r\n        let fontsize = Math.round(this.CellSize * 0.18);\r\n        wkCtx.textBaseline = 'middle';\r\n        wkCtx.textAlign = 'center';\r\n        wkCtx.font = fontsize + \"pt 'Play',Arial\";\r\n        wkCtx.beginPath();\r\n        // 数字を印字\r\n        wkCtx.fillText(String(Math.abs(number)), x + (this.CellSize / 2), y + (this.CellSize / 2));\r\n        // 点を描画\r\n        for (let i = 0; i <= this.PIECES[number].length - 1; i++) {\r\n            if (this.PIECES[number][i] === 0) {\r\n                continue;\r\n            }\r\n            let x_dot = x + this.CellSize / 4.16 + (Math.floor(this.CellSize - 1 * this.CellSize / 5) / 3) * Math.floor(i % 3.0);\r\n            let y_dot = y + this.CellSize / 4.16 + (Math.floor(this.CellSize - 1 * this.CellSize / 5) / 3) * Math.floor(i / 3.0);\r\n            wkCtx.fillStyle = this.COLOR_WHITE;\r\n            wkCtx.beginPath();\r\n            wkCtx.arc(x_dot, y_dot, this.CellSize * 0.06, 0, Math.PI * 2, false);\r\n            wkCtx.fill();\r\n        }\r\n        if (goal) { // 得点を印字\r\n            wkCtx.shadowBlur = 10;\r\n            wkCtx.shadowColor = 'rgba(0, 0, 0, 1)';\r\n            wkCtx.globalAlpha = 1;\r\n            wkCtx.fillStyle = this.COLOR_WHITE;\r\n            fontsize = Math.round(this.CellSize * 0.5);\r\n            wkCtx.textBaseline = 'middle';\r\n            wkCtx.textAlign = 'center';\r\n            wkCtx.font = 'bolder ' + fontsize + 'pt Play,Arial ';\r\n            wkCtx.beginPath();\r\n            wkCtx.fillText(String(Math.abs(number)), x + (this.CellSize / 2), y + (this.CellSize / 2));\r\n            wkCtx.globalAlpha = 1;\r\n            wkCtx.shadowColor = 'rgba(0, 0, 0, 0)';\r\n            wkCtx.shadowBlur = 0;\r\n        }\r\n        return wkCtx;\r\n    }\r\n    // 角丸\r\n    fillRoundRect(ctx, x, y, w, h, r) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + r, y);\r\n        ctx.lineTo(x + w - r, y);\r\n        ctx.arc(x + w - r, y + r, r, Math.PI * 1.5, 0, false);\r\n        ctx.lineTo(x + w, y + h - r);\r\n        ctx.arc(x + w - r, y + h - r, r, 0, Math.PI * 0.5, false);\r\n        ctx.lineTo(x + r, y + h);\r\n        ctx.arc(x + r, y + h - r, r, Math.PI * 0.5, Math.PI, false);\r\n        ctx.lineTo(x, y + r);\r\n        ctx.arc(x + r, y + r, r, Math.PI, Math.PI * 1.5, false);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n    }\r\n    /**\r\n     * コマをすべて描画\r\n     */\r\n    drawPieceAll(wkMap) {\r\n        let ctx_pieces = this.canv_pieces.getContext('2d');\r\n        ctx_pieces.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        for (let x = 0; x < 6; x++) {\r\n            for (let y = 0; y < 6; y++) {\r\n                if (wkMap[x * 10 + y] !== 0) {\r\n                    let goal = false;\r\n                    if (wkMap[x * 10 + y] > 0 && y === 0) {\r\n                        goal = true;\r\n                    }\r\n                    else if (wkMap[x * 10 + y] < 0 && y == 5) {\r\n                        goal = true;\r\n                    }\r\n                    ctx_pieces = this.drawPiece(ctx_pieces, x * this.CellSize, y * this.CellSize, wkMap[x * 10 + y], goal);\r\n                }\r\n            }\r\n        }\r\n        return this.canv_pieces;\r\n    }\r\n    /**\r\n     * 残像を描画する。\r\n     */\r\n    drawShadow(wkMap, hand) {\r\n        let ctx_shadow = this.canv_shadow.getContext('2d');\r\n        ctx_shadow.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        if (hand === undefined) {\r\n            return this.canv_shadow;\r\n        }\r\n        let x0 = (hand[0] / 10 | 0);\r\n        let y0 = hand[0] % 10;\r\n        let x1 = (hand[1] / 10 | 0);\r\n        let y1 = hand[1] % 10;\r\n        let h = this.CellSize - 1 * this.CellSize / 5;\r\n        let w = this.CellSize - 1 * this.CellSize / 5;\r\n        let x = x1 * this.CellSize + this.CellSize / 10;\r\n        let y = y1 * this.CellSize + this.CellSize / 10;\r\n        let shadow_start_x = x + w / 2;\r\n        let shadow_start_y = y + h / 2;\r\n        let shadow_end_x = shadow_start_x;\r\n        let shadow_end_y = shadow_start_y;\r\n        let number = wkMap[hand[1]];\r\n        let wkColor = '';\r\n        let center = 0;\r\n        let grad;\r\n        if (hand.length != 2) {\r\n            return this.canv_shadow;\r\n        }\r\n        if (number > 0) {\r\n            wkColor = this.COLOR_BLUE; // \"#EAEFFD\";   \r\n        }\r\n        else {\r\n            wkColor = this.COLOR_RED; // \"#FDEAFA\";           \r\n        }\r\n        if (x0 == x1 || y0 == y1) { // 直角移動\r\n            if ((x0 + y0) % 2 === 0 && y0 !== 0 && y0 != 5) {\r\n                center = 0.5;\r\n            }\r\n            else {\r\n                center = 0.3;\r\n            }\r\n            if (x0 < x1) {\r\n                x = x - w + 10;\r\n                shadow_end_x = shadow_end_x - w;\r\n            }\r\n            if (x0 > x1) {\r\n                x = x + w - 10;\r\n                shadow_end_x = shadow_end_x + w;\r\n            }\r\n            if (y0 < y1) {\r\n                y = y - h + 10;\r\n                shadow_end_y = shadow_end_y - h;\r\n            }\r\n            if (y0 > y1) {\r\n                y = y + h - 10;\r\n                shadow_end_y = shadow_end_y + h;\r\n            }\r\n            grad = ctx_shadow.createLinearGradient(shadow_start_x, shadow_start_y, shadow_end_x, shadow_end_y);\r\n            grad.addColorStop(0, wkColor);\r\n            grad.addColorStop(center, wkColor);\r\n            grad.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n            ctx_shadow.fillStyle = grad;\r\n            ctx_shadow.fillRect(x, y, h, w);\r\n        }\r\n        else { // 斜め移動\r\n            if ((x0 + y0) % 2 === 0 && y0 !== 0 && y0 != 5) {\r\n                center = 0.3;\r\n            }\r\n            else {\r\n                center = 0.5;\r\n            }\r\n            let [px1, py1, px2, py2, px3, py3, px4, py4] = [0, 0, 0, 0, 0, 0, 0, 0];\r\n            if (x0 < x1 && y0 < y1) {\r\n                px1 = x;\r\n                py1 = y - h;\r\n                px2 = x + w;\r\n                py2 = y;\r\n                px3 = x;\r\n                py3 = y + h;\r\n                px4 = x - w;\r\n                py4 = y;\r\n                shadow_end_x = shadow_end_x - w;\r\n                shadow_end_y = shadow_end_y - h;\r\n                shadow_start_x = shadow_start_x + w * 2;\r\n                shadow_start_y = shadow_start_y + h * 2;\r\n            }\r\n            if (x0 > x1 && y0 > y1) {\r\n                px1 = x + w;\r\n                py1 = y;\r\n                px2 = x + w + w;\r\n                py2 = y + h;\r\n                px3 = x + w;\r\n                py3 = y + h + h;\r\n                px4 = x;\r\n                py4 = y + h;\r\n                shadow_end_x = shadow_end_x + w;\r\n                shadow_end_y = shadow_end_y + h;\r\n                shadow_start_x = shadow_start_x - w * 2;\r\n                shadow_start_y = shadow_start_y - h * 2;\r\n            }\r\n            if (x0 < x1 && y0 > y1) {\r\n                px1 = x;\r\n                py1 = y;\r\n                px2 = x + w;\r\n                py2 = y + h;\r\n                px3 = x;\r\n                py3 = y + h + h;\r\n                px4 = x - w;\r\n                py4 = y + h;\r\n                shadow_end_x = shadow_end_x - w;\r\n                shadow_end_y = shadow_end_y + h;\r\n                shadow_start_x = shadow_start_x + w * 2;\r\n                shadow_start_y = shadow_start_y - h * 2;\r\n            }\r\n            if (x0 > x1 && y0 < y1) {\r\n                px1 = x + w;\r\n                py1 = y - h;\r\n                px2 = x + w + w;\r\n                py2 = y;\r\n                px3 = x + w;\r\n                py3 = y + h;\r\n                px4 = x;\r\n                py4 = y;\r\n                shadow_end_x = shadow_end_x + w;\r\n                shadow_end_y = shadow_end_y - h;\r\n                shadow_start_x = shadow_start_x - w * 2;\r\n                shadow_start_y = shadow_start_y + h * 2;\r\n            }\r\n            ctx_shadow.beginPath();\r\n            ctx_shadow.moveTo(px1, py1);\r\n            ctx_shadow.lineTo(px2, py2);\r\n            ctx_shadow.lineTo(px3, py3);\r\n            ctx_shadow.lineTo(px4, py4);\r\n            ctx_shadow.lineTo(px1, py1);\r\n            ctx_shadow.closePath();\r\n            grad = ctx_shadow.createLinearGradient(shadow_start_x, shadow_start_y, shadow_end_x, shadow_end_y);\r\n            grad.addColorStop(0, wkColor);\r\n            grad.addColorStop(center, wkColor);\r\n            grad.addColorStop(0.97, 'rgba(255, 255, 255, 0)');\r\n            ctx_shadow.fillStyle = grad;\r\n            ctx_shadow.fill();\r\n        }\r\n        return this.canv_shadow;\r\n    }\r\n    /**\r\n     * メッセージを描画\r\n     */\r\n    drawOverlay(gameState) {\r\n        let ctx_overlay = this.canv_overlay.getContext('2d');\r\n        let x = this.CellSize * 1.3;\r\n        let y = this.CellSize * 2.5;\r\n        ctx_overlay.clearRect(0, 0, this.CANV_SIZE, this.CANV_SIZE);\r\n        if (gameState.message === '') {\r\n            return this.canv_overlay;\r\n        }\r\n        ctx_overlay.shadowBlur = 10;\r\n        ctx_overlay.shadowColor = 'rgba(100, 100, 100, 0.5)';\r\n        ctx_overlay.shadowOffsetX = 5;\r\n        ctx_overlay.shadowOffsetY = 5;\r\n        ctx_overlay.globalAlpha = 0.9;\r\n        ctx_overlay.fillStyle = this.COLOR_WHITE;\r\n        this.fillRoundRect(ctx_overlay, x, y, this.CellSize * 3.4, this.CellSize * 1, this.CellSize / 20);\r\n        let fontsize = Math.round(this.CellSize * 0.36);\r\n        ctx_overlay.shadowBlur = 0;\r\n        ctx_overlay.shadowOffsetX = 0;\r\n        ctx_overlay.shadowOffsetY = 0;\r\n        ctx_overlay.shadowColor = 'rgba(0, 0, 0, 0)';\r\n        ctx_overlay.font = 'bold ' + fontsize + 'px Play,sans-serif';\r\n        ctx_overlay.globalAlpha = 1;\r\n        ctx_overlay.fillStyle = this.COLOR_LINE;\r\n        ctx_overlay.textBaseline = 'middle';\r\n        ctx_overlay.textAlign = 'center';\r\n        ctx_overlay.beginPath();\r\n        ctx_overlay.fillText(gameState.message, this.CellSize * 3, this.CellSize * 3);\r\n        return this.canv_overlay;\r\n    }\r\n}\r\n","/* @license Copyright (c) @kurehajime / source code: https://github.com/kurehajime/colamone_js */\r\nimport { Aijs } from \"./ai\";\r\nimport { GameState } from \"./gamestate\";\r\nimport { View } from \"./view\";\r\nexport class BoardGamejs {\r\n    constructor() {\r\n        this.gameState = new GameState();\r\n        this.view = new View();\r\n        this.thinktime = 0.0;\r\n        this.intervalID = null;\r\n        this.intervalID_log = null;\r\n        this.map_list = {};\r\n        this.LIMIT_1000DAY = 3;\r\n        this.startMap = new Int8Array();\r\n        this.logPointer = 0;\r\n        this.logArray = [];\r\n        this.logArray2 = [];\r\n        this.storage = null;\r\n        /**\r\n         * マウス移動時処理\r\n         */\r\n        this.ev_mouseMove = (e) => {\r\n            var _a;\r\n            this.getMousePosition(e);\r\n            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, true);\r\n        };\r\n        /**\r\n         * タッチ移動時処理\r\n         */\r\n        this.ev_touchMove = (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        };\r\n        /**\r\n         * マウスクリック時処理\r\n         */\r\n        this.ev_mouseClick = (e) => {\r\n            var _a, _b, _c, _d, _e, _f;\r\n            this.getMousePosition(e);\r\n            let target = Math.floor(this.gameState.mouse_x / this.view.CellSize) * 10 + Math.floor(this.gameState.mouse_y / this.view.CellSize);\r\n            if (this.gameState.winner !== null || this.logArray.length !== 0) {\r\n                this.reloadnew();\r\n                return true;\r\n            }\r\n            if (this.gameState.demo === true) {\r\n                this.gameState.demo = false;\r\n                this.gameState.thisHand = undefined;\r\n                this.gameState.thisMap = Aijs.copyMap(this.startMap);\r\n                this.logArray2 = [];\r\n                (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n                this.gameState.winner = null;\r\n                this.gameState.goaled = false;\r\n                this.gameState.turn_player = 1;\r\n                window.clearInterval(this.intervalID);\r\n                (_b = this.view) === null || _b === void 0 ? void 0 : _b.flush(this.gameState, false, false);\r\n                return true;\r\n            }\r\n            if (this.gameState.hover_piece === null) {\r\n                if (this.gameState.thisMap[target] * this.gameState.turn_player > 0) {\r\n                    this.gameState.hover_piece = target;\r\n                }\r\n            }\r\n            else {\r\n                if (target == this.gameState.hover_piece) {\r\n                    this.gameState.hover_piece = null;\r\n                    (_c = this.view) === null || _c === void 0 ? void 0 : _c.flush(this.gameState, false, false);\r\n                    return true;\r\n                }\r\n                let canm = Aijs.getCanMovePanelX(this.gameState.hover_piece, this.gameState.thisMap);\r\n                if (canm.indexOf(target) >= 0) {\r\n                    (_d = this.view) === null || _d === void 0 ? void 0 : _d.flush(this.gameState, false, true);\r\n                    if (this.isGoaled(this.gameState.thisMap, target, this.gameState.turn_player)) {\r\n                        this.gameState.goaled = true;\r\n                        (_e = this.view) === null || _e === void 0 ? void 0 : _e.flush(this.gameState, false, true);\r\n                        setTimeout(() => {\r\n                            var _a;\r\n                            this.gameState.goaled = false;\r\n                            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n                        }, 2000);\r\n                    }\r\n                    this.gameState.thisMap[target] = this.gameState.thisMap[this.gameState.hover_piece];\r\n                    this.gameState.thisMap[this.gameState.hover_piece] = 0;\r\n                    this.gameState.turn_player = this.gameState.turn_player * -1;\r\n                    this.logArray2.push([this.gameState.hover_piece, target]);\r\n                    this.gameState.thisHand = [this.gameState.hover_piece, target];\r\n                    this.gameState.hover_piece = null;\r\n                    // AIが考える。\r\n                    this.gameState.message = 'thinking...';\r\n                    window.setTimeout(() => {\r\n                        var _a;\r\n                        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n                    }, 50);\r\n                    this.updateMessage();\r\n                    if (this.gameState.winner === null) {\r\n                        window.setTimeout(() => {\r\n                            var _a;\r\n                            this.ai(parseInt(document.querySelector('#level').value));\r\n                            this.gameState.message = '';\r\n                            this.updateMessage();\r\n                            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n                        }, 250);\r\n                    }\r\n                }\r\n            }\r\n            (_f = this.view) === null || _f === void 0 ? void 0 : _f.flush(this.gameState, false, false);\r\n            return true;\r\n        };\r\n        /**\r\n         * ラジオボタン変更時処理\r\n         */\r\n        this.ev_radioChange = () => {\r\n            var _a;\r\n            let num = document.querySelector('#level').value;\r\n            this.storage.setItem('level_save', num);\r\n            if (this.storage.getItem('level_' + num) > 0) {\r\n                document.querySelector('#wins').innerHTML = this.storage.getItem('level_' + num) + ' win!';\r\n            }\r\n            else {\r\n                document.querySelector('#wins').innerHTML = '';\r\n            }\r\n            this.gameState.thisMap = Aijs.copyMap(this.startMap);\r\n            this.gameState.thisHand = undefined;\r\n            this.map_list = {};\r\n            this.logArray2 = [];\r\n            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n        };\r\n        try {\r\n            if (window == parent && ('localStorage' in window) && window.localStorage !== null) {\r\n                this.storage = localStorage;\r\n                this.storage.setItem('test', 0); // Safariのプライベートモードは、できないのにできるって言うからかまをかけてみる。\r\n            }\r\n        }\r\n        catch (e) {\r\n            this.storage = null;\r\n        }\r\n        if (this.storage === null) {\r\n            // localStorageが使えない場合\r\n            this.storage = {}; // ダミー\r\n            this.storage.getItem = function () { return undefined; };\r\n            this.storage.setItem = function () { return undefined; };\r\n            if (navigator.cookieEnabled) {\r\n                this.storage.hasItem = function (sKey) {\r\n                    return (new RegExp('(?:^|;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=')).test(document.cookie);\r\n                };\r\n                this.storage.getItem = function (sKey) {\r\n                    if (!sKey || !(new RegExp('(?:^|;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=')).test(document.cookie)) {\r\n                        return null;\r\n                    }\r\n                    return unescape(document.cookie.replace(new RegExp('(?:^|.*;\\\\s*)' + escape(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*'), '$1'));\r\n                };\r\n                this.storage.setItem = function (sKey, sValue) {\r\n                    if (!sKey || /^(?:expires|max\\-age|path|domain|secure)$/i.test(sKey)) {\r\n                        return;\r\n                    }\r\n                    document.cookie = escape(sKey) + '=' + escape(sValue);\r\n                };\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * ゲーム開始\r\n     */\r\n    Run() {\r\n        var _a, _b;\r\n        this.zoom(); // 小さい端末でズーム\r\n        if (window.innerHeight < window.innerWidth) {\r\n            (_a = document.querySelector('.manual')) === null || _a === void 0 ? void 0 : _a.classList.remove(\"hide\");\r\n        }\r\n        else {\r\n            (_b = document.querySelector('.manual')) === null || _b === void 0 ? void 0 : _b.classList.add(\"hide\");\r\n        }\r\n        this.gameState.turn_player = 1;\r\n        this.gameState.demo = true;\r\n        this.view.init();\r\n        if ('ontouchstart' in window) {\r\n            this.gameState.isTouch = true;\r\n        }\r\n        else {\r\n            this.gameState.isTouch = false;\r\n        }\r\n        // イベントを設定\r\n        if (this.gameState.isTouch) {\r\n            document.querySelector('#canv').addEventListener('touchstart', this.ev_mouseClick);\r\n            document.querySelector('#canv').addEventListener('touchmove', this.ev_touchMove, { passive: false });\r\n        }\r\n        else {\r\n            document.querySelector('#canv').addEventListener('mousemove', this.ev_mouseMove);\r\n            document.querySelector('#canv').addEventListener('mouseup', this.ev_mouseClick);\r\n        }\r\n        document.querySelector('#level').addEventListener('change', this.ev_radioChange);\r\n        document.querySelector('#prevprev').addEventListener('click', () => { this.move_start(); });\r\n        document.querySelector('#prev').addEventListener('click', () => { this.move_prev(); });\r\n        document.querySelector('#next').addEventListener('click', () => { this.move_next(); });\r\n        document.querySelector('#nextnext').addEventListener('click', () => { this.move_end(); });\r\n        document.querySelector('#replay').addEventListener('click', () => { this.jumpkento(); });\r\n        document.querySelector('#tweetlog').addEventListener('click', () => { this.tweetlog(); });\r\n        document.querySelector('#newgame').addEventListener('click', () => { this.reloadnew(); });\r\n        document.querySelector('#collapsible').addEventListener('click', () => {\r\n            document.querySelector('.manual').classList.toggle(\"hide\");\r\n            if (window.innerHeight > window.innerWidth) {\r\n                var element = document.documentElement;\r\n                var bottom = element.scrollHeight - element.clientHeight;\r\n                window.scroll(0, bottom);\r\n            }\r\n        });\r\n        window.addEventListener('orientationchange', this.zoom);\r\n        this.shuffleBoard();\r\n        // 連勝記録初期化\r\n        if (!this.storage.getItem('level_1')) {\r\n            this.storage.setItem('level_1', 0);\r\n        }\r\n        if (!this.storage.getItem('level_2')) {\r\n            this.storage.setItem('level_2', 0);\r\n        }\r\n        if (!this.storage.getItem('level_3')) {\r\n            this.storage.setItem('level_3', 0);\r\n        }\r\n        if (!this.storage.getItem('level_4')) {\r\n            this.storage.setItem('level_4', 0);\r\n        }\r\n        if (!this.storage.getItem('level_5')) {\r\n            this.storage.setItem('level_5', 0);\r\n        }\r\n        // レベル記憶\r\n        if (this.storage.getItem('level_save') !== undefined && this.storage.getItem('level_save') !== 'undefined' && this.storage.getItem('level_save') !== null) {\r\n            document.querySelector('#level').value = String(parseInt(this.storage.getItem('level_save')));\r\n        }\r\n        else {\r\n            this.storage.setItem('level_save', 1);\r\n            document.querySelector('#level').value = String(1);\r\n        }\r\n        //document.querySelector('#canv').classList.add(\"hue-rotate1\");\r\n        // パラメータを取得\r\n        let paramObj = this.getParam();\r\n        // 盤面を初期化\r\n        if (paramObj.init) {\r\n            this.startMap = this.getMapByParam(paramObj.init);\r\n            this.gameState.thisMap = Aijs.copyMap(this.startMap);\r\n        }\r\n        else {\r\n            this.startMap = Aijs.copyMap(this.gameState.thisMap);\r\n        }\r\n        // ログをデコード\r\n        if (paramObj.log) {\r\n            this.logArray = this.decodeLog(paramObj.log, this.startMap);\r\n        }\r\n        // レベル取得\r\n        if (paramObj.lv) {\r\n            document.querySelector('#level').value = String(parseInt(paramObj.lv));\r\n        }\r\n        if (this.logArray.length !== 0) {\r\n            document.querySelector('#log').classList.remove(\"hide\");\r\n            document.querySelector('#prevprev').classList.remove(\"hide\");\r\n            document.querySelector('#prev').classList.remove(\"hide\");\r\n            document.querySelector('#next').classList.remove(\"hide\");\r\n            document.querySelector('#nextnext').classList.remove(\"hide\");\r\n            document.querySelector('#span_replay').classList.add(\"hide\");\r\n            document.querySelector('#span_tweetlog').classList.add(\"hide\");\r\n            document.querySelector('#next').focus();\r\n        }\r\n        else {\r\n            document.querySelector('#log').classList.add(\"hide\");\r\n            document.querySelector('#prevprev').classList.add(\"hide\");\r\n            document.querySelector('#prev').classList.add(\"hide\");\r\n            document.querySelector('#next').classList.add(\"hide\");\r\n            document.querySelector('#nextnext').classList.add(\"hide\");\r\n            document.querySelector('#span_replay').classList.add(\"hide\");\r\n            document.querySelector('#span_tweetlog').classList.add(\"hide\");\r\n        }\r\n        // 画像読み込み成功時\r\n        this.view.Img_bk.onload = () => {\r\n            var _a;\r\n            this.view.Img_bk_loaded = true;\r\n            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, true, false);\r\n        };\r\n        // 画像読み込み失敗時\r\n        this.view.Img_bk.onerror = () => {\r\n            var _a;\r\n            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, true, false);\r\n        };\r\n        // もう既に読み込み終わってた時\r\n        if (this.view.Img_bk.width !== 0) {\r\n            this.view.Img_bk_loaded = true;\r\n            this.view.flush(this.gameState, true, false);\r\n        }\r\n        // 2.5秒後に強制描画※Googleの検索結果から飛ぶとなぜか描画が走らない事があるので。\r\n        setTimeout(() => {\r\n            if (this.view.Img_bk.width !== 0) {\r\n                this.view.Img_bk_loaded = true;\r\n            }\r\n            this.view.flush(this.gameState, true, false);\r\n        }, 2500);\r\n        this.updateMessage();\r\n        this.setTweet(); // ツイートボタンを生成\r\n        if (this.logArray.length === 0) {\r\n            if (this.isBot() == false) {\r\n                window.setTimeout(() => {\r\n                    if (this.gameState.demo == true) {\r\n                        this.intervalID = window.setInterval(() => { this.playDemo(); }, 400);\r\n                        this.playDemo();\r\n                    }\r\n                }, 500);\r\n            }\r\n        }\r\n        else {\r\n            this.gameState.demo = false;\r\n            this.gameState.autoLog = true;\r\n            this.intervalID_log = window.setInterval(() => { this.playLog(); }, 1000);\r\n        }\r\n        this.gameState.goaled = false;\r\n        this.view.flush(this.gameState, true, false);\r\n    }\r\n    /**\r\n     * Demoを再生\r\n     */\r\n    playDemo() {\r\n        var _a, _b;\r\n        if (this.intervalID !== null) {\r\n            if (Math.random() > 0.3) {\r\n                this.ai(2);\r\n            }\r\n            else {\r\n                this.ai(1);\r\n            }\r\n        }\r\n        this.gameState.demo_inc++;\r\n        this.calcScore();\r\n        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n        if (this.gameState.winner === 1 || this.gameState.winner === -1 || this.gameState.winner === 0) {\r\n            this.gameState.goaled = true;\r\n            this.gameState.winner = null;\r\n            (_b = this.view) === null || _b === void 0 ? void 0 : _b.flush(this.gameState, false, false);\r\n            this.shuffleBoard();\r\n        }\r\n        if (this.gameState.demo_inc > 42) {\r\n            window.clearInterval(this.intervalID);\r\n        }\r\n    }\r\n    /**\r\n     * Logを再生\r\n     */\r\n    playLog() {\r\n        if (this.intervalID_log !== null && this.gameState.autoLog == true) {\r\n            this.move_next();\r\n        }\r\n        else {\r\n            clearInterval(this.intervalID_log);\r\n        }\r\n    }\r\n    /**\r\n     * 小さい画面ではViewportを固定化\r\n     */\r\n    zoom() {\r\n        let viewport = document.querySelector('meta[name=viewport]');\r\n        if (screen.width < 500 && screen.height < 500) {\r\n            if (screen.width < screen.height) {\r\n                viewport.setAttribute('content', 'width=500,user-scalable=no');\r\n            }\r\n            else {\r\n                viewport.setAttribute('content', 'height=500,user-scalable=no');\r\n            }\r\n        }\r\n        else if (screen.width < 500) {\r\n            viewport.setAttribute('content', 'width=500,user-scalable=no');\r\n        }\r\n        else if (screen.height < 500) {\r\n            viewport.setAttribute('content', 'height=500,user-scalable=no');\r\n        }\r\n        // iOS9のViewportはなぜか機能してくれない。\r\n        if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {\r\n            let w = screen.width;\r\n            let w2 = 520;\r\n            if (Math.abs(window.orientation) !== 0) {\r\n                w = screen.height;\r\n                w2 = 900;\r\n            }\r\n            let rate = Math.round((w / w2) * 1000) / 1000.0;\r\n            if (rate == Math.round(rate)) { // iOS 9のViewportは整数指定すると機能しない\r\n                rate += 0.0001;\r\n            }\r\n            viewport.setAttribute('content', 'initial-scale=' + rate + ', minimum-scale=' + rate + ', maximum-scale=' + rate + ', user-scalable=no');\r\n        }\r\n    }\r\n    /**\r\n     * AIに考えてもらう。\r\n     */\r\n    ai(level) {\r\n        var _a;\r\n        let hand;\r\n        let startTime = new Date();\r\n        let endTime;\r\n        // 終盤になったら長考してみる。\r\n        let count = this.getNodeCount(this.gameState.thisMap) / 2;\r\n        let plus = 0;\r\n        switch (level) {\r\n            case 1:\r\n                if (count <= 7) {\r\n                    plus++;\r\n                }\r\n                break;\r\n            case 2:\r\n                if (count <= 8) {\r\n                    plus++;\r\n                }\r\n                break;\r\n            case 3:\r\n                if (count <= 10) {\r\n                    plus++;\r\n                }\r\n                if (count <= 6) {\r\n                    plus++;\r\n                }\r\n                break;\r\n            case 4:\r\n                if (count <= 11) {\r\n                    plus++;\r\n                }\r\n                if (count <= 7) {\r\n                    plus++;\r\n                }\r\n                break;\r\n            case 5:\r\n                if (count > 16) {\r\n                    plus--;\r\n                }\r\n                if (count <= 12) {\r\n                    plus++;\r\n                }\r\n                if (count <= 8) {\r\n                    plus++;\r\n                }\r\n                break;\r\n            case 6:\r\n                if (count > 16) {\r\n                    plus--;\r\n                }\r\n                if (count <= 12) {\r\n                    plus++;\r\n                }\r\n                if (count <= 8) {\r\n                    plus++;\r\n                }\r\n                break;\r\n        }\r\n        hand = Aijs.thinkAI(this.gameState.thisMap, this.gameState.turn_player, level + plus + 1, undefined, undefined, undefined)[0];\r\n        this.gameState.thisHand = hand;\r\n        if (hand) {\r\n            if (this.isGoaled(this.gameState.thisMap, hand[1], this.gameState.turn_player)) {\r\n                this.gameState.goaled = true;\r\n                (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, true);\r\n                setTimeout(() => {\r\n                    var _a;\r\n                    this.gameState.goaled = false;\r\n                    (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n                }, 2000);\r\n            }\r\n            this.gameState.thisMap[hand[1]] = this.gameState.thisMap[hand[0]];\r\n            this.gameState.thisMap[hand[0]] = 0;\r\n            this.logArray2.push([hand[0], hand[1]]);\r\n            // //フォーカス座標を移す。\r\n            // mouse_x = Math.floor(hand[1] / 10)*cellSize+1\r\n            // mouse_y = Math.floor(hand[1] % 10)*cellSize+1\r\n        }\r\n        this.gameState.turn_player = this.gameState.turn_player * -1;\r\n        endTime = new Date();\r\n        this.thinktime = (endTime.getTime() - startTime.getTime()) / 1000;\r\n    }\r\n    /**\r\n     * ゴールしたか\r\n     */\r\n    isGoaled(map, afterHand, turn) {\r\n        if (turn > 0) {\r\n            if (afterHand % 10 === 0) {\r\n                return true;\r\n            }\r\n        }\r\n        else if (turn < 0) {\r\n            if (afterHand % 10 === 5) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * 盤面をシャッフル。\r\n     */\r\n    shuffleBoard() {\r\n        // クリア\r\n        for (let num in this.gameState.thisMap) {\r\n            this.gameState.thisMap[num] = 0;\r\n        }\r\n        let arr = [1, 2, 3, 4, 5, 6, 7, 8];\r\n        let red_num = [0, 10, 20, 30, 40, 50, 11, 41];\r\n        let blue_num = [55, 45, 35, 25, 15, 5, 44, 14];\r\n        for (let i = arr.length - 1; i >= 0; i--) {\r\n            let r = Math.floor(Math.random() * (i + 1));\r\n            let tmp = arr[i];\r\n            arr[i] = arr[r];\r\n            arr[r] = tmp;\r\n        }\r\n        for (let num in blue_num) {\r\n            this.gameState.thisMap[blue_num[num]] = arr[num];\r\n        }\r\n        for (let num in red_num) {\r\n            this.gameState.thisMap[red_num[num]] = -1 * arr[num];\r\n        }\r\n    }\r\n    /**\r\n     * マウス位置取得\r\n     */\r\n    getMousePosition(e) {\r\n        var _a;\r\n        if (e == null) {\r\n            return;\r\n        }\r\n        if (!e.clientX) { // SmartPhone\r\n            if (e.touches) {\r\n                e = e.touches[0];\r\n            }\r\n            else if (e.touches) {\r\n                e = e.touches[0];\r\n            }\r\n            else {\r\n                e = (_a = event) === null || _a === void 0 ? void 0 : _a.touches[0];\r\n            }\r\n        }\r\n        let rect = e.target.getBoundingClientRect();\r\n        this.gameState.mouse_x = e.clientX - rect.left;\r\n        this.gameState.mouse_y = e.clientY - rect.top;\r\n        this.gameState.mouse_x = this.gameState.mouse_x * this.view.Ratio;\r\n        this.gameState.mouse_y = this.gameState.mouse_y * this.view.Ratio;\r\n    }\r\n    /**\r\n     * メッセージを更新\r\n     */\r\n    updateMessage() {\r\n        this.calcScore();\r\n        let Block = '';\r\n        document.querySelector('#blue').innerHTML = 'Blue: ' + this.gameState.blueScore + '/8';\r\n        document.querySelector('#red').innerHTML = ' Red: ' + this.gameState.redScore + '/8';\r\n        document.querySelector('#time').innerHTML = '(' + (this.thinktime.toFixed(3)) + 'sec)';\r\n        if (this.logArray.length === 0) {\r\n            if (this.gameState.winner == 1) {\r\n                this.gameState.message = 'You win!';\r\n                this.storage.setItem('level_' + document.querySelector('#level').value, parseInt(this.storage.getItem('level_' + document.querySelector('#level').value)) + 1);\r\n                this.endgame();\r\n            }\r\n            else if (this.gameState.winner == -1) {\r\n                this.gameState.message = 'You lose...';\r\n                this.storage.setItem('level_' + document.querySelector('#level').value, 0);\r\n                this.endgame();\r\n            }\r\n            else if (this.gameState.winner === 0) {\r\n                if (this.map_list[JSON.stringify(this.gameState.thisMap)] >= this.LIMIT_1000DAY) {\r\n                    this.gameState.message = '3fold repetition';\r\n                }\r\n                else {\r\n                    this.gameState.message = '-- Draw --';\r\n                }\r\n                this.endgame();\r\n            }\r\n        }\r\n        if (this.storage.getItem('level_' + document.querySelector('#level').value) > 0) {\r\n            document.querySelector('#wins').innerHTML = this.storage.getItem('level_' + document.querySelector('#level').value) + ' win!';\r\n        }\r\n        else {\r\n            document.querySelector('#wins').innerHTML = '';\r\n        }\r\n    }\r\n    /**\r\n     * ゲーム終了\r\n     */\r\n    endgame() {\r\n        if (this.logArray.length === 0) {\r\n            document.querySelector('#span_replay').classList.remove(\"hide\");\r\n            document.querySelector('#span_tweetlog').classList.remove(\"hide\");\r\n        }\r\n    }\r\n    /**\r\n     * 得点計算。\r\n     */\r\n    calcScore() {\r\n        let sum1 = 0;\r\n        let sum2 = 0;\r\n        let GoalTop = [0, 10, 20, 30, 40, 50];\r\n        let GoalBottom = [5, 15, 25, 35, 45, 55];\r\n        // 点数勝利        \r\n        for (let i in GoalTop) {\r\n            if (this.gameState.thisMap[GoalTop[i]] * 1 > 0) {\r\n                sum1 += this.gameState.thisMap[GoalTop[i]];\r\n            }\r\n        }\r\n        for (let i in GoalBottom) {\r\n            if (this.gameState.thisMap[GoalBottom[i]] * -1 > 0) {\r\n                sum2 += this.gameState.thisMap[GoalBottom[i]];\r\n            }\r\n        }\r\n        if (sum1 >= 8) {\r\n            this.gameState.winner = 1;\r\n        }\r\n        else if (sum2 <= -8) {\r\n            this.gameState.winner = -1;\r\n        }\r\n        // 手詰まりは判定\r\n        if (this.isNoneNode(this.gameState.thisMap)) {\r\n            if (Math.abs(sum1) > Math.abs(sum2)) {\r\n                this.gameState.winner = 1;\r\n            }\r\n            else if (Math.abs(sum1) < Math.abs(sum2)) { // 引き分けは後攻勝利\r\n                this.gameState.winner = -1;\r\n            }\r\n            else if (Math.abs(sum1) == Math.abs(sum2)) {\r\n                this.gameState.winner = 0;\r\n            }\r\n        }\r\n        else {\r\n            if (this.is1000day(this.gameState.thisMap) === true) {\r\n                this.gameState.winner = 0;\r\n            }\r\n        }\r\n        this.gameState.blueScore = Math.abs(sum1);\r\n        this.gameState.redScore = Math.abs(sum2);\r\n    }\r\n    /**\r\n     * 手詰まり判定。\r\n     */\r\n    isNoneNode(wkMap) {\r\n        let flag1 = false;\r\n        let flag2 = false;\r\n        for (let panel_num in wkMap) {\r\n            if (wkMap[panel_num] === 0) {\r\n                continue;\r\n            }\r\n            let canMove = Aijs.getCanMovePanelX(parseInt(panel_num), wkMap);\r\n            if (canMove.length !== 0) {\r\n                if (wkMap[panel_num] > 0) {\r\n                    flag1 = true;\r\n                }\r\n                else if (wkMap[panel_num] < 0) {\r\n                    flag2 = true;\r\n                }\r\n            }\r\n            if (flag1 && flag2) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    /**\r\n     * 千日手\r\n     */\r\n    is1000day(wkMap) {\r\n        let map_json = JSON.stringify(wkMap);\r\n        if (this.map_list[map_json] === undefined) {\r\n            this.map_list[map_json] = 1;\r\n            return false;\r\n        }\r\n        else {\r\n            this.map_list[map_json] += 1;\r\n        }\r\n        if (this.map_list[map_json] >= this.LIMIT_1000DAY) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * 手の数を取得\r\n     */\r\n    getNodeCount(wkMap) {\r\n        let count = 0;\r\n        for (let panel_num in wkMap) {\r\n            if (wkMap[panel_num] === 0) {\r\n                continue;\r\n            }\r\n            let canMove = Aijs.getCanMovePanelX(parseInt(panel_num), wkMap);\r\n            count += canMove.length;\r\n        }\r\n        return count;\r\n    }\r\n    /**\r\n     * パラメータ取得\r\n     */\r\n    getParam() {\r\n        let obj = {};\r\n        if (1 < document.location.search.length) {\r\n            let paramstr = document.location.search.substring(1).split('&');\r\n            for (let i = 0; i < paramstr.length; i++) {\r\n                let entry = paramstr[i].split('=');\r\n                let key = decodeURIComponent(entry[0]);\r\n                let value = decodeURIComponent(entry[1]);\r\n                obj[key] = decodeURIComponent(value);\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n    /**\r\n     * パタメータから初期配置を取得\r\n     */\r\n    getMapByParam(initString) {\r\n        let wkMap;\r\n        if (initString) {\r\n            wkMap = Aijs.copyMap(this.gameState.thisMap);\r\n            // クリア\r\n            for (let num in wkMap) {\r\n                wkMap[num] = 0;\r\n            }\r\n            let arr = initString.split(',');\r\n            if (arr.length < 8) {\r\n                arr = [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\"];\r\n            }\r\n            let red_num = [0, 10, 20, 30, 40, 50, 11, 41];\r\n            let blue_num = [55, 45, 35, 25, 15, 5, 44, 14];\r\n            for (let num in blue_num) {\r\n                wkMap[blue_num[num]] = parseInt(arr[num]);\r\n            }\r\n            for (let num in red_num) {\r\n                wkMap[red_num[num]] = -1 * parseInt(arr[num]);\r\n            }\r\n        }\r\n        return wkMap;\r\n    }\r\n    /**\r\n     * ログをデコード。\r\n     */\r\n    decodeLog(logstr, wkInitMap) {\r\n        let wklogArray = [];\r\n        let wkMap = Aijs.copyMap(wkInitMap);\r\n        let arrow = {\r\n            'q': 0, 'w': 1, 'e': 2,\r\n            'a': 3, 's': 4, 'd': 5,\r\n            'z': 6, 'x': 7, 'c': 8\r\n        };\r\n        logstr = logstr.replace(/q/g, 'q,').replace(/w/g, 'w,').replace(/e/g, 'e,');\r\n        logstr = logstr.replace(/a/g, 'a,').replace(/s/g, 's,').replace(/d/g, 'd,');\r\n        logstr = logstr.replace(/z/g, 'z,').replace(/x/g, 'x,').replace(/c/g, 'c,');\r\n        let logArr = logstr.split(',');\r\n        wklogArray.push(wkMap);\r\n        for (let i = 0; i < logArr.length; i++) {\r\n            if (logArr[i] === '') {\r\n                continue;\r\n            }\r\n            let arw = arrow[logArr[i].match(/[qweasdzxc]/)[0]];\r\n            let from = parseInt(logArr[i].match(/\\d*/)[0]);\r\n            let to = (Math.floor(from / 10) + Math.floor(arw % 3) - 1) * 10 +\r\n                (Math.floor(from % 10) + Math.floor(arw / 3) - 1);\r\n            wkMap = Aijs.copyMap(wkMap);\r\n            wkMap[to] = wkMap[from];\r\n            wkMap[from] = 0;\r\n            wklogArray.push(wkMap);\r\n        }\r\n        return wklogArray;\r\n    }\r\n    /**\r\n     * ログをエンコード\r\n     */\r\n    encodeLog(wklogArray) {\r\n        let logstr = '';\r\n        let arrow = ['q', 'w', 'e',\r\n            'a', 's', 'd',\r\n            'z', 'x', 'c'];\r\n        for (let i in wklogArray) {\r\n            let from = wklogArray[i][0];\r\n            let to = wklogArray[i][1];\r\n            let x_vec = ((Math.floor(to / 10)) - Math.floor(from / 10));\r\n            let y_vec = ((Math.floor(to % 10)) - Math.floor(from % 10));\r\n            let arw = '';\r\n            if (x_vec === -1 && y_vec === -1) {\r\n                arw = 'q';\r\n            }\r\n            if (x_vec === 0 && y_vec === -1) {\r\n                arw = 'w';\r\n            }\r\n            if (x_vec === 1 && y_vec === -1) {\r\n                arw = 'e';\r\n            }\r\n            if (x_vec === -1 && y_vec === 0) {\r\n                arw = 'a';\r\n            }\r\n            if (x_vec === 0 && y_vec === 0) {\r\n                arw = 's';\r\n            }\r\n            if (x_vec === 1 && y_vec === 0) {\r\n                arw = 'd';\r\n            }\r\n            if (x_vec === -1 && y_vec === 1) {\r\n                arw = 'z';\r\n            }\r\n            if (x_vec === 0 && y_vec === 1) {\r\n                arw = 'x';\r\n            }\r\n            if (x_vec === 1 && y_vec === 1) {\r\n                arw = 'c';\r\n            }\r\n            logstr += from + arw;\r\n        }\r\n        return logstr;\r\n    }\r\n    /**\r\n     * ログを全部巻き戻す\r\n     */\r\n    move_start() {\r\n        var _a;\r\n        this.logPointer = 0;\r\n        this.gameState.autoLog = false;\r\n        this.gameState.thisMap = Aijs.copyMap(this.logArray[this.logPointer]);\r\n        this.gameState.winner = null;\r\n        this.gameState.goaled = false;\r\n        this.updateMessage();\r\n        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n    }\r\n    /**\r\n     * ログを戻す\r\n     */\r\n    move_prev() {\r\n        var _a;\r\n        if (this.logPointer <= 0) {\r\n            return;\r\n        }\r\n        this.gameState.autoLog = false;\r\n        this.logPointer -= 1;\r\n        this.gameState.thisMap = Aijs.copyMap(this.logArray[this.logPointer]);\r\n        this.gameState.winner = null;\r\n        this.gameState.goaled = false;\r\n        this.updateMessage();\r\n        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n    }\r\n    /**\r\n     * ログを進める\r\n     */\r\n    move_next() {\r\n        var _a;\r\n        if (this.logPointer + 1 > this.logArray.length - 1) {\r\n            return;\r\n        }\r\n        this.logPointer += 1;\r\n        this.gameState.thisMap = Aijs.copyMap(this.logArray[this.logPointer]);\r\n        this.updateMessage();\r\n        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n    }\r\n    /**\r\n     * ログを最後まで進める。\r\n     */\r\n    move_end() {\r\n        var _a;\r\n        this.logPointer = this.logArray.length - 1;\r\n        this.gameState.autoLog = false;\r\n        this.gameState.thisMap = Aijs.copyMap(this.logArray[this.logPointer]);\r\n        this.updateMessage();\r\n        (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n    }\r\n    /**\r\n     * リセット\r\n     */\r\n    reloadnew() {\r\n        var _a;\r\n        let url = document.location.href.split('?')[0];\r\n        //demo中ならdemoを終了\r\n        if (this.gameState.demo === true) {\r\n            this.ev_mouseClick(null);\r\n            return;\r\n        }\r\n        // パラメータを取得\r\n        let paramObj = this.getParam();\r\n        if (paramObj.lang) {\r\n            url += '?lang=' + paramObj.lang;\r\n        }\r\n        if (navigator.onLine) {\r\n            location.href = url;\r\n        }\r\n        else {\r\n            this.gameState.thisMap = Aijs.copyMap(this.startMap);\r\n            this.shuffleBoard();\r\n            this.logArray2 = [];\r\n            this.gameState.message = '';\r\n            this.gameState.winner = null;\r\n            this.gameState.turn_player = 1;\r\n            (_a = this.view) === null || _a === void 0 ? void 0 : _a.flush(this.gameState, false, false);\r\n        }\r\n    }\r\n    /**\r\n     * 検討画面に飛ぶ\r\n     */\r\n    jumpkento() {\r\n        let url = document.location.href.split('?')[0];\r\n        let init = '?init=' + this.startMap[55] + ',' +\r\n            this.startMap[45] + ',' +\r\n            this.startMap[35] + ',' +\r\n            this.startMap[25] + ',' +\r\n            this.startMap[15] + ',' +\r\n            this.startMap[5] + ',' +\r\n            this.startMap[44] + ',' +\r\n            this.startMap[14];\r\n        let log = '&log=' + this.encodeLog(this.logArray2);\r\n        log += '&lv=' + document.querySelector('#level').value;\r\n        location.href = url + init + log;\r\n    }\r\n    /**\r\n     * ログをツイートする。\r\n     */\r\n    tweetlog() {\r\n        let url = document.location.href.split('?')[0];\r\n        let init = '?init=' + this.startMap[55] + ',' +\r\n            this.startMap[45] + ',' +\r\n            this.startMap[35] + ',' +\r\n            this.startMap[25] + ',' +\r\n            this.startMap[15] + ',' +\r\n            this.startMap[5] + ',' +\r\n            this.startMap[44] + ',' +\r\n            this.startMap[14];\r\n        let log = '%26log=' + this.encodeLog(this.logArray2);\r\n        log += '%26lv=' + document.querySelector('#level').value;\r\n        window.open('https://twitter.com/intent/tweet?text=' + url + init + log + '%20%23colamone');\r\n    }\r\n    /**\r\n     * ツイートボタンを読み込む。\r\n     */\r\n    setTweet() {\r\n        /*jshint -W030 */\r\n        (function f(d, s, id) {\r\n            let js, fjs = d.getElementsByTagName(s)[0];\r\n            if (!d.getElementById(id)) {\r\n                js = d.createElement(s);\r\n                js.id = id;\r\n                js.async = true;\r\n                js.src = 'https://platform.twitter.com/widgets.js';\r\n                fjs.parentNode.insertBefore(js, fjs);\r\n            }\r\n        })(document, 'script', 'twitter-wjs');\r\n    }\r\n    /**\r\n     * botかどうか判定\r\n     */\r\n    isBot() {\r\n        let ua = window.navigator.userAgent.toLowerCase();\r\n        if (ua.indexOf('bot') != -1 ||\r\n            ua.indexOf('lighthouse') != -1 ||\r\n            ua.indexOf('headless') != -1) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\nconst bg = new BoardGamejs();\r\n/**\r\n * init\r\n */\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    bg.Run();\r\n});\r\n"],"sourceRoot":""}