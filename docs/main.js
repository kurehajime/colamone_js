/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";class e{static copyMap(e){return new Int8Array(e)}static isEndX(t,i){let s=0,a=0;if(t[0]>0&&(s+=t[0]),t[10]>0&&(s+=t[10]),t[20]>0&&(s+=t[20]),t[30]>0&&(s+=t[30]),t[40]>0&&(s+=t[40]),t[50]>0&&(s+=t[50]),-1*t[5]>0&&(a+=t[5]),-1*t[15]>0&&(a+=t[15]),-1*t[25]>0&&(a+=t[25]),-1*t[35]>0&&(a+=t[35]),-1*t[45]>0&&(a+=t[45]),-1*t[55]>0&&(a+=t[55]),s>=8)return 1;if(a<=-8)return-1;if(e.isNoneNode(t))return s>-1*a?1:s<-1*a?-1:0;if(!1===i&&(0!==s||0!==a)){let i=0,l=0;for(let s=0;s<=35;s++){let a=0|e.NUMBERS[s];t[a]>0?i+=t[a]:t[a]<0&&(l+=t[a])}if(s>-1*(l+a))return 1;if(-1*a>i+s)return-1}return 0}static isDraw(t){let i=0,s=0;return t[0]>0&&(i+=t[0]),t[10]>0&&(i+=t[10]),t[20]>0&&(i+=t[20]),t[30]>0&&(i+=t[30]),t[40]>0&&(i+=t[40]),t[50]>0&&(i+=t[50]),-1*t[5]>0&&(s-=t[5]),-1*t[15]>0&&(s-=t[15]),-1*t[25]>0&&(s-=t[25]),-1*t[35]>0&&(s-=t[35]),-1*t[45]>0&&(s-=t[45]),-1*t[55]>0&&(s-=t[55]),i===s&&!!e.isNoneNode(t)}static isNoneNode(t){let i=!1,s=!1;for(let a=0;a<=35;a++){let l=0|e.NUMBERS[a];if(0!==t[l]&&(!0===e.hasCanMovePanelX(l,t)&&(t[l]>0?i=!0:t[l]<0&&(s=!0)),i&&s))return!1}return!0}static hasCanMovePanelX(t,i){let s=0|i[t],a=~~(t/10),l=~~(t%10);if(s>0&&0===l||s<0&&5===l||0===s)return!1;for(let t=0;t<9;t++){if(0===e.PIECES[s+8][t])continue;let h=a+~~(t%3)-1,o=l+~~(t/3)-1;if(o<0||o>5||h>5||h<0)continue;let r=i[10*h+o];if(!(r*s>0||r>0&&0===o||r<0&&5===o))return!0}return!1}static getCanMovePanelX(t,i){let s=0|i[t],a=~~(t/10),l=~~(t%10),h=[];if(s>0&&0===l||s<0&&5===l||0===s)return h;for(let t=0;t<9;t++){if(0===e.PIECES[s+8][t])continue;let o=a+~~(t%3)-1,r=l+~~(t/3)-1;if(r<0||r>5||o>5||o<0)continue;let n=10*o+r,c=0|i[n];c*s>0||c>0&&0===r||c<0&&5===r||h.push(n)}return h}static getNodeMap(t,i){let s=[];for(let a=0;a<=35;a++){let l=0|e.NUMBERS[a];if(t[l]*i<=0||0===t[l])continue;let h=e.getCanMovePanelX(l,t);for(let e=0;e<h.length;e++){let i=new Int8Array(t);i[h[e]]=i[l],i[l]=0,s.push([[l,h[e]],i])}}return s}static evalMap(t,i,s){let a=0;if(e.isDraw(t))return 0;let l=e.isEndX(t,i);if(1===l)return 9999999;if(-1===l)return-9999999;for(let i=0;i<=35;i++){let l,h=0|e.NUMBERS[i],o=0,r=t[h];r>0?(l=5-h%10,o+=s[r][l]):r<0&&(l=h%10,o+=-1*s[-1*r][l]),a+=o}return 0|a}static deepThinkAllAB(t,i,s,a,l,h,o){let r,n=9999999*i*-1;if(0===s)return n=e.evalMap(t,h,o),[r,n];void 0!==a&&void 0!==l||(a=9999999*i*-1,l=9999999*i);let c=e.getNodeMap(t,i);for(let t=0;t<c.length;t++){let d=c[t][0],g=c[t][1],S=0,u=e.isEndX(g,h);if(u===i)return[d,999999*i];if(u!==-1*i){if(S=e.isNoneNode(g)?0:e.deepThinkAllAB(g,-1*i,s-1,l,a,h,o)[1],void 0===r&&(n=S,r=d),(1===i&&S>n||-1===i&&S<n)&&(n=S,r=d),(1===i&&a<n||-1===i&&a>n)&&(a=n),1===i&&l<=n||-1===i&&l>=n)break}else void 0===r&&(n=999999*i*-1,r=d)}return[r,n]}static thinkAI(t,i,s,a,l,h){let o=!1,r=[void 0,0],n=new Int8Array(t);return h||(h=e.DEFAULT_EVALPARAM),0!==e.isEndX(n,!1)&&(o=!0),r=e.deepThinkAllAB(n,i,s,a,l,o,h),r[1]*i==-999999&&(r=e.deepThinkAllAB(n,i,1,a,l,o,h)),r}}e.PIECES=[[0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,1,1,1],[1,1,1,0,0,0,1,1,1],[1,0,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,1,1],[0,0,0,0,0,0,0,0,0],[1,1,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,0,1],[1,1,1,0,0,0,1,1,1],[1,1,1,0,0,0,1,0,1],[1,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0]],e.NUMBERS=[0,1,2,3,4,5,10,11,12,13,14,15,20,21,22,23,24,25,30,31,32,33,34,35,40,41,42,43,44,45,50,51,52,53,54,55],e.DEFAULT_EVALPARAM=[[],[1800,1850,1900,1950,2100,2800],[1800,1860,1920,2100,2400,3800],[1450,1520,1590,1900,2350,4450],[1450,1530,1610,2050,2650,5450],[1350,1440,1530,2100,2850,6350],[1350,1450,1550,2250,3150,7350],[1250,1360,1470,2300,3350,8250],[1250,1370,1490,2450,4350,11250]];class t{constructor(){this.goaled=!1,this.turn_player=0,this.blueScore=0,this.redScore=0,this.winner=null,this.message="",this.demo=!0,this.thisHand=void 0,this.thisMap=new Int8Array([-1,0,0,0,0,6,0,0,0,0,-2,-8,0,0,7,5,0,0,0,0,-3,0,0,0,0,4,0,0,0,0,-4,0,0,0,0,3,0,0,0,0,-5,-7,0,0,8,2,0,0,0,0,-6,0,0,0,0,1]),this.mouse_x=0,this.mouse_y=0,this.hover_piece=null,this.demo_inc=0,this.autoLog=!1,this.isTouch=!0}}class i{constructor(){this.CellSize=0,this.Ratio=1,this.Img_bk_loaded=!1,this.ctx=null,this.cache_on=!1,this.COLOR_LINE="#333333",this.COLOR_PANEL_1="#660033",this.COLOR_PANEL_2="#004466",this.COLOR_PANEL_3="#FFFFFF",this.COLOR_PANEL_4="#111111",this.COLOR_PANEL_5="#444444",this.COLOR_PANEL_6="#888888",this.COLOR_SELECT="#7fed7f",this.COLOR_SELECT2="#148d14",this.COLOR_RED="#E60073",this.COLOR_BLUE="#0099E6",this.COLOR_RED2="#E60073",this.COLOR_BLUE2="#0099E6",this.COLOR_WHITE="#FFFFFF",this.CANV_SIZE=0,this.PIECES={1:[1,1,1,1,0,1,1,1,1],2:[1,1,1,1,0,1,1,0,1],3:[1,1,1,0,0,0,1,1,1],4:[1,1,1,0,0,0,1,0,1],5:[1,0,1,0,0,0,1,0,1],6:[1,0,1,0,0,0,0,1,0],7:[0,1,0,0,0,0,0,1,0],8:[0,1,0,0,0,0,0,0,0],"-1":[1,1,1,1,0,1,1,1,1],"-2":[1,0,1,1,0,1,1,1,1],"-3":[1,1,1,0,0,0,1,1,1],"-4":[1,0,1,0,0,0,1,1,1],"-5":[1,0,1,0,0,0,1,0,1],"-6":[0,1,0,0,0,0,1,0,1],"-7":[0,1,0,0,0,0,0,1,0],"-8":[0,0,0,0,0,0,0,1,0]},void 0!==window.devicePixelRatio&&1!=window.devicePixelRatio&&(this.Ratio=window.devicePixelRatio),this.CANV_SIZE=500*this.Ratio,this.Img_bk=new Image,this.Img_bk.src="bk.gif",this.canv_board=document.createElement("canvas"),this.canv_board2=document.createElement("canvas"),this.canv_focus=document.createElement("canvas"),this.canv_pieces=document.createElement("canvas"),this.canv_shadow=document.createElement("canvas"),this.canv_hover_piece=document.createElement("canvas"),this.canv_overlay=document.createElement("canvas"),this.canv_bk=document.createElement("canvas"),this.canv_cover=document.createElement("canvas"),this.canv_score=document.createElement("canvas"),this.canv_cache=document.createElement("canvas")}init(){this.ctx=document.querySelector("#canv").getContext("2d"),this.canv_board.width=this.CANV_SIZE,this.canv_board.height=this.CANV_SIZE,this.canv_board2.width=this.CANV_SIZE,this.canv_board2.height=this.CANV_SIZE,this.canv_focus.width=this.CANV_SIZE,this.canv_focus.height=this.CANV_SIZE,this.canv_pieces.width=this.CANV_SIZE,this.canv_pieces.height=this.CANV_SIZE,this.canv_shadow.width=this.CANV_SIZE,this.canv_shadow.height=this.CANV_SIZE,this.canv_hover_piece.width=this.CANV_SIZE,this.canv_hover_piece.height=this.CANV_SIZE,this.canv_overlay.width=this.CANV_SIZE,this.canv_overlay.height=this.CANV_SIZE,this.canv_bk.width=this.CANV_SIZE,this.canv_bk.height=this.CANV_SIZE,this.canv_cover.width=this.CANV_SIZE,this.canv_cover.height=this.CANV_SIZE,this.canv_score.width=this.CANV_SIZE,this.canv_score.height=this.CANV_SIZE,this.canv_cache.width=this.CANV_SIZE,this.canv_cache.height=this.CANV_SIZE,this.CellSize=this.CANV_SIZE/6,this.ctx.canvas.style.width=this.CANV_SIZE/this.Ratio+"px",this.ctx.canvas.style.height=this.CANV_SIZE/this.Ratio+"px",this.ctx.canvas.width=this.CANV_SIZE,this.ctx.canvas.height=this.CANV_SIZE}flush(e,t,i){let s=new Int8Array(e.thisMap);if(this.ctx.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),!1===i&&(this.cache_on=!1),!1===i||!1===this.cache_on){this.ctx.drawImage(this.drawBoard(t),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawBoard2(t),0,0,this.CANV_SIZE,this.CANV_SIZE),null!==e.hover_piece&&(s[e.hover_piece]=0),this.ctx.drawImage(this.drawShadow(s,e.thisHand),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawPieceAll(s),0,0,this.CANV_SIZE,this.CANV_SIZE);let i=this.canv_cache.getContext("2d");i.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),i.drawImage(this.ctx.canvas,0,0,this.CANV_SIZE,this.CANV_SIZE),this.cache_on=!0}else this.ctx.drawImage(this.canv_cache,0,0,this.CANV_SIZE,this.CANV_SIZE);this.ctx.drawImage(this.drawHoverPiece(e),0,0,this.CANV_SIZE,this.CANV_SIZE),0===e.mouse_x&&0===e.mouse_y||!1!==e.demo||this.ctx.drawImage(this.drawFocus(e),0,0,this.CANV_SIZE,this.CANV_SIZE),(e.goaled||null!==e.winner)&&!1===e.demo&&0==e.autoLog&&this.ctx.drawImage(this.drawScore(e),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawOverlay(e),0,0,this.CANV_SIZE,this.CANV_SIZE),!0===e.demo&&this.ctx.drawImage(this.drawCover(e),0,0,this.CANV_SIZE,this.CANV_SIZE)}drawBk(){let e=this.canv_bk.getContext("2d");return this.Img_bk_loaded&&e.drawImage(this.Img_bk,0,0,this.CANV_SIZE/this.Ratio,this.CANV_SIZE/this.Ratio,0,0,this.CANV_SIZE,this.CANV_SIZE),this.canv_bk}drawCover(e){let t=this.canv_cover.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),t.globalAlpha=.5,t.fillStyle="#000000",t.fillRect(0,0,this.CANV_SIZE,this.CANV_SIZE);let i=2*this.CellSize,s=3.5*this.CellSize;t.shadowBlur=20,t.shadowColor="rgba(0, 0, 0, 0.3)",t.shadowOffsetX=5,t.shadowOffsetY=5,t.globalAlpha=.8,t.fillStyle=this.COLOR_WHITE,t.beginPath(),this.fillRoundRect(t,i,s,2*this.CellSize,1*this.CellSize,this.CellSize/7),t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;let a=Math.round(.5*this.CellSize),l="Play";return l+=e.demo_inc%10==0?" ":"",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor="rgba(0, 0, 0, 0)",t.font="bold "+a+"px Play,sans-serif",t.globalAlpha=1,t.fillStyle=this.COLOR_LINE,t.textBaseline="middle",t.textAlign="center",t.beginPath(),t.fillText(l,3*this.CellSize,4*this.CellSize),l="colamone",a=Math.round(1*this.CellSize),t.font="bold "+a+"px Play,sans-serif",t.fillStyle=this.COLOR_WHITE,t.shadowBlur=0,t.beginPath(),t.fillText(l,3*this.CellSize,2*this.CellSize),this.canv_cover}drawScore(e){let t=this.canv_score.getContext("2d"),i="",s=Math.round(1.5*this.CellSize),a=this.COLOR_BLUE2,l=this.COLOR_RED2;return t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),t.globalAlpha=.4,t.textBaseline="middle",t.textAlign="center",t.shadowBlur=10,t.shadowColor="rgba(0, 0, 0, 0.5)",t.font="bold "+s+"px Play,sans-serif",t.globalAlpha=.3,t.shadowBlur=2,t.shadowColor="rgba(255, 255, 255, 1)",t.fillStyle=l,i=String(e.redScore),t.beginPath(),t.fillText(i,1*this.CellSize,3.8*this.CellSize),i="8",t.beginPath(),t.fillText(i,2*this.CellSize,5.3*this.CellSize),t.lineWidth=.2*this.CellSize,t.strokeStyle=l,t.beginPath(),t.moveTo(.4*this.CellSize,5.55*this.CellSize),t.lineTo(2.6*this.CellSize,3.55*this.CellSize),t.closePath(),t.stroke(),i=String(e.blueScore),t.fillStyle=a,t.beginPath(),t.fillText(i,4*this.CellSize,.7*this.CellSize),i="8",t.beginPath(),t.fillText(i,5*this.CellSize,2.3*this.CellSize),t.lineWidth=.2*this.CellSize,t.strokeStyle=a,t.beginPath(),t.moveTo(3.4*this.CellSize,2.55*this.CellSize),t.lineTo(5.6*this.CellSize,.55*this.CellSize),t.closePath(),t.stroke(),this.canv_score}drawFocus(t){let i=t.mouse_x-t.mouse_x%this.CellSize,s=t.mouse_y-t.mouse_y%this.CellSize,a=this.canv_focus.getContext("2d"),l=a.createRadialGradient(i,s,0,i,s,this.CellSize);if(l.addColorStop(.3,this.COLOR_SELECT),l.addColorStop(1,this.COLOR_SELECT2),a.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),a.globalAlpha=.35,a.fillStyle=l,a.lineWidth=1,a.beginPath(),a.fillRect(i,s,this.CellSize,this.CellSize),!0===t.isTouch&&null===t.hover_piece)return this.canv_focus;let h=i/this.CellSize*10+s/this.CellSize;if(t.thisMap[h]*t.turn_player>0){let l=e.getCanMovePanelX(h,t.thisMap);for(let e=0;e<=l.length-1;e++)i=Math.floor(l[e]/10),s=Math.floor(l[e]%10),a.globalAlpha=.6,a.strokeStyle=this.COLOR_SELECT,a.lineWidth=this.CellSize/20,a.beginPath(),a.arc(i*this.CellSize+this.CellSize/2,s*this.CellSize+this.CellSize/2,this.CellSize/2-this.CellSize/10,0,2*Math.PI,!1),a.stroke()}return this.canv_focus}drawBoard(e){if(!1===e)return this.canv_board;let t=this.canv_board.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);let i=t.createLinearGradient(0,0,this.CANV_SIZE,this.CANV_SIZE);i.addColorStop(0,this.COLOR_PANEL_6),i.addColorStop(.3,this.COLOR_PANEL_5),i.addColorStop(1,this.COLOR_PANEL_4);for(let e=0;e<6;e++)for(let s=0;s<6;s++)t.strokeStyle=this.COLOR_LINE,0===s?t.fillStyle=this.COLOR_PANEL_1:5==s?t.fillStyle=this.COLOR_PANEL_2:(e+s)%2==0?t.fillStyle=this.COLOR_PANEL_3:(t.fillStyle=this.COLOR_PANEL_4,t.fillStyle=i),t.beginPath(),t.fillRect(e*this.CellSize,s*this.CellSize,this.CellSize,this.CellSize),t.strokeRect(e*this.CellSize,s*this.CellSize,this.CellSize,this.CellSize);return this.canv_board}drawBoard2(e){if(!1===e)return this.canv_board2;let t=this.canv_board2.getContext("2d");return t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),t.globalAlpha=.07,t.fillStyle=this.COLOR_WHITE,t.beginPath(),t.arc(1*this.CellSize,-3*this.CellSize,7*this.CellSize,0,2*Math.PI,!1),t.fill(),this.canv_board2}drawHoverPiece(e){let t=this.canv_hover_piece.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);let i=e.mouse_x-this.CellSize/2,s=e.mouse_y-this.CellSize/2;return null!==e.hover_piece&&this.drawPiece(t,i,s,e.thisMap[e.hover_piece],!1),this.canv_hover_piece}drawPiece(e,t,i,s,a){let l;if(0===s)return e;l=s>0?this.COLOR_BLUE:this.COLOR_RED;let h=this.ctx.createLinearGradient(t,i,t+this.CellSize,i+this.CellSize);h.addColorStop(0,"rgb(255, 255, 255)"),h.addColorStop(.4,l),h.addColorStop(1,l),e.shadowBlur=10,e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=2,e.shadowOffsetY=2,e.fillStyle=h,e.beginPath(),this.fillRoundRect(e,t+this.CellSize/10,i+this.CellSize/10,this.CellSize-1*this.CellSize/5,this.CellSize-1*this.CellSize/5,this.CellSize/7),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,this.Img_bk_loaded&&(e.globalAlpha=.35,e.save(),e.clip(),e.drawImage(this.drawBk(),t+this.CellSize/10,i+this.CellSize/10,this.CellSize-1*this.CellSize/5,this.CellSize-1*this.CellSize/5),e.restore(),e.globalAlpha=1),e.fillStyle=this.COLOR_WHITE;let o=Math.round(.18*this.CellSize);e.textBaseline="middle",e.textAlign="center",e.font=o+"pt 'Play',Arial",e.beginPath(),e.fillText(String(Math.abs(s)),t+this.CellSize/2,i+this.CellSize/2);for(let a=0;a<=this.PIECES[s].length-1;a++){if(0===this.PIECES[s][a])continue;let l=t+this.CellSize/4.16+Math.floor(this.CellSize-1*this.CellSize/5)/3*Math.floor(a%3),h=i+this.CellSize/4.16+Math.floor(this.CellSize-1*this.CellSize/5)/3*Math.floor(a/3);e.fillStyle=this.COLOR_WHITE,e.beginPath(),e.arc(l,h,.06*this.CellSize,0,2*Math.PI,!1),e.fill()}return a&&(e.shadowBlur=10,e.shadowColor="rgba(0, 0, 0, 1)",e.globalAlpha=1,e.fillStyle=this.COLOR_WHITE,o=Math.round(.5*this.CellSize),e.textBaseline="middle",e.textAlign="center",e.font="bolder "+o+"pt Play,Arial ",e.beginPath(),e.fillText(String(Math.abs(s)),t+this.CellSize/2,i+this.CellSize/2),e.globalAlpha=1,e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0),e}fillRoundRect(e,t,i,s,a,l){e.beginPath(),e.moveTo(t+l,i),e.lineTo(t+s-l,i),e.bezierCurveTo(t+s,i+0,t+s,i+0,t+s,i+l),e.lineTo(t+s,i+a-l),e.bezierCurveTo(t+s,i+a,t+s,i+a,t+s-l,i+a),e.lineTo(t+l,i+a),e.bezierCurveTo(t+0,i+a,t+0,i+a,t+0,i+a-l),e.lineTo(t,i+l),e.bezierCurveTo(t+0,i+0,t+0,i+0,t+l,i),e.closePath(),e.fill()}drawPieceAll(e){let t=this.canv_pieces.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);for(let i=0;i<6;i++)for(let s=0;s<6;s++)if(0!==e[10*i+s]){let a=!1;(e[10*i+s]>0&&0===s||e[10*i+s]<0&&5==s)&&(a=!0),t=this.drawPiece(t,i*this.CellSize,s*this.CellSize,e[10*i+s],a)}return this.canv_pieces}drawShadow(e,t){let i=this.canv_shadow.getContext("2d");if(i.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),void 0===t)return this.canv_shadow;let s,a=t[0]/10|0,l=t[0]%10,h=t[1]/10|0,o=t[1]%10,r=this.CellSize-1*this.CellSize/5,n=this.CellSize-1*this.CellSize/5,c=h*this.CellSize+this.CellSize/10,d=o*this.CellSize+this.CellSize/10,g=c+n/2,S=d+r/2,u=g,m=S,v=e[t[1]],_="",C=0;if(2!=t.length)return this.canv_shadow;if(_=v>0?this.COLOR_BLUE:this.COLOR_RED,a==h||l==o)C=(a+l)%2==0&&0!==l&&5!=l?.5:.3,a<h&&(c=c-n+10,u-=n),a>h&&(c=c+n-10,u+=n),l<o&&(d=d-r+10,m-=r),l>o&&(d=d+r-10,m+=r),s=i.createLinearGradient(g,S,u,m),s.addColorStop(0,_),s.addColorStop(C,_),s.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=s,i.fillRect(c,d,r,n);else{C=(a+l)%2==0&&0!==l&&5!=l?.3:.5;let[e,t,v,p,w,f,I,E]=[0,0,0,0,0,0,0,0];a<h&&l<o&&(e=c,t=d-r,v=c+n,p=d,w=c,f=d+r,I=c-n,E=d,u-=n,m-=r,g+=2*n,S+=2*r),a>h&&l>o&&(e=c+n,t=d,v=c+n+n,p=d+r,w=c+n,f=d+r+r,I=c,E=d+r,u+=n,m+=r,g-=2*n,S-=2*r),a<h&&l>o&&(e=c,t=d,v=c+n,p=d+r,w=c,f=d+r+r,I=c-n,E=d+r,u-=n,m+=r,g+=2*n,S-=2*r),a>h&&l<o&&(e=c+n,t=d-r,v=c+n+n,p=d,w=c+n,f=d+r,I=c,E=d,u+=n,m-=r,g-=2*n,S+=2*r),i.beginPath(),i.moveTo(e,t),i.lineTo(v,p),i.lineTo(w,f),i.lineTo(I,E),i.lineTo(e,t),i.closePath(),s=i.createLinearGradient(g,S,u,m),s.addColorStop(0,_),s.addColorStop(C,_),s.addColorStop(.97,"rgba(255, 255, 255, 0)"),i.fillStyle=s,i.fill()}return this.canv_shadow}drawOverlay(e){let t=this.canv_overlay.getContext("2d"),i=1.3*this.CellSize,s=2.5*this.CellSize;if(t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),""===e.message)return this.canv_overlay;t.shadowBlur=10,t.shadowColor="rgba(100, 100, 100, 0.5)",t.shadowOffsetX=5,t.shadowOffsetY=5,t.globalAlpha=.9,t.fillStyle=this.COLOR_WHITE,this.fillRoundRect(t,i,s,3.4*this.CellSize,1*this.CellSize,this.CellSize/7);let a=Math.round(.36*this.CellSize);return t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor="rgba(0, 0, 0, 0)",t.font="bold "+a+"px Play,sans-serif",t.globalAlpha=1,t.fillStyle=this.COLOR_LINE,t.textBaseline="middle",t.textAlign="center",t.beginPath(),t.fillText(e.message,3*this.CellSize,3*this.CellSize),this.canv_overlay}}const s=new class{constructor(){this.gameState=new t,this.view=new i,this.thinktime=0,this.intervalID=null,this.intervalID_log=null,this.map_list={},this.LIMIT_1000DAY=3,this.startMap=new Int8Array,this.logPointer=0,this.logArray=[],this.logArray2=[],this.storage=null,this.ev_mouseMove=e=>{this.getMousePosition(e),this.view.flush(this.gameState,!1,!0)},this.ev_touchMove=e=>{e.preventDefault(),e.stopPropagation()},this.ev_mouseClick=t=>{this.getMousePosition(t);let i=10*Math.floor(this.gameState.mouse_x/this.view.CellSize)+Math.floor(this.gameState.mouse_y/this.view.CellSize);if(null!==this.gameState.winner||0!==this.logArray.length)return this.reloadnew(),!0;if(!0===this.gameState.demo)return this.gameState.demo=!1,this.gameState.thisHand=void 0,this.gameState.thisMap=e.copyMap(this.startMap),this.logArray2=[],this.view.flush(this.gameState,!1,!1),this.gameState.winner=null,this.gameState.goaled=!1,this.gameState.turn_player=1,window.clearInterval(this.intervalID),this.view.flush(this.gameState,!1,!1),!0;if(null===this.gameState.hover_piece)this.gameState.thisMap[i]*this.gameState.turn_player>0&&(this.gameState.hover_piece=i);else{if(i==this.gameState.hover_piece)return this.gameState.hover_piece=null,this.view.flush(this.gameState,!1,!1),!0;e.getCanMovePanelX(this.gameState.hover_piece,this.gameState.thisMap).indexOf(i)>=0&&(this.view.flush(this.gameState,!1,!0),this.isGoaled(this.gameState.thisMap,i,this.gameState.turn_player)&&(this.gameState.goaled=!0,this.view.flush(this.gameState,!1,!0),setTimeout((()=>{this.gameState.goaled=!1,this.view.flush(this.gameState,!1,!1)}),2e3)),this.gameState.thisMap[i]=this.gameState.thisMap[this.gameState.hover_piece],this.gameState.thisMap[this.gameState.hover_piece]=0,this.gameState.turn_player=-1*this.gameState.turn_player,this.logArray2.push([this.gameState.hover_piece,i]),this.gameState.thisHand=[this.gameState.hover_piece,i],this.gameState.hover_piece=null,this.gameState.message="thinking...",window.setTimeout((()=>{this.view.flush(this.gameState,!1,!1)}),50),this.updateMessage(),null===this.gameState.winner&&window.setTimeout((()=>{this.ai(parseInt(document.querySelector("#level").value)),this.gameState.message="",this.updateMessage(),this.view.flush(this.gameState,!1,!1)}),250))}return this.view.flush(this.gameState,!1,!1),!0},this.ev_radioChange=()=>{let t=document.querySelector("#level").value;this.storage.setItem("level_save",t),this.storage.getItem("level_"+t)>0?document.querySelector("#wins").innerHTML=this.storage.getItem("level_"+t)+" win!":document.querySelector("#wins").innerHTML="",this.gameState.thisMap=e.copyMap(this.startMap),this.gameState.thisHand=void 0,this.map_list={},this.logArray2=[],this.view.flush(this.gameState,!1,!1)};try{window==parent&&"localStorage"in window&&null!==window.localStorage&&(this.storage=localStorage,this.storage.setItem("test",0))}catch(e){this.storage=null}null===this.storage&&(this.storage={},this.storage.getItem=function(){},this.storage.setItem=function(){},navigator.cookieEnabled&&(this.storage.hasItem=function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},this.storage.getItem=function(e){return e&&new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},this.storage.setItem=function(e,t){e&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(e)&&(document.cookie=escape(e)+"="+escape(t))}))}Run(){var t,i;this.zoom(),window.innerHeight<window.innerWidth?null===(t=document.querySelector(".manual"))||void 0===t||t.classList.remove("hide"):null===(i=document.querySelector(".manual"))||void 0===i||i.classList.add("hide"),this.gameState.turn_player=1,this.gameState.demo=!0,this.view.init(),"ontouchstart"in window?this.gameState.isTouch=!0:this.gameState.isTouch=!1,this.gameState.isTouch?(document.querySelector("#canv").addEventListener("touchstart",this.ev_mouseClick),document.querySelector("#canv").addEventListener("touchmove",this.ev_touchMove,{passive:!1})):(document.querySelector("#canv").addEventListener("mousemove",this.ev_mouseMove),document.querySelector("#canv").addEventListener("mouseup",this.ev_mouseClick)),document.querySelector("#level").addEventListener("change",this.ev_radioChange),document.querySelector("#prevprev").addEventListener("click",(()=>{this.move_start()})),document.querySelector("#prev").addEventListener("click",(()=>{this.move_prev()})),document.querySelector("#next").addEventListener("click",(()=>{this.move_next()})),document.querySelector("#nextnext").addEventListener("click",(()=>{this.move_end()})),document.querySelector("#replay").addEventListener("click",(()=>{this.jumpkento()})),document.querySelector("#tweetlog").addEventListener("click",(()=>{this.tweetlog()})),document.querySelector("#newgame").addEventListener("click",(()=>{this.reloadnew()})),document.querySelector("#collapsible").addEventListener("click",(()=>{if(document.querySelector(".manual").classList.toggle("hide"),window.innerHeight>window.innerWidth){var e=document.documentElement,t=e.scrollHeight-e.clientHeight;window.scroll(0,t)}})),window.addEventListener("orientationchange",this.zoom),this.shuffleBoard(),this.storage.getItem("level_1")||this.storage.setItem("level_1",0),this.storage.getItem("level_2")||this.storage.setItem("level_2",0),this.storage.getItem("level_3")||this.storage.setItem("level_3",0),this.storage.getItem("level_4")||this.storage.setItem("level_4",0),this.storage.getItem("level_5")||this.storage.setItem("level_5",0),void 0!==this.storage.getItem("level_save")&&"undefined"!==this.storage.getItem("level_save")&&null!==this.storage.getItem("level_save")?document.querySelector("#level").value=String(parseInt(this.storage.getItem("level_save"))):(this.storage.setItem("level_save",1),document.querySelector("#level").value=String(1));let s=this.getParam();s.init?(this.startMap=this.getMapByParam(s.init),this.gameState.thisMap=e.copyMap(this.startMap)):this.startMap=e.copyMap(this.gameState.thisMap),s.log&&(this.logArray=this.decodeLog(s.log,this.startMap)),s.lv&&(document.querySelector("#level").value=String(parseInt(s.lv))),0!==this.logArray.length?(document.querySelector("#log").classList.remove("hide"),document.querySelector("#prevprev").classList.remove("hide"),document.querySelector("#prev").classList.remove("hide"),document.querySelector("#next").classList.remove("hide"),document.querySelector("#nextnext").classList.remove("hide"),document.querySelector("#span_replay").classList.add("hide"),document.querySelector("#span_tweetlog").classList.add("hide"),document.querySelector("#next").focus()):(document.querySelector("#log").classList.add("hide"),document.querySelector("#prevprev").classList.add("hide"),document.querySelector("#prev").classList.add("hide"),document.querySelector("#next").classList.add("hide"),document.querySelector("#nextnext").classList.add("hide"),document.querySelector("#span_replay").classList.add("hide"),document.querySelector("#span_tweetlog").classList.add("hide")),this.view.Img_bk.onload=()=>{this.view.Img_bk_loaded=!0,this.view.flush(this.gameState,!0,!1)},this.view.Img_bk.onerror=()=>{this.view.flush(this.gameState,!0,!1)},0!==this.view.Img_bk.width&&(this.view.Img_bk_loaded=!0,this.view.flush(this.gameState,!0,!1)),setTimeout((()=>{0!==this.view.Img_bk.width&&(this.view.Img_bk_loaded=!0),this.view.flush(this.gameState,!0,!1)}),2500),this.updateMessage(),this.setTweet(),0===this.logArray.length?0==this.isBot()&&window.setTimeout((()=>{1==this.gameState.demo&&(this.intervalID=window.setInterval((()=>{this.playDemo()}),400),this.playDemo())}),500):(this.gameState.demo=!1,this.gameState.autoLog=!0,this.intervalID_log=window.setInterval((()=>{this.playLog()}),1e3)),this.gameState.goaled=!1,this.view.flush(this.gameState,!0,!1)}playDemo(){null!==this.intervalID&&(Math.random()>.3?this.ai(2):this.ai(1)),this.gameState.demo_inc++,this.calcScore(),this.view.flush(this.gameState,!1,!1),1!==this.gameState.winner&&-1!==this.gameState.winner&&0!==this.gameState.winner||(this.gameState.goaled=!0,this.gameState.winner=null,this.view.flush(this.gameState,!1,!1),this.shuffleBoard()),this.gameState.demo_inc>42&&window.clearInterval(this.intervalID)}playLog(){null!==this.intervalID_log&&1==this.gameState.autoLog?this.move_next():clearInterval(this.intervalID_log)}zoom(){let e=document.querySelector("meta[name=viewport]");if(screen.width<500&&screen.height<500?screen.width<screen.height?e.setAttribute("content","width=500,user-scalable=no"):e.setAttribute("content","height=500,user-scalable=no"):screen.width<500?e.setAttribute("content","width=500,user-scalable=no"):screen.height<500&&e.setAttribute("content","height=500,user-scalable=no"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){let t=screen.width,i=520;0!==Math.abs(window.orientation)&&(t=screen.height,i=900);let s=Math.round(t/i*1e3)/1e3;s==Math.round(s)&&(s+=1e-4),e.setAttribute("content","initial-scale="+s+", minimum-scale="+s+", maximum-scale="+s+", user-scalable=no")}}ai(t){let i,s,a=new Date,l=this.getNodeCount(this.gameState.thisMap)/2,h=0;switch(t){case 1:l<=7&&h++;break;case 2:l<=8&&h++;break;case 3:l<=10&&h++,l<=6&&h++;break;case 4:l<=11&&h++,l<=7&&h++;break;case 5:case 6:l>16&&h--,l<=12&&h++,l<=8&&h++}i=e.thinkAI(this.gameState.thisMap,this.gameState.turn_player,t+h+1,void 0,void 0,void 0)[0],this.gameState.thisHand=i,i&&(this.isGoaled(this.gameState.thisMap,i[1],this.gameState.turn_player)&&(this.gameState.goaled=!0,this.view.flush(this.gameState,!1,!0),setTimeout((()=>{this.gameState.goaled=!1,this.view.flush(this.gameState,!1,!1)}),2e3)),this.gameState.thisMap[i[1]]=this.gameState.thisMap[i[0]],this.gameState.thisMap[i[0]]=0,this.logArray2.push([i[0],i[1]])),this.gameState.turn_player=-1*this.gameState.turn_player,s=new Date,this.thinktime=(s.getTime()-a.getTime())/1e3}isGoaled(e,t,i){if(i>0){if(t%10==0)return!0}else if(i<0&&t%10==5)return!0;return!1}shuffleBoard(){for(let e in this.gameState.thisMap)this.gameState.thisMap[e]=0;let e=[1,2,3,4,5,6,7,8],t=[0,10,20,30,40,50,11,41],i=[55,45,35,25,15,5,44,14];for(let t=e.length-1;t>=0;t--){let i=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[i],e[i]=s}for(let t in i)this.gameState.thisMap[i[t]]=e[t];for(let i in t)this.gameState.thisMap[t[i]]=-1*e[i]}getMousePosition(e){var t;if(null==e)return;e.clientX||(e=e.touches||e.touches?e.touches[0]:null===(t=event)||void 0===t?void 0:t.touches[0]);let i=e.target.getBoundingClientRect();this.gameState.mouse_x=e.clientX-i.left,this.gameState.mouse_y=e.clientY-i.top,this.gameState.mouse_x=this.gameState.mouse_x*this.view.Ratio,this.gameState.mouse_y=this.gameState.mouse_y*this.view.Ratio}updateMessage(){this.calcScore(),document.querySelector("#blue").innerHTML="Blue: "+this.gameState.blueScore+"/8",document.querySelector("#red").innerHTML=" Red: "+this.gameState.redScore+"/8",document.querySelector("#time").innerHTML="("+this.thinktime.toFixed(3)+"sec)",0===this.logArray.length&&(1==this.gameState.winner?(this.gameState.message="You win!",this.storage.setItem("level_"+document.querySelector("#level").value,parseInt(this.storage.getItem("level_"+document.querySelector("#level").value))+1),this.endgame()):-1==this.gameState.winner?(this.gameState.message="You lose...",this.storage.setItem("level_"+document.querySelector("#level").value,0),this.endgame()):0===this.gameState.winner&&(this.map_list[JSON.stringify(this.gameState.thisMap)]>=this.LIMIT_1000DAY?this.gameState.message="3fold repetition":this.gameState.message="-- Draw --",this.endgame())),this.storage.getItem("level_"+document.querySelector("#level").value)>0?document.querySelector("#wins").innerHTML=this.storage.getItem("level_"+document.querySelector("#level").value)+" win!":document.querySelector("#wins").innerHTML=""}endgame(){0===this.logArray.length&&(document.querySelector("#span_replay").classList.remove("hide"),document.querySelector("#span_tweetlog").classList.remove("hide"))}calcScore(){let e=0,t=0,i=[0,10,20,30,40,50],s=[5,15,25,35,45,55];for(let t in i)1*this.gameState.thisMap[i[t]]>0&&(e+=this.gameState.thisMap[i[t]]);for(let e in s)-1*this.gameState.thisMap[s[e]]>0&&(t+=this.gameState.thisMap[s[e]]);e>=8?this.gameState.winner=1:t<=-8&&(this.gameState.winner=-1),this.isNoneNode(this.gameState.thisMap)?Math.abs(e)>Math.abs(t)?this.gameState.winner=1:Math.abs(e)<Math.abs(t)?this.gameState.winner=-1:Math.abs(e)==Math.abs(t)&&(this.gameState.winner=0):!0===this.is1000day(this.gameState.thisMap)&&(this.gameState.winner=0),this.gameState.blueScore=Math.abs(e),this.gameState.redScore=Math.abs(t)}isNoneNode(t){let i=!1,s=!1;for(let a in t)if(0!==t[a]&&(0!==e.getCanMovePanelX(parseInt(a),t).length&&(t[a]>0?i=!0:t[a]<0&&(s=!0)),i&&s))return!1;return!0}is1000day(e){let t=JSON.stringify(e);return void 0===this.map_list[t]?(this.map_list[t]=1,!1):(this.map_list[t]+=1,this.map_list[t]>=this.LIMIT_1000DAY)}getNodeCount(t){let i=0;for(let s in t)0!==t[s]&&(i+=e.getCanMovePanelX(parseInt(s),t).length);return i}getParam(){let e={};if(1<document.location.search.length){let t=document.location.search.substring(1).split("&");for(let i=0;i<t.length;i++){let s=t[i].split("="),a=decodeURIComponent(s[0]),l=decodeURIComponent(s[1]);e[a]=decodeURIComponent(l)}}return e}getMapByParam(t){let i;if(t){i=e.copyMap(this.gameState.thisMap);for(let e in i)i[e]=0;let s=t.split(",");s.length<8&&(s=["1","2","3","4","5","6","7","8"]);let a=[0,10,20,30,40,50,11,41],l=[55,45,35,25,15,5,44,14];for(let e in l)i[l[e]]=parseInt(s[e]);for(let e in a)i[a[e]]=-1*parseInt(s[e])}return i}decodeLog(t,i){let s=[],a=e.copyMap(i),l={q:0,w:1,e:2,a:3,s:4,d:5,z:6,x:7,c:8},h=(t=(t=(t=t.replace(/q/g,"q,").replace(/w/g,"w,").replace(/e/g,"e,")).replace(/a/g,"a,").replace(/s/g,"s,").replace(/d/g,"d,")).replace(/z/g,"z,").replace(/x/g,"x,").replace(/c/g,"c,")).split(",");s.push(a);for(let t=0;t<h.length;t++){if(""===h[t])continue;let i=l[h[t].match(/[qweasdzxc]/)[0]],o=parseInt(h[t].match(/\d*/)[0]),r=10*(Math.floor(o/10)+Math.floor(i%3)-1)+(Math.floor(o%10)+Math.floor(i/3)-1);a=e.copyMap(a),a[r]=a[o],a[o]=0,s.push(a)}return s}encodeLog(e){let t="";for(let i in e){let s=e[i][0],a=e[i][1],l=Math.floor(a/10)-Math.floor(s/10),h=Math.floor(a%10)-Math.floor(s%10),o="";-1===l&&-1===h&&(o="q"),0===l&&-1===h&&(o="w"),1===l&&-1===h&&(o="e"),-1===l&&0===h&&(o="a"),0===l&&0===h&&(o="s"),1===l&&0===h&&(o="d"),-1===l&&1===h&&(o="z"),0===l&&1===h&&(o="x"),1===l&&1===h&&(o="c"),t+=s+o}return t}move_start(){this.logPointer=0,this.gameState.autoLog=!1,this.gameState.thisMap=e.copyMap(this.logArray[this.logPointer]),this.gameState.winner=null,this.gameState.goaled=!1,this.updateMessage(),this.view.flush(this.gameState,!1,!1)}move_prev(){this.logPointer<=0||(this.gameState.autoLog=!1,this.logPointer-=1,this.gameState.thisMap=e.copyMap(this.logArray[this.logPointer]),this.gameState.winner=null,this.gameState.goaled=!1,this.updateMessage(),this.view.flush(this.gameState,!1,!1))}move_next(){this.logPointer+1>this.logArray.length-1||(this.logPointer+=1,this.gameState.thisMap=e.copyMap(this.logArray[this.logPointer]),this.updateMessage(),this.view.flush(this.gameState,!1,!1))}move_end(){this.logPointer=this.logArray.length-1,this.gameState.autoLog=!1,this.gameState.thisMap=e.copyMap(this.logArray[this.logPointer]),this.updateMessage(),this.view.flush(this.gameState,!1,!1)}reloadnew(){let t=document.location.href.split("?")[0];if(!0===this.gameState.demo)return void this.ev_mouseClick(null);let i=this.getParam();i.lang&&(t+="?lang="+i.lang),navigator.onLine?location.href=t:(this.gameState.thisMap=e.copyMap(this.startMap),this.shuffleBoard(),this.logArray2=[],this.gameState.message="",this.gameState.winner=null,this.gameState.turn_player=1,this.view.flush(this.gameState,!1,!1))}jumpkento(){let e=document.location.href.split("?")[0],t="?init="+this.startMap[55]+","+this.startMap[45]+","+this.startMap[35]+","+this.startMap[25]+","+this.startMap[15]+","+this.startMap[5]+","+this.startMap[44]+","+this.startMap[14],i="&log="+this.encodeLog(this.logArray2);i+="&lv="+document.querySelector("#level").value,location.href=e+t+i}tweetlog(){let e=document.location.href.split("?")[0],t="?init="+this.startMap[55]+","+this.startMap[45]+","+this.startMap[35]+","+this.startMap[25]+","+this.startMap[15]+","+this.startMap[5]+","+this.startMap[44]+","+this.startMap[14],i="%26log="+this.encodeLog(this.logArray2);i+="%26lv="+document.querySelector("#level").value,window.open("https://twitter.com/intent/tweet?text="+e+t+i+"%20%23colamone")}setTweet(){!function(e,t,i){let s,a=e.getElementsByTagName(t)[0];e.getElementById(i)||(s=e.createElement(t),s.id=i,s.async=!0,s.src="https://platform.twitter.com/widgets.js",a.parentNode.insertBefore(s,a))}(document,"script","twitter-wjs")}isBot(){let e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("bot")||-1!=e.indexOf("lighthouse")||-1!=e.indexOf("headless")}};document.addEventListener("DOMContentLoaded",(function(){s.Run()}))})();
//# sourceMappingURL=main.js.map