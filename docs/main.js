/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e=function(){function e(){}return e.copyMap=function(e){return new Int8Array(e)},e.isEndX=function(t,i){var s=0,a=0;if(t[0]>0&&(s+=t[0]),t[10]>0&&(s+=t[10]),t[20]>0&&(s+=t[20]),t[30]>0&&(s+=t[30]),t[40]>0&&(s+=t[40]),t[50]>0&&(s+=t[50]),-1*t[5]>0&&(a+=t[5]),-1*t[15]>0&&(a+=t[15]),-1*t[25]>0&&(a+=t[25]),-1*t[35]>0&&(a+=t[35]),-1*t[45]>0&&(a+=t[45]),-1*t[55]>0&&(a+=t[55]),s>=8)return 1;if(a<=-8)return-1;if(e.isNoneNode(t))return s>-1*a?1:s<-1*a?-1:0;if(!1===i&&(0!==s||0!==a)){for(var o=0,l=0,h=0;h<=35;h++){var r=0|e.NUMBERS[h];t[r]>0?o+=t[r]:t[r]<0&&(l+=t[r])}if(s>-1*(l+a))return 1;if(-1*a>o+s)return-1}return 0},e.isDraw=function(t){var i=0,s=0;return t[0]>0&&(i+=t[0]),t[10]>0&&(i+=t[10]),t[20]>0&&(i+=t[20]),t[30]>0&&(i+=t[30]),t[40]>0&&(i+=t[40]),t[50]>0&&(i+=t[50]),-1*t[5]>0&&(s-=t[5]),-1*t[15]>0&&(s-=t[15]),-1*t[25]>0&&(s-=t[25]),-1*t[35]>0&&(s-=t[35]),-1*t[45]>0&&(s-=t[45]),-1*t[55]>0&&(s-=t[55]),i===s&&!!e.isNoneNode(t)},e.isNoneNode=function(t){for(var i=!1,s=!1,a=0;a<=35;a++){var o=0|e.NUMBERS[a];if(0!==t[o]&&(!0===e.hasCanMovePanelX(o,t)&&(t[o]>0?i=!0:t[o]<0&&(s=!0)),i&&s))return!1}return!0},e.hasCanMovePanelX=function(t,i){var s=0|i[t],a=~~(t/10),o=~~(t%10);if(s>0&&0===o||s<0&&5===o||0===s)return!1;for(var l=0;l<9;l++)if(0!==e.PIECES[s+8][l]){var h=a+~~(l%3)-1,r=o+~~(l/3)-1;if(!(r<0||r>5||h>5||h<0)){var n=i[10*h+r];if(!(n*s>0||n>0&&0===r||n<0&&5===r))return!0}}return!1},e.getCanMovePanelX=function(t,i){var s=0|i[t],a=~~(t/10),o=~~(t%10),l=[];if(s>0&&0===o||s<0&&5===o||0===s)return l;for(var h=0;h<9;h++)if(0!==e.PIECES[s+8][h]){var r=a+~~(h%3)-1,n=o+~~(h/3)-1;if(!(n<0||n>5||r>5||r<0)){var c=10*r+n,d=0|i[c];d*s>0||d>0&&0===n||d<0&&5===n||l.push(c)}}return l},e.getNodeMap=function(t,i){for(var s=[],a=0;a<=35;a++){var o=0|e.NUMBERS[a];if(!(t[o]*i<=0||0===t[o]))for(var l=e.getCanMovePanelX(o,t),h=0;h<l.length;h++){var r=new Int8Array(t);r[l[h]]=r[o],r[o]=0,s.push([[o,l[h]],r])}}return s},e.evalMap=function(t,i,s){var a=0;if(e.isDraw(t))return 0;var o=e.isEndX(t,i);if(1===o)return 9999999;if(-1===o)return-9999999;for(var l=0;l<=35;l++){var h=0|e.NUMBERS[l],r=0,n=t[h],c=void 0;n>0?(c=5-h%10,r+=s[n][c]):n<0&&(c=h%10,r+=-1*s[-1*n][c]),a+=r}return 0|a},e.deepThinkAllAB=function(t,i,s,a,o,l,h){var r,n=9999999*i*-1;if(0===s)return[r,n=e.evalMap(t,l,h)];void 0!==a&&void 0!==o||(a=9999999*i*-1,o=9999999*i);for(var c=e.getNodeMap(t,i),d=0;d<c.length;d++){var u=c[d][0],v=c[d][1],p=0,g=e.isEndX(v,l);if(g===i)return[u,999999*i];if(g!==-1*i){if(p=e.isNoneNode(v)?0:e.deepThinkAllAB(v,-1*i,s-1,o,a,l,h)[1],void 0===r&&(n=p,r=u),(1===i&&p>n||-1===i&&p<n)&&(n=p,r=u),(1===i&&a<n||-1===i&&a>n)&&(a=n),1===i&&o<=n||-1===i&&o>=n)break}else void 0===r&&(n=999999*i*-1,r=u)}return[r,n]},e.thinkAI=function(t,i,s,a,o,l){var h=!1,r=[void 0,0],n=new Int8Array(t);return l||(l=e.DEFAULT_EVALPARAM),0!==e.isEndX(n,!1)&&(h=!0),(r=e.deepThinkAllAB(n,i,s,a,o,h,l))[1]*i==-999999&&(r=e.deepThinkAllAB(n,i,1,a,o,h,l)),r},e.PIECES=[[0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,1,1,1],[1,1,1,0,0,0,1,1,1],[1,0,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,1,1],[0,0,0,0,0,0,0,0,0],[1,1,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,0,1],[1,1,1,0,0,0,1,1,1],[1,1,1,0,0,0,1,0,1],[1,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0]],e.NUMBERS=[0,1,2,3,4,5,10,11,12,13,14,15,20,21,22,23,24,25,30,31,32,33,34,35,40,41,42,43,44,45,50,51,52,53,54,55],e.DEFAULT_EVALPARAM=[[],[1800,1850,1900,1950,2100,2800],[1800,1860,1920,2100,2400,3800],[1450,1520,1590,1900,2350,4450],[1450,1530,1610,2050,2650,5450],[1350,1440,1530,2100,2850,6350],[1350,1450,1550,2250,3150,7350],[1250,1360,1470,2300,3350,8250],[1250,1370,1490,2450,4350,11250]],e}(),t=new(function(){function t(){var t=this;this.ctx=null,this.isTouch=!0,this.goaled=!1,this.canv_board=null,this.canv_board2=null,this.canv_focus=null,this.canv_pieces=null,this.canv_shadow=null,this.canv_hover_piece=null,this.canv_overlay=null,this.canv_bk=null,this.canv_cover=null,this.canv_score=null,this.canv_cache=null,this.cache_on=!1,this.img_bk_loaded=!1,this.hover_piece=null,this.cellSize=0,this.turn_player=0,this.blueScore=0,this.redScore=0,this.winner=null,this.message="",this.thinktime=0,this.demo=!0,this.autoLog=!1,this.intervalID=null,this.intervalID_log=null,this.thisHand=void 0,this.demo_inc=0,this.COLOR_LINE="#333333",this.COLOR_PANEL_1="#660033",this.COLOR_PANEL_2="#004466",this.COLOR_PANEL_3="#FFFFFF",this.COLOR_PANEL_4="#111111",this.COLOR_PANEL_5="#444444",this.COLOR_PANEL_6="#888888",this.COLOR_SELECT="#7fed7f",this.COLOR_SELECT2="#148d14",this.COLOR_RED="#E60073",this.COLOR_BLUE="#0099E6",this.COLOR_RED2="#E60073",this.COLOR_BLUE2="#0099E6",this.COLOR_WHITE="#FFFFFF",this.RATIO=1,this.CANV_SIZE=0,this.PIECES={1:[1,1,1,1,0,1,1,1,1],2:[1,1,1,1,0,1,1,0,1],3:[1,1,1,0,0,0,1,1,1],4:[1,1,1,0,0,0,1,0,1],5:[1,0,1,0,0,0,1,0,1],6:[1,0,1,0,0,0,0,1,0],7:[0,1,0,0,0,0,0,1,0],8:[0,1,0,0,0,0,0,0,0],"-1":[1,1,1,1,0,1,1,1,1],"-2":[1,0,1,1,0,1,1,1,1],"-3":[1,1,1,0,0,0,1,1,1],"-4":[1,0,1,0,0,0,1,1,1],"-5":[1,0,1,0,0,0,1,0,1],"-6":[0,1,0,0,0,0,1,0,1],"-7":[0,1,0,0,0,0,0,1,0],"-8":[0,0,0,0,0,0,0,1,0]},this.thisMap=new Int8Array([-1,0,0,0,0,6,0,0,0,0,-2,-8,0,0,7,5,0,0,0,0,-3,0,0,0,0,4,0,0,0,0,-4,0,0,0,0,3,0,0,0,0,-5,-7,0,0,8,2,0,0,0,0,-6,0,0,0,0,1]),this.map_list={},this.LIMIT_1000DAY=3,this.mouse_x=0,this.mouse_y=0,this.startMap=new Int8Array,this.logPointer=0,this.logArray=[],this.logArray2=[],this.img_bk=null,this.storage=null,this.ev_mouseMove=function(e){t.getMousePosition(e),t.flush(!1,!0)},this.ev_touchMove=function(e){e.preventDefault(),e.stopPropagation()},this.ev_mouseClick=function(i){t.getMousePosition(i);var s=10*Math.floor(t.mouse_x/t.cellSize)+Math.floor(t.mouse_y/t.cellSize);if(null!==t.winner||0!==t.logArray.length)return t.reloadnew(),!0;if(!0===t.demo)return t.demo=!1,t.thisHand=void 0,t.thisMap=e.copyMap(t.startMap),t.logArray2=[],t.flush(!1,!1),t.winner=null,t.goaled=!1,t.turn_player=1,window.clearInterval(t.intervalID),t.flush(!1,!1),!0;if(null===t.hover_piece)t.thisMap[s]*t.turn_player>0&&(t.hover_piece=s);else{if(s==t.hover_piece)return t.hover_piece=null,t.flush(!1,!1),!0;e.getCanMovePanelX(t.hover_piece,t.thisMap).indexOf(s)>=0&&(t.flush(!1,!0),t.isGoaled(t.thisMap,s,t.turn_player)&&(t.goaled=!0,t.flush(!1,!0),setTimeout((function(){t.goaled=!1,t.flush(!1,!1)}),2e3)),t.thisMap[s]=t.thisMap[t.hover_piece],t.thisMap[t.hover_piece]=0,t.turn_player=-1*t.turn_player,t.logArray2.push([t.hover_piece,s]),t.thisHand=[t.hover_piece,s],t.hover_piece=null,t.message="thinking...",window.setTimeout((function(){t.flush(!1,!1)}),50),t.updateMessage(),null===t.winner&&window.setTimeout((function(){t.ai(parseInt(document.querySelector("#level").value)),t.message="",t.updateMessage(),t.flush(!1,!1)}),250))}return t.flush(!1,!1),!0},this.ev_radioChange=function(){var i=document.querySelector("#level").value;t.storage.setItem("level_save",i),t.storage.getItem("level_"+i)>0?document.querySelector("#wins").innerHTML=t.storage.getItem("level_"+i)+" win!":document.querySelector("#wins").innerHTML="",t.thisMap=e.copyMap(t.startMap),t.thisHand=void 0,t.map_list={},t.logArray2=[],t.flush(!1,!1)},void 0!==window.devicePixelRatio&&1!=window.devicePixelRatio&&(this.RATIO=window.devicePixelRatio),this.CANV_SIZE=500*this.RATIO,this.img_bk=new Image,this.img_bk.src="bk.gif";try{window==parent&&"localStorage"in window&&null!==window.localStorage&&(this.storage=localStorage,this.storage.setItem("test",0))}catch(e){this.storage=null}null===this.storage&&(this.storage={},this.storage.getItem=function(){},this.storage.setItem=function(){},navigator.cookieEnabled&&(this.storage.hasItem=function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},this.storage.getItem=function(e){return e&&new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},this.storage.setItem=function(e,t){e&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(e)&&(document.cookie=escape(e)+"="+escape(t))}))}return t.prototype.Run=function(){var t,i,s,a=this;this.zoom(),window.innerHeight<window.innerWidth?null===(t=document.querySelector(".manual"))||void 0===t||t.classList.remove("hide"):null===(i=document.querySelector(".manual"))||void 0===i||i.classList.add("hide"),this.ctx=null===(s=document.querySelector("#canv"))||void 0===s?void 0:s.getContext("2d"),this.canv_board=document.createElement("canvas"),this.canv_board.width=this.CANV_SIZE,this.canv_board.height=this.CANV_SIZE,this.canv_board2=document.createElement("canvas"),this.canv_board2.width=this.CANV_SIZE,this.canv_board2.height=this.CANV_SIZE,this.canv_focus=document.createElement("canvas"),this.canv_focus.width=this.CANV_SIZE,this.canv_focus.height=this.CANV_SIZE,this.canv_pieces=document.createElement("canvas"),this.canv_pieces.width=this.CANV_SIZE,this.canv_pieces.height=this.CANV_SIZE,this.canv_shadow=document.createElement("canvas"),this.canv_shadow.width=this.CANV_SIZE,this.canv_shadow.height=this.CANV_SIZE,this.canv_hover_piece=document.createElement("canvas"),this.canv_hover_piece.width=this.CANV_SIZE,this.canv_hover_piece.height=this.CANV_SIZE,this.canv_overlay=document.createElement("canvas"),this.canv_overlay.width=this.CANV_SIZE,this.canv_overlay.height=this.CANV_SIZE,this.canv_bk=document.createElement("canvas"),this.canv_bk.width=this.CANV_SIZE,this.canv_bk.height=this.CANV_SIZE,this.canv_cover=document.createElement("canvas"),this.canv_cover.width=this.CANV_SIZE,this.canv_cover.height=this.CANV_SIZE,this.canv_score=document.createElement("canvas"),this.canv_score.width=this.CANV_SIZE,this.canv_score.height=this.CANV_SIZE,this.canv_cache=document.createElement("canvas"),this.canv_cache.width=this.CANV_SIZE,this.canv_cache.height=this.CANV_SIZE,this.cellSize=this.CANV_SIZE/6,this.turn_player=1,this.demo=!0,this.ctx.canvas.style.width=this.CANV_SIZE/this.RATIO+"px",this.ctx.canvas.style.height=this.CANV_SIZE/this.RATIO+"px",this.ctx.canvas.width=this.CANV_SIZE,this.ctx.canvas.height=this.CANV_SIZE,"ontouchstart"in window?this.isTouch=!0:this.isTouch=!1,this.isTouch?(document.querySelector("#canv").addEventListener("touchstart",this.ev_mouseClick),document.querySelector("#canv").addEventListener("touchmove",this.ev_touchMove,{passive:!1})):(document.querySelector("#canv").addEventListener("mousemove",this.ev_mouseMove),document.querySelector("#canv").addEventListener("mouseup",this.ev_mouseClick)),document.querySelector("#level").addEventListener("change",this.ev_radioChange),document.querySelector("#prevprev").addEventListener("click",(function(){a.move_start()})),document.querySelector("#prev").addEventListener("click",(function(){a.move_prev()})),document.querySelector("#next").addEventListener("click",(function(){a.move_next()})),document.querySelector("#nextnext").addEventListener("click",(function(){a.move_end()})),document.querySelector("#replay").addEventListener("click",(function(){a.jumpkento()})),document.querySelector("#tweetlog").addEventListener("click",(function(){a.tweetlog()})),document.querySelector("#newgame").addEventListener("click",(function(){a.reloadnew()})),document.querySelector("#collapsible").addEventListener("click",(function(){if(document.querySelector(".manual").classList.toggle("hide"),window.innerHeight>window.innerWidth){var e=document.documentElement,t=e.scrollHeight-e.clientHeight;window.scroll(0,t)}})),window.addEventListener("orientationchange",this.zoom),this.shuffleBoard(),this.storage.getItem("level_1")||this.storage.setItem("level_1",0),this.storage.getItem("level_2")||this.storage.setItem("level_2",0),this.storage.getItem("level_3")||this.storage.setItem("level_3",0),this.storage.getItem("level_4")||this.storage.setItem("level_4",0),this.storage.getItem("level_5")||this.storage.setItem("level_5",0),void 0!==this.storage.getItem("level_save")&&"undefined"!==this.storage.getItem("level_save")&&null!==this.storage.getItem("level_save")?document.querySelector("#level").value=String(parseInt(this.storage.getItem("level_save"))):(this.storage.setItem("level_save",1),document.querySelector("#level").value=String(1));var o=this.getParam();o.init?(this.startMap=this.getMapByParam(o.init),this.thisMap=e.copyMap(this.startMap)):this.startMap=e.copyMap(this.thisMap),o.log&&(this.logArray=this.decodeLog(o.log,this.startMap)),o.lv&&(document.querySelector("#level").value=String(parseInt(o.lv))),0!==this.logArray.length?(document.querySelector("#log").classList.remove("hide"),document.querySelector("#prevprev").classList.remove("hide"),document.querySelector("#prev").classList.remove("hide"),document.querySelector("#next").classList.remove("hide"),document.querySelector("#nextnext").classList.remove("hide"),document.querySelector("#span_replay").classList.add("hide"),document.querySelector("#span_tweetlog").classList.add("hide"),document.querySelector("#next").focus()):(document.querySelector("#log").classList.add("hide"),document.querySelector("#prevprev").classList.add("hide"),document.querySelector("#prev").classList.add("hide"),document.querySelector("#next").classList.add("hide"),document.querySelector("#nextnext").classList.add("hide"),document.querySelector("#span_replay").classList.add("hide"),document.querySelector("#span_tweetlog").classList.add("hide")),this.img_bk.onload=function(){a.img_bk_loaded=!0,a.flush(!0,!1)},this.img_bk.onerror=function(){a.flush(!0,!1)},0!==this.img_bk.width&&(this.img_bk_loaded=!0,this.flush(!0,!1)),setTimeout((function(){0!==a.img_bk.width&&(a.img_bk_loaded=!0),a.flush(!0,!1)}),2500),this.updateMessage(),this.setTweet(),0===this.logArray.length?0==this.isBot()&&window.setTimeout((function(){1==a.demo&&(a.intervalID=window.setInterval((function(){a.playDemo()}),400),a.playDemo())}),500):(this.demo=!1,this.autoLog=!0,this.intervalID_log=window.setInterval((function(){a.playLog()}),1e3)),this.goaled=!1,this.flush(!0,!1)},t.prototype.playDemo=function(){null!==this.intervalID&&(Math.random()>.3?this.ai(2):this.ai(1)),this.demo_inc++,this.calcScore(),this.flush(!1,!1),1!==this.winner&&-1!==this.winner&&0!==this.winner||(this.goaled=!0,this.winner=null,this.flush(!1,!1),this.shuffleBoard()),this.demo_inc>42&&window.clearInterval(this.intervalID)},t.prototype.playLog=function(){null!==this.intervalID_log&&1==this.autoLog?this.move_next():clearInterval(this.intervalID_log)},t.prototype.zoom=function(){var e=document.querySelector("meta[name=viewport]");if(screen.width<500&&screen.height<500?screen.width<screen.height?e.setAttribute("content","width=500,user-scalable=no"):e.setAttribute("content","height=500,user-scalable=no"):screen.width<500?e.setAttribute("content","width=500,user-scalable=no"):screen.height<500&&e.setAttribute("content","height=500,user-scalable=no"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){var t=screen.width,i=520;0!==Math.abs(window.orientation)&&(t=screen.height,i=900);var s=Math.round(t/i*1e3)/1e3;s==Math.round(s)&&(s+=1e-4),e.setAttribute("content","initial-scale="+s+", minimum-scale="+s+", maximum-scale="+s+", user-scalable=no")}},t.prototype.ai=function(t){var i,s,a=this,o=new Date,l=this.getNodeCount(this.thisMap)/2,h=0;switch(t){case 1:l<=7&&h++;break;case 2:l<=8&&h++;break;case 3:l<=10&&h++,l<=6&&h++;break;case 4:l<=11&&h++,l<=7&&h++;break;case 5:case 6:l>16&&h--,l<=12&&h++,l<=8&&h++}i=e.thinkAI(this.thisMap,this.turn_player,t+h+1,void 0,void 0,void 0)[0],this.thisHand=i,i&&(this.isGoaled(this.thisMap,i[1],this.turn_player)&&(this.goaled=!0,this.flush(!1,!0),setTimeout((function(){a.goaled=!1,a.flush(!1,!1)}),2e3)),this.thisMap[i[1]]=this.thisMap[i[0]],this.thisMap[i[0]]=0,this.logArray2.push([i[0],i[1]])),this.turn_player=-1*this.turn_player,s=new Date,this.thinktime=(s.getTime()-o.getTime())/1e3},t.prototype.isGoaled=function(e,t,i){if(i>0){if(t%10==0)return!0}else if(i<0&&t%10==5)return!0;return!1},t.prototype.shuffleBoard=function(){for(var e in this.thisMap)this.thisMap[e]=0;for(var t=[1,2,3,4,5,6,7,8],i=[0,10,20,30,40,50,11,41],s=[55,45,35,25,15,5,44,14],a=t.length-1;a>=0;a--){var o=Math.floor(Math.random()*(a+1)),l=t[a];t[a]=t[o],t[o]=l}for(var e in s)this.thisMap[s[e]]=t[e];for(var e in i)this.thisMap[i[e]]=-1*t[e]},t.prototype.getMousePosition=function(e){var t;if(null!=e){e.clientX||(e=e.touches||e.touches?e.touches[0]:null===(t=event)||void 0===t?void 0:t.touches[0]);var i=e.target.getBoundingClientRect();this.mouse_x=e.clientX-i.left,this.mouse_y=e.clientY-i.top,this.mouse_x=this.mouse_x*this.RATIO,this.mouse_y=this.mouse_y*this.RATIO}},t.prototype.flush=function(e,t){var i=new Int8Array(this.thisMap);if(this.ctx.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),!1===t&&(this.cache_on=!1),!1===t||!1===this.cache_on){this.ctx.drawImage(this.drawBoard(e),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawBoard2(e),0,0,this.CANV_SIZE,this.CANV_SIZE),null!==this.hover_piece&&(i[this.hover_piece]=0),this.ctx.drawImage(this.drawShadow(i,this.thisHand),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawPieceAll(i),0,0,this.CANV_SIZE,this.CANV_SIZE);var s=this.canv_cache.getContext("2d");s.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),s.drawImage(this.ctx.canvas,0,0,this.CANV_SIZE,this.CANV_SIZE),this.cache_on=!0}else this.ctx.drawImage(this.canv_cache,0,0,this.CANV_SIZE,this.CANV_SIZE);this.ctx.drawImage(this.drawHoverPiece(),0,0,this.CANV_SIZE,this.CANV_SIZE),0===this.mouse_x&&0===this.mouse_y||!1!==this.demo||this.ctx.drawImage(this.drawFocus(),0,0,this.CANV_SIZE,this.CANV_SIZE),(this.goaled||null!==this.winner)&&!1===this.demo&&0==this.autoLog&&this.ctx.drawImage(this.drawScore(),0,0,this.CANV_SIZE,this.CANV_SIZE),this.ctx.drawImage(this.drawOverlay(),0,0,this.CANV_SIZE,this.CANV_SIZE),!0===this.demo&&this.ctx.drawImage(this.drawCover(),0,0,this.CANV_SIZE,this.CANV_SIZE)},t.prototype.drawBk=function(){var e=this.canv_bk.getContext("2d");return this.img_bk_loaded&&e.drawImage(this.img_bk,0,0,this.CANV_SIZE/this.RATIO,this.CANV_SIZE/this.RATIO,0,0,this.CANV_SIZE,this.CANV_SIZE),this.canv_bk},t.prototype.drawCover=function(){var e=this.canv_cover.getContext("2d");e.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),e.globalAlpha=.5,e.fillStyle="#000000",e.fillRect(0,0,this.CANV_SIZE,this.CANV_SIZE);var t=2*this.cellSize,i=3.5*this.cellSize;e.shadowBlur=20,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowOffsetX=5,e.shadowOffsetY=5,e.globalAlpha=.8,e.fillStyle=this.COLOR_WHITE,e.beginPath(),this.fillRoundRect(e,t,i,2*this.cellSize,1*this.cellSize,this.cellSize/20),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;var s=Math.round(.5*this.cellSize),a="Play";return a+=this.demo_inc%10==0?" ":"",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="rgba(0, 0, 0, 0)",e.font="bold "+s+"px Play,sans-serif",e.globalAlpha=1,e.fillStyle=this.COLOR_LINE,e.textBaseline="middle",e.textAlign="center",e.beginPath(),e.fillText(a,3*this.cellSize,4*this.cellSize),a="colamone",s=Math.round(1*this.cellSize),e.font="bold "+s+"px Play,sans-serif",e.fillStyle=this.COLOR_WHITE,e.shadowBlur=0,e.beginPath(),e.fillText(a,3*this.cellSize,2*this.cellSize),this.canv_cover},t.prototype.drawScore=function(){var e=this.canv_score.getContext("2d"),t="",i=Math.round(1.5*this.cellSize),s=this.COLOR_BLUE2,a=this.COLOR_RED2;return e.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),e.globalAlpha=.4,e.textBaseline="middle",e.textAlign="center",e.shadowBlur=10,e.shadowColor="rgba(0, 0, 0, 0.5)",e.font="bold "+i+"px Play,sans-serif",e.globalAlpha=.3,e.shadowBlur=2,e.shadowColor="rgba(255, 255, 255, 1)",e.fillStyle=a,t=String(this.redScore),e.beginPath(),e.fillText(t,1*this.cellSize,3.8*this.cellSize),t="8",e.beginPath(),e.fillText(t,2*this.cellSize,5.3*this.cellSize),e.lineWidth=.2*this.cellSize,e.strokeStyle=a,e.beginPath(),e.moveTo(.4*this.cellSize,5.55*this.cellSize),e.lineTo(2.6*this.cellSize,3.55*this.cellSize),e.closePath(),e.stroke(),t=String(this.blueScore),e.fillStyle=s,e.beginPath(),e.fillText(t,4*this.cellSize,.7*this.cellSize),t="8",e.beginPath(),e.fillText(t,5*this.cellSize,2.3*this.cellSize),e.lineWidth=.2*this.cellSize,e.strokeStyle=s,e.beginPath(),e.moveTo(3.4*this.cellSize,2.55*this.cellSize),e.lineTo(5.6*this.cellSize,.55*this.cellSize),e.closePath(),e.stroke(),this.canv_score},t.prototype.drawFocus=function(){var t=this.mouse_x-this.mouse_x%this.cellSize,i=this.mouse_y-this.mouse_y%this.cellSize,s=this.canv_focus.getContext("2d"),a=s.createRadialGradient(t,i,0,t,i,this.cellSize);if(a.addColorStop(.3,this.COLOR_SELECT),a.addColorStop(1,this.COLOR_SELECT2),s.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),s.globalAlpha=.35,s.fillStyle=a,s.lineWidth=1,s.beginPath(),s.fillRect(t,i,this.cellSize,this.cellSize),!0===this.isTouch&&null===this.hover_piece)return this.canv_focus;var o=t/this.cellSize*10+i/this.cellSize;if(this.thisMap[o]*this.turn_player>0)for(var l=e.getCanMovePanelX(o,this.thisMap),h=0;h<=l.length-1;h++)t=Math.floor(l[h]/10),i=Math.floor(l[h]%10),s.globalAlpha=.6,s.strokeStyle=this.COLOR_SELECT,s.lineWidth=this.cellSize/20,s.beginPath(),s.arc(t*this.cellSize+this.cellSize/2,i*this.cellSize+this.cellSize/2,this.cellSize/2-this.cellSize/10,0,2*Math.PI,!1),s.stroke();return this.canv_focus},t.prototype.drawBoard=function(e){if(!1===e)return this.canv_board;var t=this.canv_board.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);var i=t.createLinearGradient(0,0,this.CANV_SIZE,this.CANV_SIZE);i.addColorStop(0,this.COLOR_PANEL_6),i.addColorStop(.3,this.COLOR_PANEL_5),i.addColorStop(1,this.COLOR_PANEL_4);for(var s=0;s<6;s++)for(var a=0;a<6;a++)t.strokeStyle=this.COLOR_LINE,0===a?t.fillStyle=this.COLOR_PANEL_1:5==a?t.fillStyle=this.COLOR_PANEL_2:(s+a)%2==0?t.fillStyle=this.COLOR_PANEL_3:(t.fillStyle=this.COLOR_PANEL_4,t.fillStyle=i),t.beginPath(),t.fillRect(s*this.cellSize,a*this.cellSize,this.cellSize,this.cellSize),t.strokeRect(s*this.cellSize,a*this.cellSize,this.cellSize,this.cellSize);return this.canv_board},t.prototype.drawBoard2=function(e){if(!1===e)return this.canv_board2;var t=this.canv_board2.getContext("2d");return t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),t.globalAlpha=.07,t.fillStyle=this.COLOR_WHITE,t.beginPath(),t.arc(1*this.cellSize,-3*this.cellSize,7*this.cellSize,0,2*Math.PI,!1),t.fill(),this.canv_board2},t.prototype.drawHoverPiece=function(){var e=this.canv_hover_piece.getContext("2d");e.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);var t=this.mouse_x-this.cellSize/2,i=this.mouse_y-this.cellSize/2;return null!==this.hover_piece&&this.drawPiece(e,t,i,this.thisMap[this.hover_piece],!1),this.canv_hover_piece},t.prototype.drawPiece=function(e,t,i,s,a){var o;if(0===s)return e;o=s>0?this.COLOR_BLUE:this.COLOR_RED;var l=this.ctx.createLinearGradient(t,i,t+this.cellSize,i+this.cellSize);l.addColorStop(0,"rgb(255, 255, 255)"),l.addColorStop(.4,o),l.addColorStop(1,o),e.shadowBlur=10,e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=2,e.shadowOffsetY=2,e.fillStyle=l,e.beginPath(),this.fillRoundRect(e,t+this.cellSize/10,i+this.cellSize/10,this.cellSize-1*this.cellSize/5,this.cellSize-1*this.cellSize/5,this.cellSize/20),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,this.img_bk_loaded&&(e.globalAlpha=.35,e.save(),e.clip(),e.drawImage(this.drawBk(),t+this.cellSize/10,i+this.cellSize/10,this.cellSize-1*this.cellSize/5,this.cellSize-1*this.cellSize/5),e.restore(),e.globalAlpha=1),e.fillStyle=this.COLOR_WHITE;var h=Math.round(.18*this.cellSize);e.textBaseline="middle",e.textAlign="center",e.font=h+"pt 'Play',Arial",e.beginPath(),e.fillText(String(Math.abs(s)),t+this.cellSize/2,i+this.cellSize/2);for(var r=0;r<=this.PIECES[s].length-1;r++)if(0!==this.PIECES[s][r]){var n=t+this.cellSize/4.16+Math.floor(this.cellSize-1*this.cellSize/5)/3*Math.floor(r%3),c=i+this.cellSize/4.16+Math.floor(this.cellSize-1*this.cellSize/5)/3*Math.floor(r/3);e.fillStyle=this.COLOR_WHITE,e.beginPath(),e.arc(n,c,.06*this.cellSize,0,2*Math.PI,!1),e.fill()}return a&&(e.shadowBlur=10,e.shadowColor="rgba(0, 0, 0, 1)",e.globalAlpha=1,e.fillStyle=this.COLOR_WHITE,h=Math.round(.5*this.cellSize),e.textBaseline="middle",e.textAlign="center",e.font="bolder "+h+"pt Play,Arial ",e.beginPath(),e.fillText(String(Math.abs(s)),t+this.cellSize/2,i+this.cellSize/2),e.globalAlpha=1,e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0),e},t.prototype.fillRoundRect=function(e,t,i,s,a,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+s-o,i),e.arc(t+s-o,i+o,o,1.5*Math.PI,0,!1),e.lineTo(t+s,i+a-o),e.arc(t+s-o,i+a-o,o,0,.5*Math.PI,!1),e.lineTo(t+o,i+a),e.arc(t+o,i+a-o,o,.5*Math.PI,Math.PI,!1),e.lineTo(t,i+o),e.arc(t+o,i+o,o,Math.PI,1.5*Math.PI,!1),e.closePath(),e.fill()},t.prototype.drawPieceAll=function(e){var t=this.canv_pieces.getContext("2d");t.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE);for(var i=0;i<6;i++)for(var s=0;s<6;s++)if(0!==e[10*i+s]){var a=!1;(e[10*i+s]>0&&0===s||e[10*i+s]<0&&5==s)&&(a=!0),t=this.drawPiece(t,i*this.cellSize,s*this.cellSize,e[10*i+s],a)}return this.canv_pieces},t.prototype.drawShadow=function(e,t){var i=this.canv_shadow.getContext("2d");if(i.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),void 0===t)return this.canv_shadow;var s,a,o=t[0]/10|0,l=t[0]%10,h=t[1]/10|0,r=t[1]%10,n=this.cellSize-1*this.cellSize/5,c=this.cellSize-1*this.cellSize/5,d=h*this.cellSize+this.cellSize/10,u=r*this.cellSize+this.cellSize/10,v=d+c/2,p=u+n/2,g=v,_=p,S=e[t[1]],f=0;if(2!=t.length)return this.canv_shadow;if(a=S>0?this.COLOR_BLUE:this.COLOR_RED,o==h||l==r)f=(o+l)%2==0&&0!==l&&5!=l?.5:.3,o<h&&(d=d-c+10,g-=c),o>h&&(d=d+c-10,g+=c),l<r&&(u=u-n+10,_-=n),l>r&&(u=u+n-10,_+=n),(s=i.createLinearGradient(v,p,g,_)).addColorStop(0,a),s.addColorStop(f,a),s.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=s,i.fillRect(d,u,n,c);else{f=(o+l)%2==0&&0!==l&&5!=l?.3:.5;var m=[0,0,0,0,0,0,0,0],w=m[0],y=m[1],I=m[2],C=m[3],E=m[4],A=m[5],M=m[6],L=m[7];o<h&&l<r&&(w=d,y=u-n,I=d+c,C=u,E=d,A=u+n,M=d-c,L=u,g-=c,_-=n,v+=2*c,p+=2*n),o>h&&l>r&&(w=d+c,y=u,I=d+c+c,C=u+n,E=d+c,A=u+n+n,M=d,L=u+n,g+=c,_+=n,v-=2*c,p-=2*n),o<h&&l>r&&(w=d,y=u,I=d+c,C=u+n,E=d,A=u+n+n,M=d-c,L=u+n,g-=c,_+=n,v+=2*c,p-=2*n),o>h&&l<r&&(w=d+c,y=u-n,I=d+c+c,C=u,E=d+c,A=u+n,M=d,L=u,g+=c,_-=n,v-=2*c,p+=2*n),i.beginPath(),i.moveTo(w,y),i.lineTo(I,C),i.lineTo(E,A),i.lineTo(M,L),i.lineTo(w,y),i.closePath(),(s=i.createLinearGradient(v,p,g,_)).addColorStop(0,a),s.addColorStop(f,a),s.addColorStop(.97,"rgba(255, 255, 255, 0)"),i.fillStyle=s,i.fill()}return this.canv_shadow},t.prototype.drawOverlay=function(){var e=this.canv_overlay.getContext("2d"),t=1.3*this.cellSize,i=2.5*this.cellSize;if(e.clearRect(0,0,this.CANV_SIZE,this.CANV_SIZE),""===this.message)return this.canv_overlay;e.shadowBlur=10,e.shadowColor="rgba(100, 100, 100, 0.5)",e.shadowOffsetX=5,e.shadowOffsetY=5,e.globalAlpha=.9,e.fillStyle=this.COLOR_WHITE,this.fillRoundRect(e,t,i,3.4*this.cellSize,1*this.cellSize,this.cellSize/20);var s=Math.round(.36*this.cellSize);return e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="rgba(0, 0, 0, 0)",e.font="bold "+s+"px Play,sans-serif",e.globalAlpha=1,e.fillStyle=this.COLOR_LINE,e.textBaseline="middle",e.textAlign="center",e.beginPath(),e.fillText(this.message,3*this.cellSize,3*this.cellSize),this.canv_overlay},t.prototype.updateMessage=function(){this.calcScore(),document.querySelector("#blue").innerHTML="Blue: "+this.blueScore+"/8",document.querySelector("#red").innerHTML=" Red: "+this.redScore+"/8",document.querySelector("#time").innerHTML="("+this.thinktime.toFixed(3)+"sec)",0===this.logArray.length&&(1==this.winner?(this.message="You win!",this.storage.setItem("level_"+document.querySelector("#level").value,parseInt(this.storage.getItem("level_"+document.querySelector("#level").value))+1),this.endgame()):-1==this.winner?(this.message="You lose...",this.storage.setItem("level_"+document.querySelector("#level").value,0),this.endgame()):0===this.winner&&(this.map_list[JSON.stringify(this.thisMap)]>=this.LIMIT_1000DAY?this.message="3fold repetition":this.message="-- Draw --",this.endgame())),this.storage.getItem("level_"+document.querySelector("#level").value)>0?document.querySelector("#wins").innerHTML=this.storage.getItem("level_"+document.querySelector("#level").value)+" win!":document.querySelector("#wins").innerHTML=""},t.prototype.endgame=function(){0===this.logArray.length&&(document.querySelector("#span_replay").classList.remove("hide"),document.querySelector("#span_tweetlog").classList.remove("hide"))},t.prototype.calcScore=function(){var e=0,t=0,i=[0,10,20,30,40,50],s=[5,15,25,35,45,55];for(var a in i)1*this.thisMap[i[a]]>0&&(e+=this.thisMap[i[a]]);for(var a in s)-1*this.thisMap[s[a]]>0&&(t+=this.thisMap[s[a]]);e>=8?this.winner=1:t<=-8&&(this.winner=-1),this.isNoneNode(this.thisMap)?Math.abs(e)>Math.abs(t)?this.winner=1:Math.abs(e)<Math.abs(t)?this.winner=-1:Math.abs(e)==Math.abs(t)&&(this.winner=0):!0===this.is1000day(this.thisMap)&&(this.winner=0),this.blueScore=Math.abs(e),this.redScore=Math.abs(t)},t.prototype.isNoneNode=function(t){var i=!1,s=!1;for(var a in t)if(0!==t[a]&&(0!==e.getCanMovePanelX(parseInt(a),t).length&&(t[a]>0?i=!0:t[a]<0&&(s=!0)),i&&s))return!1;return!0},t.prototype.is1000day=function(e){var t=JSON.stringify(e);return void 0===this.map_list[t]?(this.map_list[t]=1,!1):(this.map_list[t]+=1,this.map_list[t]>=this.LIMIT_1000DAY)},t.prototype.getNodeCount=function(t){var i=0;for(var s in t)0!==t[s]&&(i+=e.getCanMovePanelX(parseInt(s),t).length);return i},t.prototype.getParam=function(){var e={};if(1<document.location.search.length)for(var t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("="),a=decodeURIComponent(s[0]),o=decodeURIComponent(s[1]);e[a]=decodeURIComponent(o)}return e},t.prototype.getMapByParam=function(t){var i;if(t){for(var s in i=e.copyMap(this.thisMap))i[s]=0;var a=t.split(",");a.length<8&&(a=["1","2","3","4","5","6","7","8"]);var o=[0,10,20,30,40,50,11,41],l=[55,45,35,25,15,5,44,14];for(var s in l)i[l[s]]=parseInt(a[s]);for(var s in o)i[o[s]]=-1*parseInt(a[s])}return i},t.prototype.decodeLog=function(t,i){var s=[],a=e.copyMap(i),o={q:0,w:1,e:2,a:3,s:4,d:5,z:6,x:7,c:8},l=(t=(t=(t=t.replace(/q/g,"q,").replace(/w/g,"w,").replace(/e/g,"e,")).replace(/a/g,"a,").replace(/s/g,"s,").replace(/d/g,"d,")).replace(/z/g,"z,").replace(/x/g,"x,").replace(/c/g,"c,")).split(",");s.push(a);for(var h=0;h<l.length;h++)if(""!==l[h]){var r=o[l[h].match(/[qweasdzxc]/)[0]],n=parseInt(l[h].match(/\d*/)[0]),c=10*(Math.floor(n/10)+Math.floor(r%3)-1)+(Math.floor(n%10)+Math.floor(r/3)-1);(a=e.copyMap(a))[c]=a[n],a[n]=0,s.push(a)}return s},t.prototype.encodeLog=function(e){var t="";for(var i in e){var s=e[i][0],a=e[i][1],o=Math.floor(a/10)-Math.floor(s/10),l=Math.floor(a%10)-Math.floor(s%10),h="";-1===o&&-1===l&&(h="q"),0===o&&-1===l&&(h="w"),1===o&&-1===l&&(h="e"),-1===o&&0===l&&(h="a"),0===o&&0===l&&(h="s"),1===o&&0===l&&(h="d"),-1===o&&1===l&&(h="z"),0===o&&1===l&&(h="x"),1===o&&1===l&&(h="c"),t+=s+h}return t},t.prototype.move_start=function(){this.logPointer=0,this.autoLog=!1,this.thisMap=e.copyMap(this.logArray[this.logPointer]),this.winner=null,this.goaled=!1,this.updateMessage(),this.flush(!1,!1)},t.prototype.move_prev=function(){this.logPointer<=0||(this.autoLog=!1,this.logPointer-=1,this.thisMap=e.copyMap(this.logArray[this.logPointer]),this.winner=null,this.goaled=!1,this.updateMessage(),this.flush(!1,!1))},t.prototype.move_next=function(){this.logPointer+1>this.logArray.length-1||(this.logPointer+=1,this.thisMap=e.copyMap(this.logArray[this.logPointer]),this.updateMessage(),this.flush(!1,!1))},t.prototype.move_end=function(){this.logPointer=this.logArray.length-1,this.autoLog=!1,this.thisMap=e.copyMap(this.logArray[this.logPointer]),this.updateMessage(),this.flush(!1,!1)},t.prototype.reloadnew=function(){var t=document.location.href.split("?")[0];if(!0!==this.demo){var i=this.getParam();i.lang&&(t+="?lang="+i.lang),navigator.onLine?location.href=t:(this.thisMap=e.copyMap(this.startMap),this.shuffleBoard(),this.logArray2=[],this.message="",this.winner=null,this.turn_player=1,this.flush(!1,!1))}else this.ev_mouseClick(null)},t.prototype.jumpkento=function(){var e=document.location.href.split("?")[0],t="?init="+this.startMap[55]+","+this.startMap[45]+","+this.startMap[35]+","+this.startMap[25]+","+this.startMap[15]+","+this.startMap[5]+","+this.startMap[44]+","+this.startMap[14],i="&log="+this.encodeLog(this.logArray2);i+="&lv="+document.querySelector("#level").value,location.href=e+t+i},t.prototype.tweetlog=function(){var e=document.location.href.split("?")[0],t="?init="+this.startMap[55]+","+this.startMap[45]+","+this.startMap[35]+","+this.startMap[25]+","+this.startMap[15]+","+this.startMap[5]+","+this.startMap[44]+","+this.startMap[14],i="%26log="+this.encodeLog(this.logArray2);i+="%26lv="+document.querySelector("#level").value,window.open("https://twitter.com/intent/tweet?text="+e+t+i+"%20%23colamone")},t.prototype.setTweet=function(){var e,t,i,s,a;t="script",i="twitter-wjs",a=(e=document).getElementsByTagName(t)[0],e.getElementById(i)||((s=e.createElement(t)).id=i,s.async=!0,s.src="https://platform.twitter.com/widgets.js",a.parentNode.insertBefore(s,a))},t.prototype.isBot=function(){var e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("bot")||-1!=e.indexOf("lighthouse")||-1!=e.indexOf("headless")},t}());document.addEventListener("DOMContentLoaded",(function(){t.Run()}))})();
//# sourceMappingURL=main.js.map